#!/usr/bin/env node
"use strict";var us=Object.create;var Jt=Object.defineProperty;var fs=Object.getOwnPropertyDescriptor;var hs=Object.getOwnPropertyNames;var ds=Object.getPrototypeOf,gs=Object.prototype.hasOwnProperty;var a=(r,e)=>Jt(r,"name",{value:e,configurable:!0});var U=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),En=(r,e)=>{for(var t in e)Jt(r,t,{get:e[t],enumerable:!0})},ps=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of hs(e))!gs.call(r,i)&&i!==t&&Jt(r,i,{get:()=>e[i],enumerable:!(n=fs(e,i))||n.enumerable});return r};var Dr=(r,e,t)=>(t=r!=null?us(ds(r)):{},ps(e||!r||!r.__esModule?Jt(t,"default",{value:r,enumerable:!0}):t,r));var _n=U(ze=>{"use strict";var bs="[object ArrayBuffer]",ge=class r{static{a(this,"BufferSourceConverter")}static isArrayBuffer(e){return Object.prototype.toString.call(e)===bs}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){let n=r.toUint8Array(e),i=r.toUint8Array(t);if(n.length!==i.byteLength)return!1;for(let s=0;s<n.length;s++)if(n[s]!==i[s])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let n=0;for(let o of t)n+=o.byteLength;let i=new Uint8Array(n),s=0;for(let o of t){let c=this.toUint8Array(o);i.set(c,s),s+=c.length}return e[e.length-1]instanceof Function?this.toView(i,e[e.length-1]):i.buffer}},Mr="string",ms=/^[0-9a-f\s]+$/i,vs=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,ks=/^[a-zA-Z0-9-_]+$/,Yt=class{static{a(this,"Utf8Converter")}static fromString(e){let t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n.buffer}static toString(e){let t=ge.toUint8Array(e),n="";for(let s=0;s<t.length;s++)n+=String.fromCharCode(t[s]);return decodeURIComponent(escape(n))}},Q=class{static{a(this,"Utf16Converter")}static toString(e,t=!1){let n=ge.toArrayBuffer(e),i=new DataView(n),s="";for(let o=0;o<n.byteLength;o+=2){let c=i.getUint16(o,t);s+=String.fromCharCode(c)}return s}static fromString(e,t=!1){let n=new ArrayBuffer(e.length*2),i=new DataView(n);for(let s=0;s<e.length;s++)i.setUint16(s*2,e.charCodeAt(s),t);return n}},Xt=class r{static{a(this,"Convert")}static isHex(e){return typeof e===Mr&&ms.test(e)}static isBase64(e){return typeof e===Mr&&vs.test(e)}static isBase64Url(e){return typeof e===Mr&&ks.test(e)}static ToString(e,t="utf8"){let n=ge.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);case"utf16le":return Q.toString(n,!0);case"utf16":case"utf16be":return Q.toString(n);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return Q.fromString(e,!0);case"utf16":case"utf16be":return Q.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){let t=ge.toUint8Array(e);if(typeof btoa<"u"){let n=this.ToString(t,"binary");return btoa(n)}else return Buffer.from(t).toString("base64")}static FromBase64(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!r.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!r.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=r.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return Yt.fromString(e);case"utf16":case"utf16be":return Q.fromString(e);case"utf16le":case"usc2":return Q.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=r.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return Yt.toString(e);case"utf16":case"utf16be":return Q.toString(e);case"utf16le":case"usc2":return Q.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){let t=e.length,n=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);return n.buffer}static ToBinary(e){let t=ge.toUint8Array(e),n="";for(let i=0;i<t.length;i++)n+=String.fromCharCode(t[i]);return n}static ToHex(e){let t=ge.toUint8Array(e),n="",i=t.length;for(let s=0;s<i;s++){let o=t[s];o<16&&(n+="0"),n+=o.toString(16)}return n}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!r.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);let n=new Uint8Array(t.length/2);for(let i=0;i<t.length;i=i+2){let s=t.slice(i,i+2);n[i/2]=parseInt(s,16)}return n.buffer}static ToUtf16String(e,t=!1){return Q.toString(e,t)}static FromUtf16String(e,t=!1){return Q.fromString(e,t)}static Base64Padding(e){let t=4-e.length%4;if(t<4)for(let n=0;n<t;n++)e+="=";return e}static formatString(e){return e?.replace(/[\n\r\t ]/g,"")||""}};Xt.DEFAULT_UTF8_ENCODING="utf8";function As(r,...e){let t=arguments[0];for(let n=1;n<arguments.length;n++){let i=arguments[n];for(let s in i)t[s]=i[s]}return t}a(As,"assign");function Bs(...r){let e=r.map(i=>i.byteLength).reduce((i,s)=>i+s),t=new Uint8Array(e),n=0;return r.map(i=>new Uint8Array(i)).forEach(i=>{for(let s of i)t[n++]=s}),t.buffer}a(Bs,"combine");function Es(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;let t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<r.byteLength;i++)if(t[i]!==n[i])return!1;return!0}a(Es,"isEqual");ze.BufferSourceConverter=ge;ze.Convert=Xt;ze.assign=As;ze.combine=Bs;ze.isEqual=Es});var Cn=U(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});function xs(r){return new Date(r.getTime()+r.getTimezoneOffset()*6e4)}a(xs,"getUTCDate");function Ss(r,e,t){var n;return r instanceof Object&&(n=r[e])!==null&&n!==void 0?n:t}a(Ss,"getParametersValue");function _s(r,e=0,t=r.byteLength-e,n=!1){let i="";for(let s of new Uint8Array(r,e,t)){let o=s.toString(16).toUpperCase();o.length===1&&(i+="0"),i+=o,n&&(i+=" ")}return i.trim()}a(_s,"bufferToHexCodes");function Rs(r,e,t,n){return e instanceof ArrayBuffer?e.byteLength?t<0?(r.error="Wrong parameter: inputOffset less than zero",!1):n<0?(r.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-n<0?(r.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(r.error="Wrong parameter: inputBuffer has zero length",!1):(r.error='Wrong parameter: inputBuffer must be "ArrayBuffer"',!1)}a(Rs,"checkBufferParams");function Hr(r,e){let t=0;if(r.length===1)return r[0];for(let n=r.length-1;n>=0;n--)t+=r[r.length-1-n]*Math.pow(2,e*n);return t}a(Hr,"utilFromBase");function qr(r,e,t=-1){let n=t,i=r,s=0,o=Math.pow(2,e);for(let c=1;c<8;c++){if(r<o){let l;if(n<0)l=new ArrayBuffer(c),s=c;else{if(n<c)return new ArrayBuffer(0);l=new ArrayBuffer(n),s=n}let f=new Uint8Array(l);for(let h=c-1;h>=0;h--){let d=Math.pow(2,h*e);f[s-h-1]=Math.floor(i/d),i-=f[s-h-1]*d}return l}o*=Math.pow(2,e)}return new ArrayBuffer(0)}a(qr,"utilToBase");function Ts(...r){let e=0,t=0;for(let s of r)e+=s.byteLength;let n=new ArrayBuffer(e),i=new Uint8Array(n);for(let s of r)i.set(new Uint8Array(s),t),t+=s.byteLength;return n}a(Ts,"utilConcatBuf");function Cs(...r){let e=0,t=0;for(let s of r)e+=s.length;let n=new ArrayBuffer(e),i=new Uint8Array(n);for(let s of r)i.set(s,t),t+=s.length;return i}a(Cs,"utilConcatView");function Us(){let r=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){let c=r[0]===255&&r[1]&128,l=r[0]===0&&(r[1]&128)===0;(c||l)&&this.warnings.push("Needlessly long format")}let e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let c=0;c<this.valueHex.byteLength;c++)t[c]=0;t[0]=r[0]&128;let n=Hr(t,8),i=new ArrayBuffer(this.valueHex.byteLength),s=new Uint8Array(i);for(let c=0;c<this.valueHex.byteLength;c++)s[c]=r[c];return s[0]&=127,Hr(s,8)-n}a(Us,"utilDecodeTC");function Ps(r){let e=r<0?r*-1:r,t=128;for(let n=1;n<8;n++){if(e<=t){if(r<0){let o=t-e,c=qr(o,8,n),l=new Uint8Array(c);return l[0]|=128,c}let i=qr(e,8,n),s=new Uint8Array(i);if(s[0]&128){let o=i.slice(0),c=new Uint8Array(o);i=new ArrayBuffer(i.byteLength+1),s=new Uint8Array(i);for(let l=0;l<o.byteLength;l++)s[l+1]=c[l];s[0]=0}return i}t*=Math.pow(2,8)}return new ArrayBuffer(0)}a(Ps,"utilEncodeTC");function Is(r,e){if(r.byteLength!==e.byteLength)return!1;let t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<t.length;i++)if(t[i]!==n[i])return!1;return!0}a(Is,"isEqualBuffer");function Ns(r,e){let t=r.toString(10);if(e<t.length)return"";let n=e-t.length,i=new Array(n);for(let o=0;o<n;o++)i[o]="0";return i.join("").concat(t)}a(Ns,"padNumber");var Rn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Tn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";function Ls(r,e=!1,t=!1,n=!1){let i=0,s=0,o=0,c="",l=e?Tn:Rn;if(n){let f=0;for(let h=0;h<r.length;h++)if(r.charCodeAt(h)!==0){f=h;break}r=r.slice(f)}for(;i<r.length;){let f=r.charCodeAt(i++);i>=r.length&&(s=1);let h=r.charCodeAt(i++);i>=r.length&&(o=1);let d=r.charCodeAt(i++),g=f>>2,w=(f&3)<<4|h>>4,y=(h&15)<<2|d>>6,m=d&63;s===1?y=m=64:o===1&&(m=64),t?y===64?c+=`${l.charAt(g)}${l.charAt(w)}`:m===64?c+=`${l.charAt(g)}${l.charAt(w)}${l.charAt(y)}`:c+=`${l.charAt(g)}${l.charAt(w)}${l.charAt(y)}${l.charAt(m)}`:c+=`${l.charAt(g)}${l.charAt(w)}${l.charAt(y)}${l.charAt(m)}`}return c}a(Ls,"toBase64");function Os(r,e=!1,t=!1){let n=e?Tn:Rn;function i(l){for(let f=0;f<64;f++)if(n.charAt(f)===l)return f;return 64}a(i,"indexOf");function s(l){return l===64?0:l}a(s,"test");let o=0,c="";for(;o<r.length;){let l=i(r.charAt(o++)),f=o>=r.length?0:i(r.charAt(o++)),h=o>=r.length?0:i(r.charAt(o++)),d=o>=r.length?0:i(r.charAt(o++)),g=s(l)<<2|s(f)>>4,w=(s(f)&15)<<4|s(h)>>2,y=(s(h)&3)<<6|s(d);c+=String.fromCharCode(g),h!==64&&(c+=String.fromCharCode(w)),d!==64&&(c+=String.fromCharCode(y))}if(t){let l=c.length,f=-1;for(let h=l-1;h>=0;h--)if(c.charCodeAt(h)!==0){f=h;break}f!==-1?c=c.slice(0,f+1):c=""}return c}a(Os,"fromBase64");function Fs(r){let e="",t=new Uint8Array(r);for(let n of t)e+=String.fromCharCode(n);return e}a(Fs,"arrayBufferToString");function zs(r){let e=r.length,t=new ArrayBuffer(e),n=new Uint8Array(t);for(let i=0;i<e;i++)n[i]=r.charCodeAt(i);return t}a(zs,"stringToArrayBuffer");var Ds=Math.log(2);function Vs(r){let e=Math.log(r)/Ds,t=Math.floor(e),n=Math.round(e);return t===n?t:n}a(Vs,"nearestPowerOf2");function Ms(r,e){for(let t of e)delete r[t]}a(Ms,"clearProps");T.arrayBufferToString=Fs;T.bufferToHexCodes=_s;T.checkBufferParams=Rs;T.clearProps=Ms;T.fromBase64=Os;T.getParametersValue=Ss;T.getUTCDate=xs;T.isEqualBuffer=Is;T.nearestPowerOf2=Vs;T.padNumber=Ns;T.stringToArrayBuffer=zs;T.toBase64=Ls;T.utilConcatBuf=Ts;T.utilConcatView=Cs;T.utilDecodeTC=Us;T.utilEncodeTC=Ps;T.utilFromBase=Hr;T.utilToBase=qr});var wi=U(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});var Hs=_n(),qs=Cn();function Nn(r){if(r&&r.__esModule)return r;var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:a(function(){return r[t]},"get")})}}),e.default=r,Object.freeze(e)}a(Nn,"_interopNamespace");var k=Nn(Hs),B=Nn(qs);function Zt(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}a(Zt,"assertBigInt");function Kr(r){let e=0,t=0;for(let i=0;i<r.length;i++){let s=r[i];e+=s.byteLength}let n=new Uint8Array(e);for(let i=0;i<r.length;i++){let s=r[i];n.set(new Uint8Array(s),t),t+=s.byteLength}return n.buffer}a(Kr,"concat");function we(r,e,t,n){return e instanceof Uint8Array?e.byteLength?t<0?(r.error="Wrong parameter: inputOffset less than zero",!1):n<0?(r.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-n<0?(r.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(r.error="Wrong parameter: inputBuffer has zero length",!1):(r.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}a(we,"checkBufferParams");var Ve=class{static{a(this,"ViewWriter")}constructor(){this.items=[]}write(e){this.items.push(e)}final(){return Kr(this.items)}},Ze=[new Uint8Array([1])],Un="0123456789",jr="name",Pn="valueHexView",js="isHexOnly",$s="idBlock",Ks="tagClass",Gs="tagNumber",Js="isConstructed",Ws="fromBER",Ys="toBER",Xs="local",q="",se=new ArrayBuffer(0),gr=new Uint8Array(0),Qe="EndOfContent",Ln="OCTET STRING",On="BIT STRING";function ce(r){var e;return e=class extends r{static{a(this,"Some")}constructor(...n){var i;super(...n);let s=n[0]||{};this.isHexOnly=(i=s.isHexOnly)!==null&&i!==void 0?i:!1,this.valueHexView=s.valueHex?k.BufferSourceConverter.toUint8Array(s.valueHex):gr}get valueHex(){return this.valueHexView.slice().buffer}set valueHex(n){this.valueHexView=new Uint8Array(n)}fromBER(n,i,s){let o=n instanceof ArrayBuffer?new Uint8Array(n):n;if(!we(this,o,i,s))return-1;let c=i+s;return this.valueHexView=o.subarray(i,c),this.valueHexView.length?(this.blockLength=s,c):(this.warnings.push("Zero buffer length"),i)}toBER(n=!1){return this.isHexOnly?n?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",se)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:k.Convert.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}a(ce,"HexBlock");var pe=class{static{a(this,"LocalBaseBlock")}constructor({blockLength:e=0,error:t=q,warnings:n=[],valueBeforeDecode:i=gr}={}){this.blockLength=e,this.error=t,this.warnings=n,this.valueBeforeDecodeView=k.BufferSourceConverter.toUint8Array(i)}static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:k.Convert.ToHex(this.valueBeforeDecodeView)}}};pe.NAME="baseBlock";var F=class extends pe{static{a(this,"ValueBlock")}fromBER(e,t,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}};F.NAME="valueBlock";var Qt=class extends ce(pe){static{a(this,"LocalIdentificationBlock")}constructor({idBlock:e={}}={}){var t,n,i,s;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?k.BufferSourceConverter.toUint8Array(e.valueHex):gr,this.tagClass=(n=e.tagClass)!==null&&n!==void 0?n:-1,this.tagNumber=(i=e.tagNumber)!==null&&i!==void 0?i:-1,this.isConstructed=(s=e.isConstructed)!==null&&s!==void 0?s:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",se}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){let i=new Uint8Array(1);if(!e){let s=this.tagNumber;s&=31,t|=s,i[0]=t}return i.buffer}if(!this.isHexOnly){let i=B.utilToBase(this.tagNumber,7),s=new Uint8Array(i),o=i.byteLength,c=new Uint8Array(o+1);if(c[0]=t|31,!e){for(let l=0;l<o-1;l++)c[l+1]=s[l]|128;c[o]=s[o-1]}return c.buffer}let n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=t|31,!e){let i=this.valueHexView;for(let s=0;s<i.length-1;s++)n[s+1]=i[s]|128;n[this.valueHexView.byteLength]=i[i.length-1]}return n.buffer}fromBER(e,t,n){let i=k.BufferSourceConverter.toUint8Array(e);if(!we(this,i,t,n))return-1;let s=i.subarray(t,t+n);if(s.length===0)return this.error="Zero buffer length",-1;switch(s[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(s[0]&32)===32,this.isHexOnly=!1;let c=s[0]&31;if(c!==31)this.tagNumber=c,this.blockLength=1;else{let l=1,f=this.valueHexView=new Uint8Array(255),h=255;for(;s[l]&128;){if(f[l-1]=s[l]&127,l++,l>=s.length)return this.error="End of input reached before message was fully decoded",-1;if(l===h){h+=255;let g=new Uint8Array(h);for(let w=0;w<f.length;w++)g[w]=f[w];f=this.valueHexView=new Uint8Array(h)}}this.blockLength=l+1,f[l-1]=s[l]&127;let d=new Uint8Array(l);for(let g=0;g<l;g++)d[g]=f[g];f=this.valueHexView=new Uint8Array(l),f.set(d),this.blockLength<=9?this.tagNumber=B.utilFromBase(f,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}};Qt.NAME="identificationBlock";var er=class extends pe{static{a(this,"LocalLengthBlock")}constructor({lenBlock:e={}}={}){var t,n,i;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(n=e.longFormUsed)!==null&&n!==void 0?n:!1,this.length=(i=e.length)!==null&&i!==void 0?i:0}fromBER(e,t,n){let i=k.BufferSourceConverter.toUint8Array(e);if(!we(this,i,t,n))return-1;let s=i.subarray(t,t+n);if(s.length===0)return this.error="Zero buffer length",-1;if(s[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=s[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(s[0]&128),this.longFormUsed===!1)return this.length=s[0],this.blockLength=1,t+this.blockLength;let o=s[0]&127;if(o>8)return this.error="Too big integer",-1;if(o+1>s.length)return this.error="End of input reached before message was fully decoded",-1;let c=t+1,l=i.subarray(c,c+o);return l[o-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=B.utilFromBase(l,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=o+1,t+this.blockLength}toBER(e=!1){let t,n;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=128),t;if(this.longFormUsed){let i=B.utilToBase(this.length,8);if(i.byteLength>127)return this.error="Too big length",se;if(t=new ArrayBuffer(i.byteLength+1),e)return t;let s=new Uint8Array(i);n=new Uint8Array(t),n[0]=i.byteLength|128;for(let o=0;o<i.byteLength;o++)n[o+1]=s[o];return t}return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}};er.NAME="lengthBlock";var p={},P=class extends pe{static{a(this,"BaseBlock")}constructor({name:e=q,optional:t=!1,primitiveSchema:n,...i}={},s){super(i),this.name=e,this.optional=t,n&&(this.primitiveSchema=n),this.idBlock=new Qt(i),this.lenBlock=new er(i),this.valueBlock=s?new s(i):new F(i)}fromBER(e,t,n){let i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}toBER(e,t){let n=t||new Ve;t||Fn(this);let i=this.idBlock.toBER(e);if(n.write(i),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,n),n.write(new ArrayBuffer(2));else{let s=this.valueBlock.toBER(e);this.lenBlock.length=s.byteLength;let o=this.lenBlock.toBER(e);n.write(o),n.write(s)}return t?se:n.final()}toJSON(){let e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():k.Convert.ToHex(this.toBER())}onAsciiEncoding(){return`${this.constructor.NAME} : ${k.Convert.ToHex(this.valueBlock.valueBeforeDecodeView)}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;let t=this.toBER(),n=e.toBER();return B.isEqualBuffer(t,n)}};P.NAME="BaseBlock";function Fn(r){if(r instanceof p.Constructed)for(let e of r.valueBlock.value)Fn(e)&&(r.lenBlock.isIndefiniteForm=!0);return!!r.lenBlock.isIndefiniteForm}a(Fn,"prepareIndefiniteForm");var et=class extends P{static{a(this,"BaseStringBlock")}constructor({value:e=q,...t}={},n){super(t,n),e&&this.fromString(e)}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}fromBER(e,t,n){let i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}};et.NAME="BaseStringBlock";var tr=class extends ce(F){static{a(this,"LocalPrimitiveValueBlock")}constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}};tr.NAME="PrimitiveValueBlock";var zn,tt=class extends P{static{a(this,"Primitive")}constructor(e={}){super(e,tr),this.idBlock.isConstructed=!1}};zn=tt;p.Primitive=zn;tt.NAME="PRIMITIVE";function Zs(r,e){if(r instanceof e)return r;let t=new e;return t.idBlock=r.idBlock,t.lenBlock=r.lenBlock,t.warnings=r.warnings,t.valueBeforeDecodeView=r.valueBeforeDecodeView,t}a(Zs,"localChangeType");function je(r,e=0,t=r.length){let n=e,i=new P({},F),s=new pe;if(!we(s,r,e,t))return i.error=s.error,{offset:-1,result:i};if(!r.subarray(e,e+t).length)return i.error="Zero buffer length",{offset:-1,result:i};let c=i.idBlock.fromBER(r,e,t);if(i.idBlock.warnings.length&&i.warnings.concat(i.idBlock.warnings),c===-1)return i.error=i.idBlock.error,{offset:-1,result:i};if(e=c,t-=i.idBlock.blockLength,c=i.lenBlock.fromBER(r,e,t),i.lenBlock.warnings.length&&i.warnings.concat(i.lenBlock.warnings),c===-1)return i.error=i.lenBlock.error,{offset:-1,result:i};if(e=c,t-=i.lenBlock.blockLength,!i.idBlock.isConstructed&&i.lenBlock.isIndefiniteForm)return i.error="Indefinite length form used for primitive encoding form",{offset:-1,result:i};let l=P;switch(i.idBlock.tagClass){case 1:if(i.idBlock.tagNumber>=37&&i.idBlock.isHexOnly===!1)return i.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:i};switch(i.idBlock.tagNumber){case 0:if(i.idBlock.isConstructed&&i.lenBlock.length>0)return i.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:i};l=p.EndOfContent;break;case 1:l=p.Boolean;break;case 2:l=p.Integer;break;case 3:l=p.BitString;break;case 4:l=p.OctetString;break;case 5:l=p.Null;break;case 6:l=p.ObjectIdentifier;break;case 10:l=p.Enumerated;break;case 12:l=p.Utf8String;break;case 13:l=p.RelativeObjectIdentifier;break;case 14:l=p.TIME;break;case 15:return i.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:i};case 16:l=p.Sequence;break;case 17:l=p.Set;break;case 18:l=p.NumericString;break;case 19:l=p.PrintableString;break;case 20:l=p.TeletexString;break;case 21:l=p.VideotexString;break;case 22:l=p.IA5String;break;case 23:l=p.UTCTime;break;case 24:l=p.GeneralizedTime;break;case 25:l=p.GraphicString;break;case 26:l=p.VisibleString;break;case 27:l=p.GeneralString;break;case 28:l=p.UniversalString;break;case 29:l=p.CharacterString;break;case 30:l=p.BmpString;break;case 31:l=p.DATE;break;case 32:l=p.TimeOfDay;break;case 33:l=p.DateTime;break;case 34:l=p.Duration;break;default:{let f=i.idBlock.isConstructed?new p.Constructed:new p.Primitive;f.idBlock=i.idBlock,f.lenBlock=i.lenBlock,f.warnings=i.warnings,i=f}}break;case 2:case 3:case 4:default:l=i.idBlock.isConstructed?p.Constructed:p.Primitive}return i=Zs(i,l),c=i.fromBER(r,e,i.lenBlock.isIndefiniteForm?t:i.lenBlock.length),i.valueBeforeDecodeView=r.subarray(n,n+i.blockLength),{offset:c,result:i}}a(je,"localFromBER");function Qs(r){if(!r.byteLength){let e=new P({},F);return e.error="Input buffer has zero length",{offset:-1,result:e}}return je(k.BufferSourceConverter.toUint8Array(r).slice(),0,r.byteLength)}a(Qs,"fromBER");function eo(r,e){return r?1:e}a(eo,"checkLen");var oe=class extends F{static{a(this,"LocalConstructedValueBlock")}constructor({value:e=[],isIndefiniteForm:t=!1,...n}={}){super(n),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,n){let i=k.BufferSourceConverter.toUint8Array(e);if(!we(this,i,t,n))return-1;if(this.valueBeforeDecodeView=i.subarray(t,t+n),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let s=t;for(;eo(this.isIndefiniteForm,n)>0;){let o=je(i,s,n);if(o.offset===-1)return this.error=o.result.error,this.warnings.concat(o.result.warnings),-1;if(s=o.offset,this.blockLength+=o.result.blockLength,n-=o.result.blockLength,this.value.push(o.result),this.isIndefiniteForm&&o.result.constructor.NAME===Qe)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===Qe?this.value.pop():this.warnings.push("No EndOfContent block encoded")),s}toBER(e,t){let n=t||new Ve;for(let i=0;i<this.value.length;i++)this.value[i].toBER(e,n);return t?se:n.final()}toJSON(){let e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(let t of this.value)e.value.push(t.toJSON());return e}};oe.NAME="ConstructedValueBlock";var Dn,ye=class extends P{static{a(this,"Constructed")}constructor(e={}){super(e,oe),this.idBlock.isConstructed=!0}fromBER(e,t,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;let i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}onAsciiEncoding(){let e=[];for(let n of this.valueBlock.value)e.push(n.toString("ascii").split(`
`).map(i=>`  ${i}`).join(`
`));let t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}};Dn=ye;p.Constructed=Dn;ye.NAME="CONSTRUCTED";var rr=class extends F{static{a(this,"LocalEndOfContentValueBlock")}fromBER(e,t,n){return t}toBER(e){return se}};rr.override="EndOfContentValueBlock";var Vn,rt=class extends P{static{a(this,"EndOfContent")}constructor(e={}){super(e,rr),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}};Vn=rt;p.EndOfContent=Vn;rt.NAME=Qe;var Mn,nt=class extends P{static{a(this,"Null")}constructor(e={}){super(e,F),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,t+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+n}toBER(e,t){let n=new ArrayBuffer(2);if(!e){let i=new Uint8Array(n);i[0]=5,i[1]=0}return t&&t.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}};Mn=nt;p.Null=Mn;nt.NAME="NULL";var nr=class extends ce(F){static{a(this,"LocalBooleanValueBlock")}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=k.BufferSourceConverter.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}get value(){for(let e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}fromBER(e,t,n){let i=k.BufferSourceConverter.toUint8Array(e);return we(this,i,t,n)?(this.valueHexView=i.subarray(t,t+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,B.utilDecodeTC.call(this),this.blockLength=n,t+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}};nr.NAME="BooleanValueBlock";var Hn,it=class extends P{static{a(this,"Boolean")}constructor(e={}){super(e,nr),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};Hn=it;p.Boolean=Hn;it.NAME="BOOLEAN";var ir=class extends ce(oe){static{a(this,"LocalOctetStringValueBlock")}constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,n){let i=0;if(this.isConstructed){if(this.isHexOnly=!1,i=oe.prototype.fromBER.call(this,e,t,n),i===-1)return i;for(let s=0;s<this.value.length;s++){let o=this.value[s].constructor.NAME;if(o===Qe){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==Ln)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,i=super.fromBER(e,t,n),this.blockLength=n;return i}toBER(e,t){return this.isConstructed?oe.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}};ir.NAME="OctetStringValueBlock";var qn,st=class r extends P{static{a(this,"OctetString")}constructor({idBlock:e={},lenBlock:t={},...n}={}){var i,s;(i=n.isConstructed)!==null&&i!==void 0||(n.isConstructed=!!(!((s=n.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},ir),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,n===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){let s=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+n);try{if(s.byteLength){let o=je(s,0,s.byteLength);o.offset!==-1&&o.offset===n&&(this.valueBlock.value=[o.result])}}catch{}}return super.fromBER(e,t,n)}onAsciiEncoding(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?ye.prototype.onAsciiEncoding.call(this):`${this.constructor.NAME} : ${k.Convert.ToHex(this.valueBlock.valueHexView)}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;let e=[];for(let t of this.valueBlock.value)t instanceof r&&e.push(t.valueBlock.valueHexView);return k.BufferSourceConverter.concat(e)}};qn=st;p.OctetString=qn;st.NAME=Ln;var sr=class extends ce(oe){static{a(this,"LocalBitStringValueBlock")}constructor({unusedBits:e=0,isConstructed:t=!1,...n}={}){super(n),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,n){if(!n)return t;let i=-1;if(this.isConstructed){if(i=oe.prototype.fromBER.call(this,e,t,n),i===-1)return i;for(let c of this.value){let l=c.constructor.NAME;if(l===Qe){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(l!==On)return this.error="BIT STRING may consists of BIT STRINGs only",-1;let f=c.valueBlock;if(this.unusedBits>0&&f.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=f.unusedBits}return i}let s=k.BufferSourceConverter.toUint8Array(e);if(!we(this,s,t,n))return-1;let o=s.subarray(t,t+n);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){let c=o.subarray(1);try{if(c.byteLength){let l=je(c,0,c.byteLength);l.offset!==-1&&l.offset===n-1&&(this.value=[l.result])}}catch{}}return this.valueHexView=o.subarray(1),this.blockLength=o.length,t+n}toBER(e,t){if(this.isConstructed)return oe.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return se;let n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}};sr.NAME="BitStringValueBlock";var jn,ot=class extends P{static{a(this,"BitString")}constructor({idBlock:e={},lenBlock:t={},...n}={}){var i,s;(i=n.isConstructed)!==null&&i!==void 0||(n.isConstructed=!!(!((s=n.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},sr),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return ye.prototype.onAsciiEncoding.call(this);{let e=[],t=this.valueBlock.valueHexView;for(let i of t)e.push(i.toString(2).padStart(8,"0"));let n=e.join("");return`${this.constructor.NAME} : ${n.substring(0,n.length-this.valueBlock.unusedBits)}`}}};jn=ot;p.BitString=jn;ot.NAME=On;var $n;function to(r,e){let t=new Uint8Array([0]),n=new Uint8Array(r),i=new Uint8Array(e),s=n.slice(0),o=s.length-1,c=i.slice(0),l=c.length-1,f=0,h=l<o?o:l,d=0;for(let g=h;g>=0;g--,d++){switch(!0){case d<c.length:f=s[o-d]+c[l-d]+t[0];break;default:f=s[o-d]+t[0]}switch(t[0]=f/10,!0){case d>=s.length:s=B.utilConcatView(new Uint8Array([f%10]),s);break;default:s[o-d]=f%10}}return t[0]>0&&(s=B.utilConcatView(t,s)),s}a(to,"viewAdd");function In(r){if(r>=Ze.length)for(let e=Ze.length;e<=r;e++){let t=new Uint8Array([0]),n=Ze[e-1].slice(0);for(let i=n.length-1;i>=0;i--){let s=new Uint8Array([(n[i]<<1)+t[0]]);t[0]=s[0]/10,n[i]=s[0]%10}t[0]>0&&(n=B.utilConcatView(t,n)),Ze.push(n)}return Ze[r]}a(In,"power2");function ro(r,e){let t=0,n=new Uint8Array(r),i=new Uint8Array(e),s=n.slice(0),o=s.length-1,c=i.slice(0),l=c.length-1,f,h=0;for(let d=l;d>=0;d--,h++)switch(f=s[o-h]-c[l-h]-t,!0){case f<0:t=1,s[o-h]=f+10;break;default:t=0,s[o-h]=f}if(t>0)for(let d=o-l+1;d>=0;d--,h++)if(f=s[o-h]-t,f<0)t=1,s[o-h]=f+10;else{t=0,s[o-h]=f;break}return s.slice()}a(ro,"viewSub");var at=class extends ce(F){static{a(this,"LocalIntegerValueBlock")}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=B.utilDecodeTC.call(this)))}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(B.utilEncodeTC(e))}get valueDec(){return this._valueDec}fromDER(e,t,n,i=0){let s=this.fromBER(e,t,n);if(s===-1)return s;let o=this.valueHexView;return o[0]===0&&(o[1]&128)!==0?this.valueHexView=o.subarray(1):i!==0&&o.length<i&&(i-o.length>1&&(i=o.length+1),this.valueHexView=o.subarray(i-o.length)),s}toDER(e=!1){let t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{let n=new Uint8Array(this.valueHexView.length+1);n[0]=0,n.set(t,1),this.valueHexView=n}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,n){let i=super.fromBER(e,t,n);return i===-1||this.setValueHex(),i}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){let e=this.valueHexView.length*8-1,t=new Uint8Array(this.valueHexView.length*8/3),n=0,i,s=this.valueHexView,o="",c=!1;for(let l=s.byteLength-1;l>=0;l--){i=s[l];for(let f=0;f<8;f++){if((i&1)===1)switch(n){case e:t=ro(In(n),t),o="-";break;default:t=to(t,In(n))}n++,i>>=1}}for(let l=0;l<t.length;l++)t[l]&&(c=!0),c&&(o+=Un.charAt(t[l]));return c===!1&&(o+=Un.charAt(0)),o}};$n=at;at.NAME="IntegerValueBlock";Object.defineProperty($n.prototype,"valueHex",{set:a(function(r){this.valueHexView=new Uint8Array(r),this.setValueHex()},"set"),get:a(function(){return this.valueHexView.slice().buffer},"get")});var Kn,Me=class r extends P{static{a(this,"Integer")}constructor(e={}){super(e,at),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return Zt(),BigInt(this.valueBlock.toString())}static fromBigInt(e){Zt();let t=BigInt(e),n=new Ve,i=t.toString(16).replace(/^-/,""),s=new Uint8Array(k.Convert.FromHex(i));if(t<0){let c=new Uint8Array(s.length+(s[0]&128?1:0));c[0]|=128;let f=BigInt(`0x${k.Convert.ToHex(c)}`)+t,h=k.BufferSourceConverter.toUint8Array(k.Convert.FromHex(f.toString(16)));h[0]|=128,n.write(h)}else s[0]&128&&n.write(new Uint8Array([0])),n.write(s);return new r({valueHex:n.final()})}convertToDER(){let e=new r({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new r({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}};Kn=Me;p.Integer=Kn;Me.NAME="INTEGER";var Gn,ct=class extends Me{static{a(this,"Enumerated")}constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}};Gn=ct;p.Enumerated=Gn;ct.NAME="ENUMERATED";var lt=class extends ce(F){static{a(this,"LocalSidValueBlock")}constructor({valueDec:e=-1,isFirstSid:t=!1,...n}={}){super(n),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,n){if(!n)return t;let i=k.BufferSourceConverter.toUint8Array(e);if(!we(this,i,t,n))return-1;let s=i.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let c=0;c<n&&(this.valueHexView[c]=s[c]&127,this.blockLength++,(s[c]&128)!==0);c++);let o=new Uint8Array(this.blockLength);for(let c=0;c<this.blockLength;c++)o[c]=this.valueHexView[c];return this.valueHexView=o,(s[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=B.utilFromBase(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){Zt();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;let n=new Uint8Array(t.length/7);for(let i=0;i<n.length;i++)n[i]=parseInt(t.slice(i*7,i*7+7),2)+(i+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let i=this.valueHexView,s=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)s[o]=i[o]|128;return s[this.blockLength-1]=i[this.blockLength-1],s.buffer}let t=B.utilToBase(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",se;let n=new Uint8Array(t.byteLength);if(!e){let i=new Uint8Array(t),s=t.byteLength-1;for(let o=0;o<s;o++)n[o]=i[o]|128;n[s]=i[s]}return n}toString(){let e="";if(this.isHexOnly)e=k.Convert.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}};lt.NAME="sidBlock";var or=class extends F{static{a(this,"LocalObjectIdentifierValueBlock")}constructor({value:e=q,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let i=t;for(;n>0;){let s=new lt;if(i=s.fromBER(e,i,n),i===-1)return this.blockLength=0,this.error=s.error,i;this.value.length===0&&(s.isFirstSid=!0),this.blockLength+=s.blockLength,n-=s.blockLength,this.value.push(s)}return i}toBER(e){let t=[];for(let n=0;n<this.value.length;n++){let i=this.value[n].toBER(e);if(i.byteLength===0)return this.error=this.value[n].error,se;t.push(i)}return Kr(t)}fromString(e){this.value=[];let t=0,n=0,i="",s=!1;do if(n=e.indexOf(".",t),n===-1?i=e.substring(t):i=e.substring(t,n),t=n+1,s){let o=this.value[0],c=0;switch(o.valueDec){case 0:break;case 1:c=40;break;case 2:c=80;break;default:this.value=[];return}let l=parseInt(i,10);if(isNaN(l))return;o.valueDec=l+c,s=!1}else{let o=new lt;if(i>Number.MAX_SAFE_INTEGER){Zt();let c=BigInt(i);o.valueBigInt=c}else if(o.valueDec=parseInt(i,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,s=!0),this.value.push(o)}while(n!==-1)}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let i=this.value[n].toString();n!==0&&(e=`${e}.`),t?(i=`{${i}}`,this.value[n].isFirstSid?e=`2.{${i} - 80}`:e+=i):e+=i}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}};or.NAME="ObjectIdentifierValueBlock";var Jn,ut=class extends P{static{a(this,"ObjectIdentifier")}constructor(e={}){super(e,or),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}};Jn=ut;p.ObjectIdentifier=Jn;ut.NAME="OBJECT IDENTIFIER";var ft=class extends ce(pe){static{a(this,"LocalRelativeSidValueBlock")}constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,n){if(n===0)return t;let i=k.BufferSourceConverter.toUint8Array(e);if(!we(this,i,t,n))return-1;let s=i.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let c=0;c<n&&(this.valueHexView[c]=s[c]&127,this.blockLength++,(s[c]&128)!==0);c++);let o=new Uint8Array(this.blockLength);for(let c=0;c<this.blockLength;c++)o[c]=this.valueHexView[c];return this.valueHexView=o,(s[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=B.utilFromBase(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);let i=this.valueHexView,s=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)s[o]=i[o]|128;return s[this.blockLength-1]=i[this.blockLength-1],s.buffer}let t=B.utilToBase(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",se;let n=new Uint8Array(t.byteLength);if(!e){let i=new Uint8Array(t),s=t.byteLength-1;for(let o=0;o<s;o++)n[o]=i[o]|128;n[s]=i[s]}return n.buffer}toString(){let e="";return this.isHexOnly?e=k.Convert.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}};ft.NAME="relativeSidBlock";var ar=class extends F{static{a(this,"LocalRelativeObjectIdentifierValueBlock")}constructor({value:e=q,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let i=t;for(;n>0;){let s=new ft;if(i=s.fromBER(e,i,n),i===-1)return this.blockLength=0,this.error=s.error,i;this.blockLength+=s.blockLength,n-=s.blockLength,this.value.push(s)}return i}toBER(e,t){let n=[];for(let i=0;i<this.value.length;i++){let s=this.value[i].toBER(e);if(s.byteLength===0)return this.error=this.value[i].error,se;n.push(s)}return Kr(n)}fromString(e){this.value=[];let t=0,n=0,i="";do{n=e.indexOf(".",t),n===-1?i=e.substring(t):i=e.substring(t,n),t=n+1;let s=new ft;if(s.valueDec=parseInt(i,10),isNaN(s.valueDec))return!0;this.value.push(s)}while(n!==-1);return!0}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let i=this.value[n].toString();n!==0&&(e=`${e}.`),t&&(i=`{${i}}`),e+=i}return e}toJSON(){let e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}};ar.NAME="RelativeObjectIdentifierValueBlock";var Wn,ht=class extends P{static{a(this,"RelativeObjectIdentifier")}constructor(e={}){super(e,ar),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}};Wn=ht;p.RelativeObjectIdentifier=Wn;ht.NAME="RelativeObjectIdentifier";var Yn,dt=class extends ye{static{a(this,"Sequence")}constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}};Yn=dt;p.Sequence=Yn;dt.NAME="SEQUENCE";var Xn,gt=class extends ye{static{a(this,"Set")}constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};Xn=gt;p.Set=Xn;gt.NAME="SET";var cr=class extends ce(F){static{a(this,"LocalStringValueBlock")}constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=q}toJSON(){return{...super.toJSON(),value:this.value}}};cr.NAME="StringValueBlock";var lr=class extends cr{static{a(this,"LocalSimpleStringValueBlock")}};lr.NAME="SimpleStringValueBlock";var M=class extends et{static{a(this,"LocalSimpleStringBlock")}constructor({...e}={}){super(e,lr)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,k.BufferSourceConverter.toUint8Array(e))}fromString(e){let t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);this.valueBlock.value=e}};M.NAME="SIMPLE STRING";var ur=class extends M{static{a(this,"LocalUtf8StringValueBlock")}fromBuffer(e){this.valueBlock.valueHexView=k.BufferSourceConverter.toUint8Array(e);try{this.valueBlock.value=k.Convert.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=k.Convert.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(k.Convert.FromUtf8String(e)),this.valueBlock.value=e}};ur.NAME="Utf8StringValueBlock";var Zn,ae=class extends ur{static{a(this,"Utf8String")}constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}};Zn=ae;p.Utf8String=Zn;ae.NAME="UTF8String";var fr=class extends M{static{a(this,"LocalBmpStringValueBlock")}fromBuffer(e){this.valueBlock.value=k.Convert.ToUtf16String(e),this.valueBlock.valueHexView=k.BufferSourceConverter.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(k.Convert.FromUtf16String(e))}};fr.NAME="BmpStringValueBlock";var Qn,pt=class extends fr{static{a(this,"BmpString")}constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}};Qn=pt;p.BmpString=Qn;pt.NAME="BMPString";var hr=class extends M{static{a(this,"LocalUniversalStringValueBlock")}fromBuffer(e){let t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),n=new Uint8Array(t);for(let i=0;i<n.length;i+=4)n[i]=n[i+3],n[i+1]=n[i+2],n[i+2]=0,n[i+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){let t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let i=0;i<t;i++){let s=B.utilToBase(e.charCodeAt(i),8),o=new Uint8Array(s);if(o.length>4)continue;let c=4-o.length;for(let l=o.length-1;l>=0;l--)n[i*4+l+c]=o[l]}this.valueBlock.value=e}};hr.NAME="UniversalStringValueBlock";var ei,yt=class extends hr{static{a(this,"UniversalString")}constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}};ei=yt;p.UniversalString=ei;yt.NAME="UniversalString";var ti,wt=class extends M{static{a(this,"NumericString")}constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}};ti=wt;p.NumericString=ti;wt.NAME="NumericString";var ri,bt=class extends M{static{a(this,"PrintableString")}constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}};ri=bt;p.PrintableString=ri;bt.NAME="PrintableString";var ni,mt=class extends M{static{a(this,"TeletexString")}constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}};ni=mt;p.TeletexString=ni;mt.NAME="TeletexString";var ii,vt=class extends M{static{a(this,"VideotexString")}constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}};ii=vt;p.VideotexString=ii;vt.NAME="VideotexString";var si,kt=class extends M{static{a(this,"IA5String")}constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}};si=kt;p.IA5String=si;kt.NAME="IA5String";var oi,At=class extends M{static{a(this,"GraphicString")}constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}};oi=At;p.GraphicString=oi;At.NAME="GraphicString";var ai,He=class extends M{static{a(this,"VisibleString")}constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}};ai=He;p.VisibleString=ai;He.NAME="VisibleString";var ci,Bt=class extends M{static{a(this,"GeneralString")}constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}};ci=Bt;p.GeneralString=ci;Bt.NAME="GeneralString";var li,Et=class extends M{static{a(this,"CharacterString")}constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}};li=Et;p.CharacterString=li;Et.NAME="CharacterString";var ui,qe=class extends He{static{a(this,"UTCTime")}constructor({value:e,valueDate:t,...n}={}){if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let i=0;i<e.length;i++)this.valueBlock.valueHexView[i]=e.charCodeAt(i)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,k.BufferSourceConverter.toUint8Array(e)))}toBuffer(){let e=this.toString(),t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){let n=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(n===null){this.error="Wrong input string for conversion";return}let i=parseInt(n[1],10);i>=50?this.year=1900+i:this.year=2e3+i,this.month=parseInt(n[2],10),this.day=parseInt(n[3],10),this.hour=parseInt(n[4],10),this.minute=parseInt(n[5],10),this.second=parseInt(n[6],10)}toString(e="iso"){if(e==="iso"){let t=new Array(7);return t[0]=B.padNumber(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=B.padNumber(this.month,2),t[2]=B.padNumber(this.day,2),t[3]=B.padNumber(this.hour,2),t[4]=B.padNumber(this.minute,2),t[5]=B.padNumber(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}};ui=qe;p.UTCTime=ui;qe.NAME="UTCTime";var fi,xt=class extends qe{static{a(this,"GeneralizedTime")}constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(e){let t=!1,n="",i="",s=0,o,c=0,l=0;if(e[e.length-1]==="Z")n=e.substring(0,e.length-1),t=!0;else{let d=new Number(e[e.length-1]);if(isNaN(d.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(t){if(n.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(n.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let d=1,g=n.indexOf("+"),w="";if(g===-1&&(g=n.indexOf("-"),d=-1),g!==-1){if(w=n.substring(g+1),n=n.substring(0,g),w.length!==2&&w.length!==4)throw new Error("Wrong input string for conversion");let y=parseInt(w.substring(0,2),10);if(isNaN(y.valueOf()))throw new Error("Wrong input string for conversion");if(c=d*y,w.length===4){if(y=parseInt(w.substring(2,4),10),isNaN(y.valueOf()))throw new Error("Wrong input string for conversion");l=d*y}}}let f=n.indexOf(".");if(f===-1&&(f=n.indexOf(",")),f!==-1){let d=new Number(`0${n.substring(f)}`);if(isNaN(d.valueOf()))throw new Error("Wrong input string for conversion");s=d.valueOf(),i=n.substring(0,f)}else i=n;switch(!0){case i.length===8:if(o=/(\d{4})(\d{2})(\d{2})/ig,f!==-1)throw new Error("Wrong input string for conversion");break;case i.length===10:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,f!==-1){let d=60*s;this.minute=Math.floor(d),d=60*(d-this.minute),this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case i.length===12:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,f!==-1){let d=60*s;this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case i.length===14:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,f!==-1){let d=1e3*s;this.millisecond=Math.floor(d)}break;default:throw new Error("Wrong input string for conversion")}let h=o.exec(i);if(h===null)throw new Error("Wrong input string for conversion");for(let d=1;d<h.length;d++)switch(d){case 1:this.year=parseInt(h[d],10);break;case 2:this.month=parseInt(h[d],10);break;case 3:this.day=parseInt(h[d],10);break;case 4:this.hour=parseInt(h[d],10)+c;break;case 5:this.minute=parseInt(h[d],10)+l;break;case 6:this.second=parseInt(h[d],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){let d=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=d.getUTCFullYear(),this.month=d.getUTCMonth(),this.day=d.getUTCDay(),this.hour=d.getUTCHours(),this.minute=d.getUTCMinutes(),this.second=d.getUTCSeconds(),this.millisecond=d.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){let t=[];return t.push(B.padNumber(this.year,4)),t.push(B.padNumber(this.month,2)),t.push(B.padNumber(this.day,2)),t.push(B.padNumber(this.hour,2)),t.push(B.padNumber(this.minute,2)),t.push(B.padNumber(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(B.padNumber(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}};fi=xt;p.GeneralizedTime=fi;xt.NAME="GeneralizedTime";var hi,St=class extends ae{static{a(this,"DATE")}constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}};hi=St;p.DATE=hi;St.NAME="DATE";var di,_t=class extends ae{static{a(this,"TimeOfDay")}constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}};di=_t;p.TimeOfDay=di;_t.NAME="TimeOfDay";var gi,Rt=class extends ae{static{a(this,"DateTime")}constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}};gi=Rt;p.DateTime=gi;Rt.NAME="DateTime";var pi,Tt=class extends ae{static{a(this,"Duration")}constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}};pi=Tt;p.Duration=pi;Tt.NAME="Duration";var yi,Ct=class extends ae{static{a(this,"TIME")}constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}};yi=Ct;p.TIME=yi;Ct.NAME="TIME";var Te=class{static{a(this,"Any")}constructor({name:e=q,optional:t=!1}={}){this.name=e,this.optional=t}},dr=class extends Te{static{a(this,"Choice")}constructor({value:e=[],...t}={}){super(t),this.value=e}},Ut=class extends Te{static{a(this,"Repeated")}constructor({value:e=new Te,local:t=!1,...n}={}){super(n),this.value=e,this.local=t}},$r=class{static{a(this,"RawData")}constructor({data:e=gr}={}){this.dataView=k.BufferSourceConverter.toUint8Array(e)}get data(){return this.dataView.slice().buffer}set data(e){this.dataView=k.BufferSourceConverter.toUint8Array(e)}fromBER(e,t,n){let i=t+n;return this.dataView=k.BufferSourceConverter.toUint8Array(e).subarray(t,i),i}toBER(e){return this.dataView.slice().buffer}};function De(r,e,t){if(t instanceof dr){for(let s=0;s<t.value.length;s++)if(De(r,e,t.value[s]).verified)return{verified:!0,result:r};{let s={verified:!1,result:{error:"Wrong values for Choice type"}};return t.hasOwnProperty(jr)&&(s.name=t.name),s}}if(t instanceof Te)return t.hasOwnProperty(jr)&&(r[t.name]=e),{verified:!0,result:r};if(!(r instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!($s in t))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(Ws in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(Ys in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let n=t.idBlock.toBER(!1);if(n.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(t.idBlock.fromBER(n,0,n.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(t.idBlock.hasOwnProperty(Ks)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(Gs)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(Js)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:r};if(!(js in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:r};if(t.idBlock.isHexOnly){if(!(Pn in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let s=t.idBlock.valueHexView,o=e.idBlock.valueHexView;if(s.length!==o.length)return{verified:!1,result:r};for(let c=0;c<s.length;c++)if(s[c]!==o[1])return{verified:!1,result:r}}if(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,q),t.name&&(r[t.name]=e)),t instanceof p.Constructed){let s=0,o={verified:!1,result:{error:"Unknown error"}},c=t.valueBlock.value.length;if(c>0&&t.valueBlock.value[0]instanceof Ut&&(c=e.valueBlock.value.length),c===0)return{verified:!0,result:r};if(e.valueBlock.value.length===0&&t.valueBlock.value.length!==0){let l=!0;for(let f=0;f<t.valueBlock.value.length;f++)l=l&&(t.valueBlock.value[f].optional||!1);return l?{verified:!0,result:r}:(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,q),t.name&&delete r[t.name]),r.error="Inconsistent object length",{verified:!1,result:r})}for(let l=0;l<c;l++)if(l-s>=e.valueBlock.value.length){if(t.valueBlock.value[l].optional===!1){let f={verified:!1,result:r};return r.error="Inconsistent length between ASN.1 data and schema",t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,q),t.name&&(delete r[t.name],f.name=t.name)),f}}else if(t.valueBlock.value[0]instanceof Ut){if(o=De(r,e.valueBlock.value[l],t.valueBlock.value[0].value),o.verified===!1)if(t.valueBlock.value[0].optional)s++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,q),t.name&&delete r[t.name]),o;if(jr in t.valueBlock.value[0]&&t.valueBlock.value[0].name.length>0){let f={};Xs in t.valueBlock.value[0]&&t.valueBlock.value[0].local?f=e:f=r,typeof f[t.valueBlock.value[0].name]>"u"&&(f[t.valueBlock.value[0].name]=[]),f[t.valueBlock.value[0].name].push(e.valueBlock.value[l])}}else if(o=De(r,e.valueBlock.value[l-s],t.valueBlock.value[l]),o.verified===!1)if(t.valueBlock.value[l].optional)s++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,q),t.name&&delete r[t.name]),o;if(o.verified===!1){let l={verified:!1,result:r};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,q),t.name&&(delete r[t.name],l.name=t.name)),l}return{verified:!0,result:r}}if(t.primitiveSchema&&Pn in e.valueBlock){let s=je(e.valueBlock.valueHexView);if(s.offset===-1){let o={verified:!1,result:s.result};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,q),t.name&&(delete r[t.name],o.name=t.name)),o}return De(r,s.result,t.primitiveSchema)}return{verified:!0,result:r}}a(De,"compareSchema");function no(r,e){if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};let t=je(k.BufferSourceConverter.toUint8Array(r));return t.offset===-1?{verified:!1,result:t.result}:De(t.result,t.result,e)}a(no,"verifySchema");b.Any=Te;b.BaseBlock=P;b.BaseStringBlock=et;b.BitString=ot;b.BmpString=pt;b.Boolean=it;b.CharacterString=Et;b.Choice=dr;b.Constructed=ye;b.DATE=St;b.DateTime=Rt;b.Duration=Tt;b.EndOfContent=rt;b.Enumerated=ct;b.GeneralString=Bt;b.GeneralizedTime=xt;b.GraphicString=At;b.HexBlock=ce;b.IA5String=kt;b.Integer=Me;b.Null=nt;b.NumericString=wt;b.ObjectIdentifier=ut;b.OctetString=st;b.Primitive=tt;b.PrintableString=bt;b.RawData=$r;b.RelativeObjectIdentifier=ht;b.Repeated=Ut;b.Sequence=dt;b.Set=gt;b.TIME=Ct;b.TeletexString=mt;b.TimeOfDay=_t;b.UTCTime=qe;b.UniversalString=yt;b.Utf8String=ae;b.ValueBlock=F;b.VideotexString=vt;b.ViewWriter=Ve;b.VisibleString=He;b.compareSchema=De;b.fromBER=Qs;b.verifySchema=no});var Br=U(Lt=>{"use strict";Object.defineProperty(Lt,"__esModule",{value:!0});Lt.GROUP=void 0;Lt.errBadGroup=co;Lt.GROUP={P256:"P-256",P384:"P-384",P521:"P-521",RISTRETTO255:"ristretto255",DECAF448:"decaf448"};function co(r){return new Error(`group: bad group name ${r}.`)}a(co,"errBadGroup")});var Ie=U(z=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0});z.joinAll=lo;z.xor=uo;z.ctEqual=fo;z.zip=ho;z.to16bits=Er;z.toU16LenPrefix=vi;z.toU16LenPrefixUint8Array=go;z.toU16LenPrefixClass=po;z.fromU16LenPrefix=ki;z.fromU16LenPrefixDes=yo;z.fromU16LenPrefixUint8Array=wo;z.checkSize=bo;z.errDeserialization=mo;z.errGroup=Ai;z.compat=vo;function lo(r){let e=0;for(let i of r)e+=i.length;let t=new Uint8Array(new ArrayBuffer(e)),n=0;for(let i of r)t.set(i,n),n+=i.length;return t}a(lo,"joinAll");function uo(r,e){if(r.length!==e.length||r.length===0)throw new Error("arrays of different length");let t=r.length,n=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=r[i]^e[i];return n}a(uo,"xor");function fo(r,e){if(r.length!==e.length||r.length===0)return!1;let t=r.length,n=0;for(let i=0;i<t;i++)n|=r[i]^e[i];return n===0}a(fo,"ctEqual");function ho(r,e){return r.map((t,n)=>[t,e[n]])}a(ho,"zip");function Er(r){if(!(r>=0&&r<65535))throw new Error("number bigger than 2^16");return new Uint8Array([r>>8&255,r&255])}a(Er,"to16bits");function vi(r){return[Er(r.length),r]}a(vi,"toU16LenPrefix");function go(r){return[Er(r.length),...r.flatMap(e=>vi(e))]}a(go,"toU16LenPrefixUint8Array");function po(r){return[Er(r.length),...r.map(e=>e.serialize())]}a(po,"toU16LenPrefixClass");function ki(r){if(r.length<2)throw new Error("buffer shorter than expected");let e=r[0]<<8|r[1];if(r.length<2+e)throw new Error("buffer shorter than expected");let t=r.subarray(2,2+e),n=r.subarray(2+e);return{head:t,tail:n}}a(ki,"fromU16LenPrefix");function yo(r,e){if(e.length<2)throw new Error("buffer shorter than expected");let t=e[0]<<8|e[1],n=r.size();if(e.length<2+t*n)throw new Error("buffer shorter than expected");let i=[];for(let o=0;o<t;o++)i.push(r.deserialize(e.subarray(2+o*n,2+(o+1)*n)));let s=e.subarray(2+t*n);return{head:i,tail:s}}a(yo,"fromU16LenPrefixDes");function wo(r){if(r.length<2)throw new Error("buffer shorter than expected");let e=r[0]<<8|r[1],t=r.subarray(2),n=[];for(let i=0;i<e;i++){let{head:s,tail:o}=ki(t);n.push(s),t=o}return{head:n,tail:t}}a(wo,"fromU16LenPrefixUint8Array");function bo(r,e,t){if(r.length<e.size(t))throw new Error(`error deserializing ${e.name}: buffer shorter than expected`)}a(bo,"checkSize");function mo(r){return new Error(`group: deserialization of ${r.name} failed.`)}a(mo,"errDeserialization");function Ai(r,e){return new Error(`group: mismatch between groups ${r} and ${e}.`)}a(Ai,"errGroup");function vo(r,e){if(r.g.id!==e.g.id)throw Ai(r.g.id,e.g.id)}a(vo,"compat")});var Bi=U(ke=>{"use strict";Object.defineProperty(ke,"__esModule",{value:!0});ke.LABELS=ke.SUITE=ke.MODE=void 0;ke.MODE={OPRF:0,VOPRF:1,POPRF:2};ke.SUITE={P256_SHA256:"P256-SHA256",P384_SHA384:"P384-SHA384",P521_SHA512:"P521-SHA512",RISTRETTO255_SHA512:"ristretto255-SHA512",DECAF448_SHAKE256:"decaf448-SHAKE256"};ke.LABELS={Version:"OPRFV1-",FinalizeDST:"Finalize",HashToGroupDST:"HashToGroup-",HashToScalarDST:"HashToScalar-",DeriveKeyPairDST:"DeriveKeyPair",InfoLabel:"Info"}});var Ge=U(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});te.FinalizeData=te.EvaluationRequest=te.Evaluation=te.Oprf=void 0;te.getOprfParams=Ft;te.getSupportedSuites=ko;var Ei=zt(),Ot=Br(),I=Ie(),rn=Bi(),Ne=Sr();function nn(r,e){throw new Error(`unexpected ${r} identifier: ${e}`)}a(nn,"assertNever");function Ft(r){switch(r){case x.Suite.P256_SHA256:return[x.Suite.P256_SHA256,Ot.GROUP.P256,"SHA-256",32];case x.Suite.P384_SHA384:return[x.Suite.P384_SHA384,Ot.GROUP.P384,"SHA-384",48];case x.Suite.P521_SHA512:return[x.Suite.P521_SHA512,Ot.GROUP.P521,"SHA-512",64];case x.Suite.RISTRETTO255_SHA512:return[x.Suite.RISTRETTO255_SHA512,Ot.GROUP.RISTRETTO255,"SHA-512",64];case x.Suite.DECAF448_SHAKE256:return[x.Suite.DECAF448_SHAKE256,Ot.GROUP.DECAF448,"SHAKE256",64];default:nn("Oprf.Suite",r)}}a(Ft,"getOprfParams");function ko(r){return Object.values(x.Suite).filter(e=>r.supportedGroups.includes(Ft(e)[1]))}a(ko,"getSupportedSuites");var x=class r{static{a(this,"Oprf")}static set Crypto(e){(0,Ne.setCryptoProvider)(e)}static get Crypto(){return(0,Ne.getCryptoProvider)()}static validateMode(e){switch(e){case r.Mode.OPRF:case r.Mode.VOPRF:case r.Mode.POPRF:return e;default:nn("Oprf.Mode",e)}}static getGroup(e,...t){return(0,Ne.getSuiteGroup)(e,t)}static getHash(e){return Ft(e)[2]}static getOprfSize(e){return Ft(e)[3]}static getDST(e,t,n){let i=r.validateMode(e),s=new TextEncoder;return(0,I.joinAll)([s.encode(n+r.LABELS.Version),Uint8Array.of(i),s.encode("-"+t)])}constructor(e,t,...n){let[i,s,o]=Ft(t);this.crypto=(0,Ne.getCrypto)(n),this.group=this.crypto.Group.get(s),this.suite=i,this.hashID=o,this.mode=r.validateMode(e)}getDLEQParams(){return{group:this.group.id,hash:this.hashID,dst:this.getDST("")}}getDST(e){return r.getDST(this.mode,this.suite,e)}async coreFinalize(e,t,n){let i=[];this.mode===r.Mode.POPRF&&(i=(0,I.toU16LenPrefix)(n));let s=(0,I.joinAll)([...(0,I.toU16LenPrefix)(e),...i,...(0,I.toU16LenPrefix)(t),new TextEncoder().encode(r.LABELS.FinalizeDST)]);return await this.crypto.hash(this.hashID,s)}scalarFromInfo(e){if(e.length>=65536)throw new Error("invalid info length");let t=new TextEncoder,n=(0,I.joinAll)([t.encode(r.LABELS.InfoLabel),...(0,I.toU16LenPrefix)(e)]);return this.group.hashToScalar(n,this.getDST(r.LABELS.HashToScalarDST))}};te.Oprf=x;x.Mode=rn.MODE;x.Suite=rn.SUITE;x.LABELS=rn.LABELS;var en=class r{static{a(this,"Evaluation")}constructor(e,t,n){this.mode=e,this.evaluated=t,this.proof=n}serialize(){let e=new Uint8Array;return this.proof&&(this.mode==x.Mode.VOPRF||this.mode==x.Mode.POPRF)&&(e=this.proof.serialize()),(0,I.joinAll)([...(0,I.toU16LenPrefixClass)(this.evaluated),Uint8Array.from([this.mode]),e])}isEqual(e){if(this.mode!==e.mode||this.proof&&!e.proof||!this.proof&&e.proof)return!1;let t=this.evaluated.every((n,i)=>n.isEqual(e.evaluated[i]));return this.proof&&e.proof&&t&&(t=this.proof.isEqual(e.proof)),t}static deserialize(e,t,...n){let i=(0,Ne.getSuiteGroup)(e,n),{head:s,tail:o}=(0,I.fromU16LenPrefixDes)(i.eltDes,t),c,l=Ei.DLEQProof.size(i),f=o.subarray(1,1+l),h=o[0];switch(h){case x.Mode.OPRF:break;case x.Mode.VOPRF:case x.Mode.POPRF:c=Ei.DLEQProof.deserialize(i.id,f,...n);break;default:nn("Oprf.Mode",h)}return new r(h,s,c)}};te.Evaluation=en;var xr=class r{static{a(this,"EvaluationRequest")}constructor(e){this.blinded=e}serialize(){return(0,I.joinAll)((0,I.toU16LenPrefixClass)(this.blinded))}isEqual(e){return this.blinded.every((t,n)=>t.isEqual(e.blinded[n]))}static deserialize(e,t,...n){let i=(0,Ne.getSuiteGroup)(e,n),{head:s}=(0,I.fromU16LenPrefixDes)(i.eltDes,t);return new r(s)}};te.EvaluationRequest=xr;var tn=class r{static{a(this,"FinalizeData")}constructor(e,t,n){this.inputs=e,this.blinds=t,this.evalReq=n}serialize(){return(0,I.joinAll)([...(0,I.toU16LenPrefixUint8Array)(this.inputs),...(0,I.toU16LenPrefixClass)(this.blinds),this.evalReq.serialize()])}isEqual(e){return this.inputs.every((t,n)=>t.toString()===e.inputs[n].toString())&&this.blinds.every((t,n)=>t.isEqual(e.blinds[n]))&&this.evalReq.isEqual(e.evalReq)}static deserialize(e,t,...n){let i=(0,Ne.getSuiteGroup)(e,n),{head:s,tail:o}=(0,I.fromU16LenPrefixUint8Array)(t),{head:c,tail:l}=(0,I.fromU16LenPrefixDes)(i.scalarDes,o),f=xr.deserialize(e,l,...n);return new r(s,c,f)}};te.FinalizeData=tn});var xi=U((_r,sn)=>{"use strict";Object.defineProperty(_r,"__esModule",{value:!0});var u={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:a(function(r){this.toString=function(){return"CORRUPT: "+this.message},this.message=r},"corrupt"),invalid:a(function(r){this.toString=function(){return"INVALID: "+this.message},this.message=r},"invalid"),bug:a(function(r){this.toString=function(){return"BUG: "+this.message},this.message=r},"bug"),notReady:a(function(r){this.toString=function(){return"NOT READY: "+this.message},this.message=r},"notReady")}};u.cipher.aes=function(r){this._tables[0][0][0]||this._precompute();var e,t,n,i,s,o=this._tables[0][4],c=this._tables[1],l=r.length,f=1;if(l!==4&&l!==6&&l!==8)throw new u.exception.invalid("invalid aes key size");for(this._key=[i=r.slice(0),s=[]],e=l;e<4*l+28;e++)n=i[e-1],(e%l===0||l===8&&e%l===4)&&(n=o[n>>>24]<<24^o[n>>16&255]<<16^o[n>>8&255]<<8^o[n&255],e%l===0&&(n=n<<8^n>>>24^f<<24,f=f<<1^(f>>7)*283)),i[e]=i[e-l]^n;for(t=0;e;t++,e--)n=i[t&3?e:e-4],e<=4||t<4?s[t]=n:s[t]=c[0][o[n>>>24]]^c[1][o[n>>16&255]]^c[2][o[n>>8&255]]^c[3][o[n&255]]};u.cipher.aes.prototype={encrypt:a(function(r){return this._crypt(r,0)},"encrypt"),decrypt:a(function(r){return this._crypt(r,1)},"decrypt"),_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:a(function(){var r=this._tables[0],e=this._tables[1],t=r[4],n=e[4],i,s,o,c=[],l=[],f,h,d,g,w,y;for(i=0;i<256;i++)l[(c[i]=i<<1^(i>>7)*283)^i]=i;for(s=o=0;!t[s];s^=f||1,o=l[o]||1)for(g=o^o<<1^o<<2^o<<3^o<<4,g=g>>8^g&255^99,t[s]=g,n[g]=s,d=c[h=c[f=c[s]]],y=d*16843009^h*65537^f*257^s*16843008,w=c[g]*257^g*16843008,i=0;i<4;i++)r[i][s]=w=w<<24^w>>>8,e[i][g]=y=y<<24^y>>>8;for(i=0;i<5;i++)r[i]=r[i].slice(0),e[i]=e[i].slice(0)},"_precompute"),_crypt:a(function(r,e){if(r.length!==4)throw new u.exception.invalid("invalid aes block size");var t=this._key[e],n=r[0]^t[0],i=r[e?3:1]^t[1],s=r[2]^t[2],o=r[e?1:3]^t[3],c,l,f,h=t.length/4-2,d,g=4,w=[0,0,0,0],y=this._tables[e],m=y[0],v=y[1],C=y[2],E=y[3],N=y[4];for(d=0;d<h;d++)c=m[n>>>24]^v[i>>16&255]^C[s>>8&255]^E[o&255]^t[g],l=m[i>>>24]^v[s>>16&255]^C[o>>8&255]^E[n&255]^t[g+1],f=m[s>>>24]^v[o>>16&255]^C[n>>8&255]^E[i&255]^t[g+2],o=m[o>>>24]^v[n>>16&255]^C[i>>8&255]^E[s&255]^t[g+3],g+=4,n=c,i=l,s=f;for(d=0;d<4;d++)w[e?3&-d:d]=N[n>>>24]<<24^N[i>>16&255]<<16^N[s>>8&255]<<8^N[o&255]^t[g++],c=n,n=i,i=s,s=o,o=c;return w},"_crypt")};u.bitArray={bitSlice:a(function(r,e,t){return r=u.bitArray._shiftRight(r.slice(e/32),32-(e&31)).slice(1),t===void 0?r:u.bitArray.clamp(r,t-e)},"bitSlice"),extract:a(function(r,e,t){var n,i=Math.floor(-e-t&31);return(e+t-1^e)&-32?n=r[e/32|0]<<32-i^r[e/32+1|0]>>>i:n=r[e/32|0]>>>i,n&(1<<t)-1},"extract"),concat:a(function(r,e){if(r.length===0||e.length===0)return r.concat(e);var t=r[r.length-1],n=u.bitArray.getPartial(t);return n===32?r.concat(e):u.bitArray._shiftRight(e,n,t|0,r.slice(0,r.length-1))},"concat"),bitLength:a(function(r){var e=r.length,t;return e===0?0:(t=r[e-1],(e-1)*32+u.bitArray.getPartial(t))},"bitLength"),clamp:a(function(r,e){if(r.length*32<e)return r;r=r.slice(0,Math.ceil(e/32));var t=r.length;return e=e&31,t>0&&e&&(r[t-1]=u.bitArray.partial(e,r[t-1]&2147483648>>e-1,1)),r},"clamp"),partial:a(function(r,e,t){return r===32?e:(t?e|0:e<<32-r)+r*1099511627776},"partial"),getPartial:a(function(r){return Math.round(r/1099511627776)||32},"getPartial"),equal:a(function(r,e){if(u.bitArray.bitLength(r)!==u.bitArray.bitLength(e))return!1;var t=0,n;for(n=0;n<r.length;n++)t|=r[n]^e[n];return t===0},"equal"),_shiftRight:a(function(r,e,t,n){var i,s=0,o;for(n===void 0&&(n=[]);e>=32;e-=32)n.push(t),t=0;if(e===0)return n.concat(r);for(i=0;i<r.length;i++)n.push(t|r[i]>>>e),t=r[i]<<32-e;return s=r.length?r[r.length-1]:0,o=u.bitArray.getPartial(s),n.push(u.bitArray.partial(e+o&31,e+o>32?t:n.pop(),1)),n},"_shiftRight"),_xor4:a(function(r,e){return[r[0]^e[0],r[1]^e[1],r[2]^e[2],r[3]^e[3]]},"_xor4"),byteswapM:a(function(r){var e,t,n=65280;for(e=0;e<r.length;++e)t=r[e],r[e]=t>>>24|t>>>8&n|(t&n)<<8|t<<24;return r},"byteswapM")};u.codec.utf8String={fromBits:a(function(r){var e="",t=u.bitArray.bitLength(r),n,i;for(n=0;n<t/8;n++)(n&3)===0&&(i=r[n/4]),e+=String.fromCharCode(i>>>8>>>8>>>8),i<<=8;return decodeURIComponent(escape(e))},"fromBits"),toBits:a(function(r){r=unescape(encodeURIComponent(r));var e=[],t,n=0;for(t=0;t<r.length;t++)n=n<<8|r.charCodeAt(t),(t&3)===3&&(e.push(n),n=0);return t&3&&e.push(u.bitArray.partial(8*(t&3),n)),e},"toBits")};u.codec.hex={fromBits:a(function(r){var e="",t;for(t=0;t<r.length;t++)e+=((r[t]|0)+0xf00000000000).toString(16).substr(4);return e.substr(0,u.bitArray.bitLength(r)/4)},"fromBits"),toBits:a(function(r){var e,t=[],n;for(r=r.replace(/\s|0x/g,""),n=r.length,r=r+"00000000",e=0;e<r.length;e+=8)t.push(parseInt(r.substr(e,8),16)^0);return u.bitArray.clamp(t,n*4)},"toBits")};u.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:a(function(r,e,t){var n="",i,s=0,o=u.codec.base64._chars,c=0,l=u.bitArray.bitLength(r);for(t&&(o=o.substr(0,62)+"-_"),i=0;n.length*6<l;)n+=o.charAt((c^r[i]>>>s)>>>26),s<6?(c=r[i]<<6-s,s+=26,i++):(c<<=6,s-=6);for(;n.length&3&&!e;)n+="=";return n},"fromBits"),toBits:a(function(r,e){r=r.replace(/\s|=/g,"");var t=[],n,i=0,s=u.codec.base64._chars,o=0,c;for(e&&(s=s.substr(0,62)+"-_"),n=0;n<r.length;n++){if(c=s.indexOf(r.charAt(n)),c<0)throw new u.exception.invalid("this isn't base64!");i>26?(i-=26,t.push(o^c>>>i),o=c<<32-i):(i+=6,o^=c<<32-i)}return i&56&&t.push(u.bitArray.partial(i&56,o,1)),t},"toBits")};u.codec.base64url={fromBits:a(function(r){return u.codec.base64.fromBits(r,1,1)},"fromBits"),toBits:a(function(r){return u.codec.base64.toBits(r,1)},"toBits")};u.codec.bytes={fromBits:a(function(r){var e=[],t=u.bitArray.bitLength(r),n,i;for(n=0;n<t/8;n++)(n&3)===0&&(i=r[n/4]),e.push(i>>>24),i<<=8;return e},"fromBits"),toBits:a(function(r){var e=[],t,n=0;for(t=0;t<r.length;t++)n=n<<8|r[t],(t&3)===3&&(e.push(n),n=0);return t&3&&e.push(u.bitArray.partial(8*(t&3),n)),e},"toBits")};u.hash.sha256=function(r){this._key[0]||this._precompute(),r?(this._h=r._h.slice(0),this._buffer=r._buffer.slice(0),this._length=r._length):this.reset()};u.hash.sha256.hash=function(r){return new u.hash.sha256().update(r).finalize()};u.hash.sha256.prototype={blockSize:512,reset:a(function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},"reset"),update:a(function(r){typeof r=="string"&&(r=u.codec.utf8String.toBits(r));var e,t=this._buffer=u.bitArray.concat(this._buffer,r),n=this._length,i=this._length=n+u.bitArray.bitLength(r);if(i>9007199254740991)throw new u.exception.invalid("Cannot hash more than 2^53 - 1 bits");if(typeof Uint32Array<"u"){var s=new Uint32Array(t),o=0;for(e=512+n-(512+n&511);e<=i;e+=512)this._block(s.subarray(16*o,16*(o+1))),o+=1;t.splice(0,16*o)}else for(e=512+n-(512+n&511);e<=i;e+=512)this._block(t.splice(0,16));return this},"update"),finalize:a(function(){var r,e=this._buffer,t=this._h;for(e=u.bitArray.concat(e,[u.bitArray.partial(1,1)]),r=e.length+2;r&15;r++)e.push(0);for(e.push(Math.floor(this._length/4294967296)),e.push(this._length|0);e.length;)this._block(e.splice(0,16));return this.reset(),t},"finalize"),_init:[],_key:[],_precompute:a(function(){var r=0,e=2,t,n;function i(s){return(s-Math.floor(s))*4294967296|0}for(a(i,"frac");r<64;e++){for(n=!0,t=2;t*t<=e;t++)if(e%t===0){n=!1;break}n&&(r<8&&(this._init[r]=i(Math.pow(e,1/2))),this._key[r]=i(Math.pow(e,1/3)),r++)}},"_precompute"),_block:a(function(r){var e,t,n,i,s=this._h,o=this._key,c=s[0],l=s[1],f=s[2],h=s[3],d=s[4],g=s[5],w=s[6],y=s[7];for(e=0;e<64;e++)e<16?t=r[e]:(n=r[e+1&15],i=r[e+14&15],t=r[e&15]=(n>>>7^n>>>18^n>>>3^n<<25^n<<14)+(i>>>17^i>>>19^i>>>10^i<<15^i<<13)+r[e&15]+r[e+9&15]|0),t=t+y+(d>>>6^d>>>11^d>>>25^d<<26^d<<21^d<<7)+(w^d&(g^w))+o[e],y=w,w=g,g=d,d=h+t|0,h=f,f=l,l=c,c=t+(l&f^h&(l^f))+(l>>>2^l>>>13^l>>>22^l<<30^l<<19^l<<10)|0;s[0]=s[0]+c|0,s[1]=s[1]+l|0,s[2]=s[2]+f|0,s[3]=s[3]+h|0,s[4]=s[4]+d|0,s[5]=s[5]+g|0,s[6]=s[6]+w|0,s[7]=s[7]+y|0},"_block")};u.mode.ccm={name:"ccm",_progressListeners:[],listenProgress:a(function(r){u.mode.ccm._progressListeners.push(r)},"listenProgress"),unListenProgress:a(function(r){var e=u.mode.ccm._progressListeners.indexOf(r);e>-1&&u.mode.ccm._progressListeners.splice(e,1)},"unListenProgress"),_callProgressListener:a(function(r){var e=u.mode.ccm._progressListeners.slice(),t;for(t=0;t<e.length;t+=1)e[t](r)},"_callProgressListener"),encrypt:a(function(r,e,t,n,i){var s,o=e.slice(0),c,l=u.bitArray,f=l.bitLength(t)/8,h=l.bitLength(o)/8;if(i=i||64,n=n||[],f<7)throw new u.exception.invalid("ccm: iv must be at least 7 bytes");for(s=2;s<4&&h>>>8*s;s++);return s<15-f&&(s=15-f),t=l.clamp(t,8*(15-s)),c=u.mode.ccm._computeTag(r,e,t,n,i,s),o=u.mode.ccm._ctrMode(r,o,t,c,i,s),l.concat(o.data,o.tag)},"encrypt"),decrypt:a(function(r,e,t,n,i){i=i||64,n=n||[];var s,o=u.bitArray,c=o.bitLength(t)/8,l=o.bitLength(e),f=o.clamp(e,l-i),h=o.bitSlice(e,l-i),d;if(l=(l-i)/8,c<7)throw new u.exception.invalid("ccm: iv must be at least 7 bytes");for(s=2;s<4&&l>>>8*s;s++);if(s<15-c&&(s=15-c),t=o.clamp(t,8*(15-s)),f=u.mode.ccm._ctrMode(r,f,t,h,i,s),d=u.mode.ccm._computeTag(r,f.data,t,n,i,s),!o.equal(f.tag,d))throw new u.exception.corrupt("ccm: tag doesn't match");return f.data},"decrypt"),_macAdditionalData:a(function(r,e,t,n,i,s){var o,c,l,f=[],h=u.bitArray,d=h._xor4;if(o=[h.partial(8,(e.length?64:0)|n-2<<2|s-1)],o=h.concat(o,t),o[3]|=i,o=r.encrypt(o),e.length)for(c=h.bitLength(e)/8,c<=65279?f=[h.partial(16,c)]:c<=4294967295&&(f=h.concat([h.partial(16,65534)],[c])),f=h.concat(f,e),l=0;l<f.length;l+=4)o=r.encrypt(d(o,f.slice(l,l+4).concat([0,0,0])));return o},"_macAdditionalData"),_computeTag:a(function(r,e,t,n,i,s){var o,c,l=u.bitArray,f=l._xor4;if(i/=8,i%2||i<4||i>16)throw new u.exception.invalid("ccm: invalid tag length");if(n.length>4294967295||e.length>4294967295)throw new u.exception.bug("ccm: can't deal with 4GiB or more data");for(o=u.mode.ccm._macAdditionalData(r,n,t,i,l.bitLength(e)/8,s),c=0;c<e.length;c+=4)o=r.encrypt(f(o,e.slice(c,c+4).concat([0,0,0])));return l.clamp(o,i*8)},"_computeTag"),_ctrMode:a(function(r,e,t,n,i,s){var o,c,l=u.bitArray,f=l._xor4,h,d=e.length,g=l.bitLength(e),w=d/50,y=w;if(h=l.concat([l.partial(8,s-1)],t).concat([0,0,0]).slice(0,4),n=l.bitSlice(f(n,r.encrypt(h)),0,i),!d)return{tag:n,data:[]};for(c=0;c<d;c+=4)c>w&&(u.mode.ccm._callProgressListener(c/d),w+=y),h[3]++,o=r.encrypt(h),e[c]^=o[0],e[c+1]^=o[1],e[c+2]^=o[2],e[c+3]^=o[3];return{tag:n,data:l.clamp(e,g)}},"_ctrMode")};u.misc.hmac=function(r,e){this._hash=e=e||u.hash.sha256;var t=[[],[]],n,i=e.prototype.blockSize/32;for(this._baseHash=[new e,new e],r.length>i&&(r=e.hash(r)),n=0;n<i;n++)t[0][n]=r[n]^909522486,t[1][n]=r[n]^1549556828;this._baseHash[0].update(t[0]),this._baseHash[1].update(t[1]),this._resultHash=new e(this._baseHash[0])};u.misc.hmac.prototype.encrypt=u.misc.hmac.prototype.mac=function(r){if(this._updated)throw new u.exception.invalid("encrypt on already updated hmac called!");return this.update(r),this.digest(r)};u.misc.hmac.prototype.reset=function(){this._resultHash=new this._hash(this._baseHash[0]),this._updated=!1};u.misc.hmac.prototype.update=function(r){this._updated=!0,this._resultHash.update(r)};u.misc.hmac.prototype.digest=function(){var r=this._resultHash.finalize(),e=new this._hash(this._baseHash[1]).update(r).finalize();return this.reset(),e};u.misc.pbkdf2=function(r,e,t,n,i){if(t=t||1e4,n<0||t<0)throw new u.exception.invalid("invalid params to pbkdf2");typeof r=="string"&&(r=u.codec.utf8String.toBits(r)),typeof e=="string"&&(e=u.codec.utf8String.toBits(e)),i=i||u.misc.hmac;var s=new i(r),o,c,l,f,h,d=[],g=u.bitArray;for(h=1;32*d.length<(n||1);h++){for(o=c=s.encrypt(g.concat(e,[h])),l=1;l<t;l++)for(c=s.encrypt(c),f=0;f<c.length;f++)o[f]^=c[f];d=d.concat(o)}return n&&(d=g.clamp(d,n)),d};u.prng=function(r){this._pools=[new u.hash.sha256],this._poolEntropy=[0],this._reseedCount=0,this._robins={},this._eventId=0,this._collectorIds={},this._collectorIdNext=0,this._strength=0,this._poolStrength=0,this._nextReseed=0,this._key=[0,0,0,0,0,0,0,0],this._counter=[0,0,0,0],this._cipher=void 0,this._defaultParanoia=r,this._collectorsStarted=!1,this._callbacks={progress:{},seeded:{}},this._callbackI=0,this._NOT_READY=0,this._READY=1,this._REQUIRES_RESEED=2,this._MAX_WORDS_PER_BURST=65536,this._PARANOIA_LEVELS=[0,48,64,96,128,192,256,384,512,768,1024],this._MILLISECONDS_PER_RESEED=3e4,this._BITS_PER_RESEED=80};u.prng.prototype={randomWords:a(function(r,e){var t=[],n,i=this.isReady(e),s;if(i===this._NOT_READY)throw new u.exception.notReady("generator isn't seeded");for(i&this._REQUIRES_RESEED&&this._reseedFromPools(!(i&this._READY)),n=0;n<r;n+=4)(n+1)%this._MAX_WORDS_PER_BURST===0&&this._gate(),s=this._gen4words(),t.push(s[0],s[1],s[2],s[3]);return this._gate(),t.slice(0,r)},"randomWords"),setDefaultParanoia:a(function(r,e){if(r===0&&e!=="Setting paranoia=0 will ruin your security; use it only for testing")throw new u.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this._defaultParanoia=r},"setDefaultParanoia"),addEntropy:a(function(r,e,t){t=t||"user";var n,i,s,o=new Date().valueOf(),c=this._robins[t],l=this.isReady(),f=0,h;switch(n=this._collectorIds[t],n===void 0&&(n=this._collectorIds[t]=this._collectorIdNext++),c===void 0&&(c=this._robins[t]=0),this._robins[t]=(this._robins[t]+1)%this._pools.length,typeof r){case"number":e===void 0&&(e=1),this._pools[c].update([n,this._eventId++,1,e,o,1,r|0]);break;case"object":if(h=Object.prototype.toString.call(r),h==="[object Uint32Array]"){for(s=[],i=0;i<r.length;i++)s.push(r[i]);r=s}else for(h!=="[object Array]"&&(f=1),i=0;i<r.length&&!f;i++)typeof r[i]!="number"&&(f=1);if(!f){if(e===void 0)for(e=0,i=0;i<r.length;i++)for(s=r[i];s>0;)e++,s=s>>>1;this._pools[c].update([n,this._eventId++,2,e,o,r.length].concat(r))}break;case"string":e===void 0&&(e=r.length),this._pools[c].update([n,this._eventId++,3,e,o,r.length]),this._pools[c].update(r);break;default:f=1}if(f)throw new u.exception.bug("random: addEntropy only supports number, array of numbers or string");this._poolEntropy[c]+=e,this._poolStrength+=e,l===this._NOT_READY&&(this.isReady()!==this._NOT_READY&&this._fireEvent("seeded",Math.max(this._strength,this._poolStrength)),this._fireEvent("progress",this.getProgress()))},"addEntropy"),isReady:a(function(r){var e=this._PARANOIA_LEVELS[r!==void 0?r:this._defaultParanoia];return this._strength&&this._strength>=e?this._poolEntropy[0]>this._BITS_PER_RESEED&&new Date().valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY:this._poolStrength>=e?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY},"isReady"),getProgress:a(function(r){var e=this._PARANOIA_LEVELS[r||this._defaultParanoia];return this._strength>=e||this._poolStrength>e?1:this._poolStrength/e},"getProgress"),startCollectors:a(function(){if(!this._collectorsStarted){if(this._eventListener={loadTimeCollector:this._bind(this._loadTimeCollector),mouseCollector:this._bind(this._mouseCollector),keyboardCollector:this._bind(this._keyboardCollector),accelerometerCollector:this._bind(this._accelerometerCollector),touchCollector:this._bind(this._touchCollector)},window.addEventListener)window.addEventListener("load",this._eventListener.loadTimeCollector,!1),window.addEventListener("mousemove",this._eventListener.mouseCollector,!1),window.addEventListener("keypress",this._eventListener.keyboardCollector,!1),window.addEventListener("devicemotion",this._eventListener.accelerometerCollector,!1),window.addEventListener("touchmove",this._eventListener.touchCollector,!1);else if(document.attachEvent)document.attachEvent("onload",this._eventListener.loadTimeCollector),document.attachEvent("onmousemove",this._eventListener.mouseCollector),document.attachEvent("keypress",this._eventListener.keyboardCollector);else throw new u.exception.bug("can't attach event");this._collectorsStarted=!0}},"startCollectors"),stopCollectors:a(function(){this._collectorsStarted&&(window.removeEventListener?(window.removeEventListener("load",this._eventListener.loadTimeCollector,!1),window.removeEventListener("mousemove",this._eventListener.mouseCollector,!1),window.removeEventListener("keypress",this._eventListener.keyboardCollector,!1),window.removeEventListener("devicemotion",this._eventListener.accelerometerCollector,!1),window.removeEventListener("touchmove",this._eventListener.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this._eventListener.loadTimeCollector),document.detachEvent("onmousemove",this._eventListener.mouseCollector),document.detachEvent("keypress",this._eventListener.keyboardCollector)),this._collectorsStarted=!1)},"stopCollectors"),addEventListener:a(function(r,e){this._callbacks[r][this._callbackI++]=e},"addEventListener"),removeEventListener:a(function(r,e){var t,n,i=this._callbacks[r],s=[];for(n in i)i.hasOwnProperty(n)&&i[n]===e&&s.push(n);for(t=0;t<s.length;t++)n=s[t],delete i[n]},"removeEventListener"),_bind:a(function(r){var e=this;return function(){r.apply(e,arguments)}},"_bind"),_gen4words:a(function(){for(var r=0;r<4&&(this._counter[r]=this._counter[r]+1|0,!this._counter[r]);r++);return this._cipher.encrypt(this._counter)},"_gen4words"),_gate:a(function(){this._key=this._gen4words().concat(this._gen4words()),this._cipher=new u.cipher.aes(this._key)},"_gate"),_reseed:a(function(r){this._key=u.hash.sha256.hash(this._key.concat(r)),this._cipher=new u.cipher.aes(this._key);for(var e=0;e<4&&(this._counter[e]=this._counter[e]+1|0,!this._counter[e]);e++);},"_reseed"),_reseedFromPools:a(function(r){var e=[],t=0,n;for(this._nextReseed=e[0]=new Date().valueOf()+this._MILLISECONDS_PER_RESEED,n=0;n<16;n++)e.push(Math.random()*4294967296|0);for(n=0;n<this._pools.length&&(e=e.concat(this._pools[n].finalize()),t+=this._poolEntropy[n],this._poolEntropy[n]=0,!(!r&&this._reseedCount&1<<n));n++);this._reseedCount>=1<<this._pools.length&&(this._pools.push(new u.hash.sha256),this._poolEntropy.push(0)),this._poolStrength-=t,t>this._strength&&(this._strength=t),this._reseedCount++,this._reseed(e)},"_reseedFromPools"),_keyboardCollector:a(function(){this._addCurrentTimeToEntropy(1)},"_keyboardCollector"),_mouseCollector:a(function(r){var e,t;try{e=r.x||r.clientX||r.offsetX||0,t=r.y||r.clientY||r.offsetY||0}catch{e=0,t=0}e!=0&&t!=0&&this.addEntropy([e,t],2,"mouse"),this._addCurrentTimeToEntropy(0)},"_mouseCollector"),_touchCollector:a(function(r){var e=r.touches[0]||r.changedTouches[0],t=e.pageX||e.clientX,n=e.pageY||e.clientY;this.addEntropy([t,n],1,"touch"),this._addCurrentTimeToEntropy(0)},"_touchCollector"),_loadTimeCollector:a(function(){this._addCurrentTimeToEntropy(2)},"_loadTimeCollector"),_addCurrentTimeToEntropy:a(function(r){typeof window<"u"&&window.performance&&typeof window.performance.now=="function"?this.addEntropy(window.performance.now(),r,"loadtime"):this.addEntropy(new Date().valueOf(),r,"loadtime")},"_addCurrentTimeToEntropy"),_accelerometerCollector:a(function(r){var e=r.accelerationIncludingGravity.x||r.accelerationIncludingGravity.y||r.accelerationIncludingGravity.z;if(window.orientation){var t=window.orientation;typeof t=="number"&&this.addEntropy(t,1,"accelerometer")}e&&this.addEntropy(e,2,"accelerometer"),this._addCurrentTimeToEntropy(0)},"_accelerometerCollector"),_fireEvent:a(function(r,e){var t,n=u.random._callbacks[r],i=[];for(t in n)n.hasOwnProperty(t)&&i.push(n[t]);for(t=0;t<i.length;t++)i[t](e)},"_fireEvent")};u.random=new u.prng(6);(function(){function r(){try{return require("crypto")}catch{return null}}a(r,"getCryptoModule");try{var e,t,n;if(typeof sn<"u"&&sn.exports&&(t=r())&&t.randomBytes)e=t.randomBytes(1024/8),e=new Uint32Array(new Uint8Array(e).buffer),u.random.addEntropy(e,1024,"crypto.randomBytes");else if(typeof window<"u"&&typeof Uint32Array<"u"){if(n=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(n);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(n);else return;u.random.addEntropy(n,1024,"crypto.getRandomValues")}}catch(i){typeof window<"u"&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(i))}})();u.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},_encrypt:a(function(r,e,t,n){t=t||{},n=n||{};var i=u.json,s=i._add({iv:u.random.randomWords(4,0)},i.defaults),o,c,l;if(i._add(s,t),l=s.adata,typeof s.salt=="string"&&(s.salt=u.codec.base64.toBits(s.salt)),typeof s.iv=="string"&&(s.iv=u.codec.base64.toBits(s.iv)),!u.mode[s.mode]||!u.cipher[s.cipher]||typeof r=="string"&&s.iter<=100||s.ts!==64&&s.ts!==96&&s.ts!==128||s.ks!==128&&s.ks!==192&&s.ks!==256||s.iv.length<2||s.iv.length>4)throw new u.exception.invalid("json encrypt: invalid parameters");return typeof r=="string"?(o=u.misc.cachedPbkdf2(r,s),r=o.key.slice(0,s.ks/32),s.salt=o.salt):u.ecc&&r instanceof u.ecc.elGamal.publicKey&&(o=r.kem(),s.kemtag=o.tag,r=o.key.slice(0,s.ks/32)),typeof e=="string"&&(e=u.codec.utf8String.toBits(e)),typeof l=="string"&&(s.adata=l=u.codec.utf8String.toBits(l)),c=new u.cipher[s.cipher](r),i._add(n,s),n.key=r,s.mode==="ccm"&&u.arrayBuffer&&u.arrayBuffer.ccm&&e instanceof ArrayBuffer?s.ct=u.arrayBuffer.ccm.encrypt(c,e,s.iv,l,s.ts):s.ct=u.mode[s.mode].encrypt(c,e,s.iv,l,s.ts),s},"_encrypt"),encrypt:a(function(r,e,t,n){var i=u.json,s=i._encrypt.apply(i,arguments);return i.encode(s)},"encrypt"),_decrypt:a(function(r,e,t,n){t=t||{},n=n||{};var i=u.json,s=i._add(i._add(i._add({},i.defaults),e),t,!0),o,c,l,f=s.adata;if(typeof s.salt=="string"&&(s.salt=u.codec.base64.toBits(s.salt)),typeof s.iv=="string"&&(s.iv=u.codec.base64.toBits(s.iv)),!u.mode[s.mode]||!u.cipher[s.cipher]||typeof r=="string"&&s.iter<=100||s.ts!==64&&s.ts!==96&&s.ts!==128||s.ks!==128&&s.ks!==192&&s.ks!==256||!s.iv||s.iv.length<2||s.iv.length>4)throw new u.exception.invalid("json decrypt: invalid parameters");return typeof r=="string"?(c=u.misc.cachedPbkdf2(r,s),r=c.key.slice(0,s.ks/32),s.salt=c.salt):u.ecc&&r instanceof u.ecc.elGamal.secretKey&&(r=r.unkem(u.codec.base64.toBits(s.kemtag)).slice(0,s.ks/32)),typeof f=="string"&&(f=u.codec.utf8String.toBits(f)),l=new u.cipher[s.cipher](r),s.mode==="ccm"&&u.arrayBuffer&&u.arrayBuffer.ccm&&s.ct instanceof ArrayBuffer?o=u.arrayBuffer.ccm.decrypt(l,s.ct,s.iv,s.tag,f,s.ts):o=u.mode[s.mode].decrypt(l,s.ct,s.iv,f,s.ts),i._add(n,s),n.key=r,t.raw===1?o:u.codec.utf8String.fromBits(o)},"_decrypt"),decrypt:a(function(r,e,t,n){var i=u.json;return i._decrypt(r,i.decode(e),t,n)},"decrypt"),encode:a(function(r){var e,t="{",n="";for(e in r)if(r.hasOwnProperty(e)){if(!e.match(/^[a-z0-9]+$/i))throw new u.exception.invalid("json encode: invalid property name");switch(t+=n+'"'+e+'":',n=",",typeof r[e]){case"number":case"boolean":t+=r[e];break;case"string":t+='"'+escape(r[e])+'"';break;case"object":t+='"'+u.codec.base64.fromBits(r[e],0)+'"';break;default:throw new u.exception.bug("json encode: unsupported type")}}return t+"}"},"encode"),decode:a(function(r){if(r=r.replace(/\s/g,""),!r.match(/^\{.*\}$/))throw new u.exception.invalid("json decode: this isn't json!");var e=r.replace(/^\{|\}$/g,"").split(/,/),t={},n,i;for(n=0;n<e.length;n++){if(!(i=e[n].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i)))throw new u.exception.invalid("json decode: this isn't json!");i[3]!=null?t[i[2]]=parseInt(i[3],10):i[4]!=null?t[i[2]]=i[2].match(/^(ct|adata|salt|iv)$/)?u.codec.base64.toBits(i[4]):unescape(i[4]):i[5]!=null&&(t[i[2]]=i[5]==="true")}return t},"decode"),_add:a(function(r,e,t){if(r===void 0&&(r={}),e===void 0)return r;var n;for(n in e)if(e.hasOwnProperty(n)){if(t&&r[n]!==void 0&&r[n]!==e[n])throw new u.exception.invalid("required parameter overridden");r[n]=e[n]}return r},"_add"),_subtract:a(function(r,e){var t={},n;for(n in r)r.hasOwnProperty(n)&&r[n]!==e[n]&&(t[n]=r[n]);return t},"_subtract"),_filter:a(function(r,e){var t={},n;for(n=0;n<e.length;n++)r[e[n]]!==void 0&&(t[e[n]]=r[e[n]]);return t},"_filter")};u.encrypt=u.json.encrypt;u.decrypt=u.json.decrypt;u.misc._pbkdf2Cache={};u.misc.cachedPbkdf2=function(r,e){var t=u.misc._pbkdf2Cache,n,i,s,o,c;return e=e||{},c=e.iter||1e3,i=t[r]=t[r]||{},n=i[c]=i[c]||{firstSalt:e.salt&&e.salt.length?e.salt.slice(0):u.random.randomWords(2,0)},o=e.salt===void 0?n.firstSalt:e.salt,n[o]=n[o]||u.misc.pbkdf2(r,o,e.iter),{key:n[o].slice(0),salt:o.slice(0)}};u.bn=function(r){this.initWith(r)};u.bn.prototype={radix:24,maxMul:8,_class:u.bn,copy:a(function(){return new this._class(this)},"copy"),initWith:a(function(r){var e=0,t;switch(typeof r){case"object":this.limbs=r.limbs.slice(0);break;case"number":this.limbs=[r],this.normalize();break;case"string":for(r=r.replace(/^0x/,""),this.limbs=[],t=this.radix/4,e=0;e<r.length;e+=t)this.limbs.push(parseInt(r.substring(Math.max(r.length-e-t,0),r.length-e),16));break;default:this.limbs=[0]}return this},"initWith"),equals:a(function(r){typeof r=="number"&&(r=new this._class(r));var e=0,t;for(this.fullReduce(),r.fullReduce(),t=0;t<this.limbs.length||t<r.limbs.length;t++)e|=this.getLimb(t)^r.getLimb(t);return e===0},"equals"),getLimb:a(function(r){return r>=this.limbs.length?0:this.limbs[r]},"getLimb"),greaterEquals:a(function(r){typeof r=="number"&&(r=new this._class(r));var e=0,t=0,n,i,s;for(n=Math.max(this.limbs.length,r.limbs.length)-1;n>=0;n--)i=this.getLimb(n),s=r.getLimb(n),t|=s-i&~e,e|=i-s&~t;return(t|~e)>>>31},"greaterEquals"),toString:a(function(){this.fullReduce();var r="",e,t,n=this.limbs;for(e=0;e<this.limbs.length;e++){for(t=n[e].toString(16);e<this.limbs.length-1&&t.length<6;)t="0"+t;r=t+r}return"0x"+r},"toString"),addM:a(function(r){typeof r!="object"&&(r=new this._class(r));var e,t=this.limbs,n=r.limbs;for(e=t.length;e<n.length;e++)t[e]=0;for(e=0;e<n.length;e++)t[e]+=n[e];return this},"addM"),doubleM:a(function(){var r,e=0,t,n=this.radix,i=this.radixMask,s=this.limbs;for(r=0;r<s.length;r++)t=s[r],t=t+t+e,s[r]=t&i,e=t>>n;return e&&s.push(e),this},"doubleM"),halveM:a(function(){var r,e=0,t,n=this.radix,i=this.limbs;for(r=i.length-1;r>=0;r--)t=i[r],i[r]=t+e>>1,e=(t&1)<<n;return i[i.length-1]||i.pop(),this},"halveM"),subM:a(function(r){typeof r!="object"&&(r=new this._class(r));var e,t=this.limbs,n=r.limbs;for(e=t.length;e<n.length;e++)t[e]=0;for(e=0;e<n.length;e++)t[e]-=n[e];return this},"subM"),mod:a(function(r){var e=!this.greaterEquals(new u.bn(0));r=new u.bn(r).normalize();var t=new u.bn(this).normalize(),n=0;for(e&&(t=new u.bn(0).subM(t).normalize());t.greaterEquals(r);n++)r.doubleM();for(e&&(t=r.sub(t).normalize());n>0;n--)r.halveM(),t.greaterEquals(r)&&t.subM(r).normalize();return t.trim()},"mod"),inverseMod:a(function(r){var e=new u.bn(1),t=new u.bn(0),n=new u.bn(this),i=new u.bn(r),s,o,c=1;if(!(r.limbs[0]&1))throw new u.exception.invalid("inverseMod: p must be odd");do for(n.limbs[0]&1&&(n.greaterEquals(i)||(s=n,n=i,i=s,s=e,e=t,t=s),n.subM(i),n.normalize(),e.greaterEquals(t)||e.addM(r),e.subM(t)),n.halveM(),e.limbs[0]&1&&e.addM(r),e.normalize(),e.halveM(),o=c=0;o<n.limbs.length;o++)c|=n.limbs[o];while(c);if(!i.equals(1))throw new u.exception.invalid("inverseMod: p and x must be relatively prime");return t},"inverseMod"),add:a(function(r){return this.copy().addM(r)},"add"),sub:a(function(r){return this.copy().subM(r)},"sub"),mul:a(function(r){typeof r=="number"?r=new this._class(r):r.normalize(),this.normalize();var e,t,n=this.limbs,i=r.limbs,s=n.length,o=i.length,c=new this._class,l=c.limbs,f,h=this.maxMul;for(e=0;e<this.limbs.length+r.limbs.length+1;e++)l[e]=0;for(e=0;e<s;e++){for(f=n[e],t=0;t<o;t++)l[e+t]+=f*i[t];--h||(h=this.maxMul,c.cnormalize())}return c.cnormalize().reduce()},"mul"),square:a(function(){return this.mul(this)},"square"),power:a(function(r){r=new u.bn(r).normalize().trim().limbs;var e,t,n=new this._class(1),i=this;for(e=0;e<r.length;e++)for(t=0;t<this.radix&&(r[e]&1<<t&&(n=n.mul(i)),!(e==r.length-1&&r[e]>>t+1==0));t++)i=i.square();return n},"power"),mulmod:a(function(r,e){return this.mod(e).mul(r.mod(e)).mod(e)},"mulmod"),powermod:a(function(r,e){if(r=new u.bn(r),e=new u.bn(e),(e.limbs[0]&1)==1){var t=this.montpowermod(r,e);if(t!=!1)return t}var n,i,s=r.normalize().trim().limbs,o=new this._class(1),c=this;for(n=0;n<s.length;n++)for(i=0;i<this.radix&&(s[n]&1<<i&&(o=o.mulmod(c,e)),!(n==s.length-1&&s[n]>>i+1==0));i++)c=c.mulmod(c,e);return o},"powermod"),montpowermod:a(function(r,e){r=new u.bn(r).normalize().trim(),e=new u.bn(e);var t,n,i=this.radix,s=new this._class(1),o=this.copy(),c,l,f,h=r.bitLength();for(c=new u.bn({limbs:e.copy().normalize().trim().limbs.map(function(){return 0})}),l=this.radix;l>0;l--)if((e.limbs[e.limbs.length-1]>>l&1)==1){c.limbs[c.limbs.length-1]=1<<l;break}if(h==0)return this;h<18?f=1:h<48?f=3:h<144?f=4:h<768?f=5:f=6;for(var d=c.copy(),g=e.copy(),w=new u.bn(1),y=new u.bn(0),m=c.copy();m.greaterEquals(1);)m.halveM(),(w.limbs[0]&1)==0?(w.halveM(),y.halveM()):(w.addM(g),w.halveM(),y.halveM(),y.addM(d));w=w.normalize(),y=y.normalize(),d.doubleM();var v=d.mulmod(d,e);if(!d.mul(w).sub(e.mul(y)).equals(1))return!1;var C=a(function(Y){return E(Y,v)},"montIn"),E=a(function(Y,X){var L,de,ie,O,Gt=(1<<l+1)-1;for(de=Y.mul(X),ie=de.mul(y),ie.limbs=ie.limbs.slice(0,c.limbs.length),ie.limbs.length==c.limbs.length&&(ie.limbs[c.limbs.length-1]&=Gt),ie=ie.mul(e),O=de.add(ie).normalize().trim(),O.limbs=O.limbs.slice(c.limbs.length-1),L=0;L<O.limbs.length;L++)L>0&&(O.limbs[L-1]|=(O.limbs[L]&Gt)<<i-l-1),O.limbs[L]=O.limbs[L]>>l+1;return O.greaterEquals(e)&&O.subM(e),O},"montMul"),N=a(function(Y){return E(Y,1)},"montOut");o=C(o),s=C(s);var $,ne={},Se=(1<<f-1)-1;for(ne[1]=o.copy(),ne[2]=E(o,o),$=1;$<=Se;$++)ne[2*$+1]=E(ne[2*$-1],ne[2]);var V=a(function(Y,X){var L=X%Y.radix;return(Y.limbs[Math.floor(X/Y.radix)]&1<<L)>>L},"getBit");for(t=r.bitLength()-1;t>=0;)if(V(r,t)==0)s=E(s,s),t=t-1;else{for(var _e=t-f+1;V(r,_e)==0;)_e++;var Re=0;for(n=_e;n<=t;n++)Re+=V(r,n)<<n-_e,s=E(s,s);s=E(s,ne[Re]),t=_e-1}return N(s)},"montpowermod"),trim:a(function(){var r=this.limbs,e;do e=r.pop();while(r.length&&e===0);return r.push(e),this},"trim"),reduce:a(function(){return this},"reduce"),fullReduce:a(function(){return this.normalize()},"fullReduce"),normalize:a(function(){var r=0,e,t=this.placeVal,n=this.ipv,i,s,o=this.limbs,c=o.length,l=this.radixMask;for(e=0;e<c||r!==0&&r!==-1;e++)i=(o[e]||0)+r,s=o[e]=i&l,r=(i-s)*n;return r===-1&&(o[e-1]-=t),this.trim(),this},"normalize"),cnormalize:a(function(){var r=0,e,t=this.ipv,n,i,s=this.limbs,o=s.length,c=this.radixMask;for(e=0;e<o-1;e++)n=s[e]+r,i=s[e]=n&c,r=(n-i)*t;return s[e]+=r,this},"cnormalize"),toBits:a(function(r){this.fullReduce(),r=r||this.exponent||this.bitLength();var e=Math.floor((r-1)/24),t=u.bitArray,n=(r+7&-8)%this.radix||this.radix,i=[t.partial(n,this.getLimb(e))];for(e--;e>=0;e--)i=t.concat(i,[t.partial(Math.min(this.radix,r),this.getLimb(e))]),r-=this.radix;return i},"toBits"),bitLength:a(function(){this.fullReduce();for(var r=this.radix*(this.limbs.length-1),e=this.limbs[this.limbs.length-1];e;e>>>=1)r++;return r+7&-8},"bitLength")};u.bn.fromBits=function(r){var e=this,t=new e,n=[],i=u.bitArray,s=this.prototype,o=Math.min(this.bitLength||4294967296,i.bitLength(r)),c=o%s.radix||s.radix;for(n[0]=i.extract(r,0,c);c<o;c+=s.radix)n.unshift(i.extract(r,c,s.radix));return t.limbs=n,t};u.bn.prototype.ipv=1/(u.bn.prototype.placeVal=Math.pow(2,u.bn.prototype.radix));u.bn.prototype.radixMask=(1<<u.bn.prototype.radix)-1;u.bn.pseudoMersennePrime=function(r,e){function t(c){this.initWith(c)}a(t,"p");var n=t.prototype=new u.bn,i,s,o;for(o=n.modOffset=Math.ceil(s=r/n.radix),n.exponent=r,n.offset=[],n.factor=[],n.minOffset=o,n.fullMask=0,n.fullOffset=[],n.fullFactor=[],n.modulus=t.modulus=new u.bn(Math.pow(2,r)),n.fullMask=0|-Math.pow(2,r%n.radix),i=0;i<e.length;i++)n.offset[i]=Math.floor(e[i][0]/n.radix-s),n.fullOffset[i]=Math.floor(e[i][0]/n.radix)-o+1,n.factor[i]=e[i][1]*Math.pow(1/2,r-e[i][0]+n.offset[i]*n.radix),n.fullFactor[i]=e[i][1]*Math.pow(1/2,r-e[i][0]+n.fullOffset[i]*n.radix),n.modulus.addM(new u.bn(Math.pow(2,e[i][0])*e[i][1])),n.minOffset=Math.min(n.minOffset,-n.offset[i]);return n._class=t,n.modulus.cnormalize(),n.reduce=function(){var c,l,f,h=this.modOffset,d=this.limbs,g=this.offset,w=this.offset.length,y=this.factor,m;for(c=this.minOffset;d.length>h;){for(f=d.pop(),m=d.length,l=0;l<w;l++)d[m+g[l]]-=y[l]*f;c--,c||(d.push(0),this.cnormalize(),c=this.minOffset)}return this.cnormalize(),this},n._strongReduce=n.fullMask===-1?n.reduce:function(){var c=this.limbs,l=c.length-1,f,h;if(this.reduce(),l===this.modOffset-1){for(h=c[l]&this.fullMask,c[l]-=h,f=0;f<this.fullOffset.length;f++)c[l+this.fullOffset[f]]-=this.fullFactor[f]*h;this.normalize()}},n.fullReduce=function(){var c,l;for(this._strongReduce(),this.addM(this.modulus),this.addM(this.modulus),this.normalize(),this._strongReduce(),l=this.limbs.length;l<this.modOffset;l++)this.limbs[l]=0;for(c=this.greaterEquals(this.modulus),l=0;l<this.limbs.length;l++)this.limbs[l]-=this.modulus.limbs[l]*c;return this.cnormalize(),this},n.inverse=function(){return this.power(this.modulus.sub(2))},t.fromBits=u.bn.fromBits,t};var le=u.bn.pseudoMersennePrime;u.bn.prime={p127:le(127,[[0,-1]]),p25519:le(255,[[0,-19]]),p192k:le(192,[[32,-1],[12,-1],[8,-1],[7,-1],[6,-1],[3,-1],[0,-1]]),p224k:le(224,[[32,-1],[12,-1],[11,-1],[9,-1],[7,-1],[4,-1],[1,-1],[0,-1]]),p256k:le(256,[[32,-1],[9,-1],[8,-1],[7,-1],[6,-1],[4,-1],[0,-1]]),p192:le(192,[[0,-1],[64,-1]]),p224:le(224,[[0,1],[96,-1]]),p256:le(256,[[0,-1],[96,1],[192,1],[224,-1]]),p384:le(384,[[0,-1],[32,1],[96,-1],[128,-1]]),p521:le(521,[[0,-1]])};u.bn.random=function(r,e){typeof r!="object"&&(r=new u.bn(r));for(var t,n,i=r.limbs.length,s=r.limbs[i-1]+1,o=new u.bn;;){do t=u.random.randomWords(i,e),t[i-1]<0&&(t[i-1]+=4294967296);while(Math.floor(t[i-1]/s)===Math.floor(4294967296/s));for(t[i-1]%=s,n=0;n<i-1;n++)t[n]&=r.radixMask;if(o.limbs=t,!o.greaterEquals(r))return o}};u.ecc={};u.ecc.point=function(r,e,t){e===void 0?this.isIdentity=!0:(e instanceof u.bn&&(e=new r.field(e)),t instanceof u.bn&&(t=new r.field(t)),this.x=e,this.y=t,this.isIdentity=!1),this.curve=r};u.ecc.point.prototype={toJac:a(function(){return new u.ecc.pointJac(this.curve,this.x,this.y,new this.curve.field(1))},"toJac"),mult:a(function(r){return this.toJac().mult(r,this).toAffine()},"mult"),mult2:a(function(r,e,t){return this.toJac().mult2(r,this,e,t).toAffine()},"mult2"),multiples:a(function(){var r,e,t;if(this._multiples===void 0)for(t=this.toJac().doubl(),r=this._multiples=[new u.ecc.point(this.curve),this,t.toAffine()],e=3;e<16;e++)t=t.add(this),r.push(t.toAffine());return this._multiples},"multiples"),negate:a(function(){var r=new this.curve.field(0).sub(this.y).normalize().reduce();return new u.ecc.point(this.curve,this.x,r)},"negate"),isValid:a(function(){return this.y.square().equals(this.curve.b.add(this.x.mul(this.curve.a.add(this.x.square()))))},"isValid"),toBits:a(function(){return u.bitArray.concat(this.x.toBits(),this.y.toBits())},"toBits")};u.ecc.pointJac=function(r,e,t,n){e===void 0?this.isIdentity=!0:(this.x=e,this.y=t,this.z=n,this.isIdentity=!1),this.curve=r};u.ecc.pointJac.prototype={add:a(function(r){var e=this,t,n,i,s,o,c,l,f,h,d,g;if(e.curve!==r.curve)throw new u.exception.invalid("sjcl.ecc.add(): Points must be on the same curve to add them!");return e.isIdentity?r.toJac():r.isIdentity?e:(t=e.z.square(),n=r.x.mul(t).subM(e.x),n.equals(0)?e.y.equals(r.y.mul(t.mul(e.z)))?e.doubl():new u.ecc.pointJac(e.curve):(i=r.y.mul(t.mul(e.z)).subM(e.y),s=n.square(),o=i.square(),c=n.square().mul(n).addM(e.x.add(e.x).mul(s)),l=o.subM(c),f=e.x.mul(s).subM(l).mul(i),h=e.y.mul(n.square().mul(n)),d=f.subM(h),g=e.z.mul(n),new u.ecc.pointJac(this.curve,l,d,g)))},"add"),doubl:a(function(){if(this.isIdentity)return this;var r=this.y.square(),e=r.mul(this.x.mul(4)),t=r.square().mul(8),n=this.z.square(),i=this.curve.a.toString()==new u.bn(-3).toString()?this.x.sub(n).mul(3).mul(this.x.add(n)):this.x.square().mul(3).add(n.square().mul(this.curve.a)),s=i.square().subM(e).subM(e),o=e.sub(s).mul(i).subM(t),c=this.y.add(this.y).mul(this.z);return new u.ecc.pointJac(this.curve,s,o,c)},"doubl"),toAffine:a(function(){if(this.isIdentity||this.z.equals(0))return new u.ecc.point(this.curve);var r=this.z.inverse(),e=r.square();return new u.ecc.point(this.curve,this.x.mul(e).fullReduce(),this.y.mul(e.mul(r)).fullReduce())},"toAffine"),mult:a(function(r,e){typeof r=="number"?r=[r]:r.limbs!==void 0&&(r=r.normalize().limbs);var t,n,i=new u.ecc.point(this.curve).toJac(),s=e.multiples();for(t=r.length-1;t>=0;t--)for(n=u.bn.prototype.radix-4;n>=0;n-=4)i=i.doubl().doubl().doubl().doubl().add(s[r[t]>>n&15]);return i},"mult"),mult2:a(function(r,e,t,n){typeof r=="number"?r=[r]:r.limbs!==void 0&&(r=r.normalize().limbs),typeof t=="number"?t=[t]:t.limbs!==void 0&&(t=t.normalize().limbs);var i,s,o=new u.ecc.point(this.curve).toJac(),c=e.multiples(),l=n.multiples(),f,h;for(i=Math.max(r.length,t.length)-1;i>=0;i--)for(f=r[i]|0,h=t[i]|0,s=u.bn.prototype.radix-4;s>=0;s-=4)o=o.doubl().doubl().doubl().doubl().add(c[f>>s&15]).add(l[h>>s&15]);return o},"mult2"),negate:a(function(){return this.toAffine().negate().toJac()},"negate"),isValid:a(function(){var r=this.z.square(),e=r.square(),t=e.mul(r);return this.y.square().equals(this.curve.b.mul(t).add(this.x.mul(this.curve.a.mul(e).add(this.x.square()))))},"isValid")};u.ecc.curve=function(r,e,t,n,i,s){this.field=r,this.r=new u.bn(e),this.a=new r(t),this.b=new r(n),this.G=new u.ecc.point(this,new r(i),new r(s))};u.ecc.curve.prototype.fromBits=function(r){var e=u.bitArray,t=this.field.prototype.exponent+7&-8,n=new u.ecc.point(this,this.field.fromBits(e.bitSlice(r,0,t)),this.field.fromBits(e.bitSlice(r,t,2*t)));if(!n.isValid())throw new u.exception.corrupt("not on the curve!");return n};u.ecc.curves={c192:new u.ecc.curve(u.bn.prime.p192,"0xffffffffffffffffffffffff99def836146bc9b1b4d22831",-3,"0x64210519e59c80e70fa7e9ab72243049feb8deecc146b9b1","0x188da80eb03090f67cbf20eb43a18800f4ff0afd82ff1012","0x07192b95ffc8da78631011ed6b24cdd573f977a11e794811"),c224:new u.ecc.curve(u.bn.prime.p224,"0xffffffffffffffffffffffffffff16a2e0b8f03e13dd29455c5c2a3d",-3,"0xb4050a850c04b3abf54132565044b0b7d7bfd8ba270b39432355ffb4","0xb70e0cbd6bb4bf7f321390b94a03c1d356c21122343280d6115c1d21","0xbd376388b5f723fb4c22dfe6cd4375a05a07476444d5819985007e34"),c256:new u.ecc.curve(u.bn.prime.p256,"0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551",-3,"0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b","0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296","0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),c384:new u.ecc.curve(u.bn.prime.p384,"0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973",-3,"0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef","0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7","0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f"),c521:new u.ecc.curve(u.bn.prime.p521,"0x1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409",-3,"0x051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","0xC6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","0x11839296A789A3BC0045C8A5FB42C7D1BD998F54449579B446817AFBD17273E662C97EE72995EF42640C550B9013FAD0761353C7086A272C24088BE94769FD16650"),k192:new u.ecc.curve(u.bn.prime.p192k,"0xfffffffffffffffffffffffe26f2fc170f69466a74defd8d",0,3,"0xdb4ff10ec057e9ae26b07d0280b7f4341da5d1b1eae06c7d","0x9b2f2f6d9c5628a7844163d015be86344082aa88d95e2f9d"),k224:new u.ecc.curve(u.bn.prime.p224k,"0x010000000000000000000000000001dce8d2ec6184caf0a971769fb1f7",0,5,"0xa1455b334df099df30fc28a169a467e9e47075a90f7e650eb6b7a45c","0x7e089fed7fba344282cafbd6f7e319f7c0b0bd59e2ca4bdb556d61a5"),k256:new u.ecc.curve(u.bn.prime.p256k,"0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141",0,7,"0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")};u.ecc.curveName=function(r){var e;for(e in u.ecc.curves)if(u.ecc.curves.hasOwnProperty(e)&&u.ecc.curves[e]===r)return e;throw new u.exception.invalid("no such curve")};u.ecc.deserialize=function(r){var e=["elGamal","ecdsa"];if(!r||!r.curve||!u.ecc.curves[r.curve])throw new u.exception.invalid("invalid serialization");if(e.indexOf(r.type)===-1)throw new u.exception.invalid("invalid type");var t=u.ecc.curves[r.curve];if(r.secretKey){if(!r.exponent)throw new u.exception.invalid("invalid exponent");var n=new u.bn(r.exponent);return new u.ecc[r.type].secretKey(t,n)}else{if(!r.point)throw new u.exception.invalid("invalid point");var i=t.fromBits(u.codec.hex.toBits(r.point));return new u.ecc[r.type].publicKey(t,i)}};u.ecc.basicKey={publicKey:a(function(r,e){this._curve=r,this._curveBitLength=r.r.bitLength(),e instanceof Array?this._point=r.fromBits(e):this._point=e,this.serialize=function(){var t=u.ecc.curveName(r);return{type:this.getType(),secretKey:!1,point:u.codec.hex.fromBits(this._point.toBits()),curve:t}},this.get=function(){var t=this._point.toBits(),n=u.bitArray.bitLength(t),i=u.bitArray.bitSlice(t,0,n/2),s=u.bitArray.bitSlice(t,n/2);return{x:i,y:s}}},"publicKey"),secretKey:a(function(r,e){this._curve=r,this._curveBitLength=r.r.bitLength(),this._exponent=e,this.serialize=function(){var t=this.get(),n=u.ecc.curveName(r);return{type:this.getType(),secretKey:!0,exponent:u.codec.hex.fromBits(t),curve:n}},this.get=function(){return this._exponent.toBits()}},"secretKey")};u.ecc.basicKey.generateKeys=function(r){return a(function(t,n,i){if(t=t||256,typeof t=="number"&&(t=u.ecc.curves["c"+t],t===void 0))throw new u.exception.invalid("no such curve");i=i||u.bn.random(t.r,n);var s=t.G.mult(i);return{pub:new u.ecc[r].publicKey(t,s),sec:new u.ecc[r].secretKey(t,i)}},"generateKeys")};u.ecc.elGamal={generateKeys:u.ecc.basicKey.generateKeys("elGamal"),publicKey:a(function(r,e){u.ecc.basicKey.publicKey.apply(this,arguments)},"publicKey"),secretKey:a(function(r,e){u.ecc.basicKey.secretKey.apply(this,arguments)},"secretKey")};u.ecc.elGamal.publicKey.prototype={kem:a(function(r){var e=u.bn.random(this._curve.r,r),t=this._curve.G.mult(e).toBits(),n=u.hash.sha256.hash(this._point.mult(e).toBits());return{key:n,tag:t}},"kem"),getType:a(function(){return"elGamal"},"getType")};u.ecc.elGamal.secretKey.prototype={unkem:a(function(r){return u.hash.sha256.hash(this._curve.fromBits(r).mult(this._exponent).toBits())},"unkem"),dh:a(function(r){return u.hash.sha256.hash(r._point.mult(this._exponent).toBits())},"dh"),dhJavaEc:a(function(r){return r._point.mult(this._exponent).x.toBits()},"dhJavaEc"),getType:a(function(){return"elGamal"},"getType")};u.ecc.ecdsa={generateKeys:u.ecc.basicKey.generateKeys("ecdsa")};u.ecc.ecdsa.publicKey=function(r,e){u.ecc.basicKey.publicKey.apply(this,arguments)};u.ecc.ecdsa.publicKey.prototype={verify:a(function(r,e,t){u.bitArray.bitLength(r)>this._curveBitLength&&(r=u.bitArray.clamp(r,this._curveBitLength));var n=u.bitArray,i=this._curve.r,s=this._curveBitLength,o=u.bn.fromBits(n.bitSlice(e,0,s)),c=u.bn.fromBits(n.bitSlice(e,s,2*s)),l=t?c:c.inverseMod(i),f=u.bn.fromBits(r).mul(l).mod(i),h=o.mul(l).mod(i),d=this._curve.G.mult2(f,h,this._point).x;if(o.equals(0)||c.equals(0)||o.greaterEquals(i)||c.greaterEquals(i)||!d.equals(o)){if(t===void 0)return this.verify(r,e,!0);throw new u.exception.corrupt("signature didn't check out")}return!0},"verify"),getType:a(function(){return"ecdsa"},"getType")};u.ecc.ecdsa.secretKey=function(r,e){u.ecc.basicKey.secretKey.apply(this,arguments)};u.ecc.ecdsa.secretKey.prototype={sign:a(function(r,e,t,n){u.bitArray.bitLength(r)>this._curveBitLength&&(r=u.bitArray.clamp(r,this._curveBitLength));var i=this._curve.r,s=i.bitLength(),o=n||u.bn.random(i.sub(1),e).add(1),c=this._curve.G.mult(o).x.mod(i),l=u.bn.fromBits(r).add(c.mul(this._exponent)),f=t?l.inverseMod(i).mul(o).mod(i):l.mul(o.inverseMod(i)).mod(i);return u.bitArray.concat(c.toBits(s),f.toBits(s))},"sign"),getType:a(function(){return"ecdsa"},"getType")};typeof ArrayBuffer>"u"&&(function(r){"use strict";r.ArrayBuffer=function(){},r.DataView=function(){}})(_r);u.codec.arrayBuffer={fromBits:a(function(r,e,t){var n,i,s,o,c;if(e=e??!0,t=t||8,r.length===0)return new ArrayBuffer(0);if(s=u.bitArray.bitLength(r)/8,u.bitArray.bitLength(r)%8!==0)throw new u.exception.invalid("Invalid bit size, must be divisble by 8 to fit in an arraybuffer correctly");for(e&&s%t!==0&&(s+=t-s%t),o=new DataView(new ArrayBuffer(r.length*4)),i=0;i<r.length;i++)o.setUint32(i*4,r[i]<<32);if(n=new DataView(new ArrayBuffer(s)),n.byteLength===o.byteLength)return o.buffer;for(c=o.byteLength<n.byteLength?o.byteLength:n.byteLength,i=0;i<c;i++)n.setUint8(i,o.getUint8(i));return n.buffer},"fromBits"),toBits:a(function(r){var e,t=[],n,i,s;if(r.byteLength===0)return[];i=new DataView(r),n=i.byteLength-i.byteLength%4;for(var e=0;e<n;e+=4)t.push(i.getUint32(e));if(i.byteLength%4!=0){s=new DataView(new ArrayBuffer(4));for(var e=0,o=i.byteLength%4;e<o;e++)s.setUint8(e+4-o,i.getUint8(n+e));t.push(u.bitArray.partial(i.byteLength%4*8,s.getUint32(0)))}return t},"toBits"),hexDumpBuffer:a(function(r){for(var e=new DataView(r),t="",n=a(function(s,o){return s=s+"",s.length>=o?s:new Array(o-s.length+1).join("0")+s},"pad"),i=0;i<e.byteLength;i+=2)i%16==0&&(t+=`
`+i.toString(16)+"	"),t+=n(e.getUint16(i).toString(16),4)+" ";typeof console===void 0&&(console=console||{log:a(function(){},"log")}),console.log(t.toUpperCase())},"hexDumpBuffer")};_r.default=u});var Ci=U(Ae=>{"use strict";var Ao=Ae&&Ae.__classPrivateFieldGet||function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Bo=Ae&&Ae.__importDefault||function(r){return r&&r.__esModule?r:{default:r}},Si,_i;Object.defineProperty(Ae,"__esModule",{value:!0});Ae.GroupConsSjcl=void 0;var _=Ie(),S=Bo(xi()),R=Br();function Eo(r){switch(r){case"SHA-1":return{outLenBytes:20,blockLenBytes:64};case"SHA-256":return{outLenBytes:32,blockLenBytes:64};case"SHA-384":return{outLenBytes:48,blockLenBytes:128};case"SHA-512":return{outLenBytes:64,blockLenBytes:128};default:throw new Error(`invalid hash name: ${r}`)}}a(Eo,"hashParams");async function Ri(r,e,t,n){let{outLenBytes:i,blockLenBytes:s}=Eo(r),o=Math.ceil(n/i);if(o>255)throw new Error("too big");let c=t;if(t.length>255){let m=new TextEncoder,v=(0,_.joinAll)([m.encode("H2C-OVERSIZE-DST-"),t]);c=new Uint8Array(await crypto.subtle.digest(r,v))}c=(0,_.joinAll)([c,new Uint8Array([c.length])]);let l=new Uint8Array(s),f=new Uint8Array(2);f[0]=n>>8&255,f[1]=n&255;let h=(0,_.joinAll)([l,e,f,new Uint8Array([0]),c]),d=new Uint8Array(await crypto.subtle.digest(r,h)),g=(0,_.joinAll)([d,new Uint8Array([1]),c]),w=new Uint8Array(await crypto.subtle.digest(r,g)),y=(0,_.joinAll)([w]);for(let m=2;m<=o;m++){let v=(0,_.joinAll)([(0,_.xor)(w,d),new Uint8Array([m]),c]);w=new Uint8Array(await crypto.subtle.digest(r,v)),y=(0,_.joinAll)([y,w])}return y.slice(0,n)}a(Ri,"expandXMD");function fe(r){switch(r){case R.GROUP.P256:return S.default.ecc.curves.c256;case R.GROUP.P384:return S.default.ecc.curves.c384;case R.GROUP.P521:return S.default.ecc.curves.c521;case R.GROUP.DECAF448:case R.GROUP.RISTRETTO255:throw new Error("group: non-supported ciphersuite");default:throw(0,R.errBadGroup)(r)}}a(fe,"getCurve");var be=class r{static{a(this,"ScalarSj")}constructor(e,t){this.g=e,this.k=t,this.order=fe(this.g.id).r}static create(e){return new r(e,new S.default.bn(0))}isEqual(e){return this.k.equals(e.k)}isZero(){return this.k.equals(0)}add(e){(0,_.compat)(this,e);let t=this.k.add(e.k).mod(this.order);return t.normalize(),new r(this.g,t)}sub(e){(0,_.compat)(this,e);let t=this.k.sub(e.k).mod(this.order);return t.normalize(),new r(this.g,t)}mul(e){(0,_.compat)(this,e);let t=this.k.mulmod(e.k,this.order);return t.normalize(),new r(this.g,t)}inv(){return new r(this.g,this.k.inverseMod(this.order))}serialize(){let e=this.k.mod(this.order);e.normalize();let t=S.default.codec.arrayBuffer.fromBits(e.toBits(),!1),n=new Uint8Array(t),i=new Uint8Array(this.g.size);return i.set(n,this.g.size-n.length),i}static size(e){return e.size}static deserialize(e,t){(0,_.checkSize)(t,r,e);let n=Array.from(t.subarray(0,e.size)),i=S.default.bn.fromBits(S.default.codec.bytes.toBits(n));if(i.normalize(),i.greaterEquals(fe(e.id).r))throw(0,_.errDeserialization)(r);return new r(e,i)}static async hash(e,t,n){let{hash:i,L:s}=Ti(e.id),o=await Ri(i,t,n,s),c=Array.from(o),l=S.default.codec.bytes.toBits(c),f=S.default.bn.fromBits(l).mod(fe(e.id).r);return new r(e,f)}};function xo(r){let e=fe(r),t,n;switch(r){case R.GROUP.P256:t=-10,n="0x25ac71c31e27646736870398ae7f554d8472e008b3aa2a49d332cbd81bcc3b80";break;case R.GROUP.P384:t=-12,n="0x2accb4a656b0249c71f0500e83da2fdd7f98e383d68b53871f872fcb9ccb80c53c0de1f8a80f7e1914e2ec69f5a626b3";break;case R.GROUP.P521:t=-4,n="0x2";break;default:throw(0,R.errBadGroup)(r)}let s=e.field.modulus.sub(new S.default.bn(3)).halveM().halveM();return t=new e.field(t),n=new e.field(n),{Z:t,c1:s,c2:n}}a(xo,"getSSWUParams");function Ti(r){switch(r){case R.GROUP.P256:return{hash:"SHA-256",L:48};case R.GROUP.P384:return{hash:"SHA-384",L:72};case R.GROUP.P521:return{hash:"SHA-512",L:98};default:throw(0,R.errBadGroup)(r)}}a(Ti,"getHashParams");var ue=class r{static{a(this,"EltSj")}constructor(e,t){this.g=e,this.p=t}static create(e){return new r(e,new S.default.ecc.point(fe(e.id)))}static gen(e){return new r(e,fe(e.id).G)}isIdentity(){return this.p.isIdentity}isEqual(e){if((0,_.compat)(this,e),this.p.isIdentity&&e.p.isIdentity)return!0;if(this.p.isIdentity||e.p.isIdentity)return!1;let{x:t,y:n}=this.p,{x:i,y:s}=e.p;return t.equals(i)&&n.equals(s)}neg(){return this.p.negate()}add(e){return(0,_.compat)(this,e),new r(this.g,this.p.toJac().add(e.p).toAffine())}mul(e){return(0,_.compat)(this,e),new r(this.g,this.p.mult(e.k))}mul2(e,t,n){return(0,_.compat)(this,e),(0,_.compat)(this,n),(0,_.compat)(this,t),new r(this.g,this.p.mult2(e.k,n.k,t.p))}serUnComp(e){let t=S.default.codec.arrayBuffer.fromBits(e.toBits(),!1),n=new Uint8Array(t);if(n.length!==2*this.g.size)throw new Error("error serializing element");let i=new Uint8Array(1+2*this.g.size);return i[0]=4,i.set(n,1),i}serComp(e){let t=new Uint8Array(S.default.codec.arrayBuffer.fromBits(e.x.toBits(null),!1)),n=new Uint8Array(1+this.g.size);return n[0]=2|e.y.getLimb(0)&1,n.set(t,1+this.g.size-t.length),n}serialize(e=!0){if(this.p.isIdentity)return Uint8Array.from([0]);let t=this.p;return t.x.fullReduce(),t.y.fullReduce(),e?this.serComp(t):this.serUnComp(t)}static size(e,t=!0){return 1+(t?e.size:e.size*2)}static deserComp(e,t){let n=Array.from(t.subarray(1)),i=S.default.codec.bytes.toBits(n),s=fe(e.id),o=new s.field(S.default.bn.fromBits(i)),c=s.field.modulus,l=c.add(new S.default.bn(1)).halveM().halveM(),f=o.square().add(s.a).mul(o).add(s.b).power(l);f.fullReduce(),(t[0]&1)!==(f.getLimb(0)&1)&&(f=c.sub(f).mod(c));let h=new S.default.ecc.point(s,new s.field(o),new s.field(f));if(!h.isValid())throw(0,_.errDeserialization)(r);return new r(e,h)}static deserUnComp(e,t){let n=Array.from(t.subarray(1)),i=S.default.codec.bytes.toBits(n),o=fe(e.id).fromBits(i);return o.x.fullReduce(),o.y.fullReduce(),new r(e,o)}static deserialize(e,t){let n=t.length;switch(!0){case(n===1&&t[0]===0):return e.identity();case(n===1+e.size&&(t[0]===2||t[0]===3)):return r.deserComp(e,t);case(n===1+2*e.size&&t[0]===4):return r.deserUnComp(e,t);default:throw(0,_.errDeserialization)(r)}}static async hashToField(e,t,n,i){let s=fe(e.id),{hash:o,L:c}=Ti(e.id),l=await Ri(o,t,n,i*c),f=new Array;for(let h=0;h<i;h++){let d=h*c,g=Array.from(l.slice(d,d+c)),w=S.default.codec.bytes.toBits(g);f.push(new s.field(S.default.bn.fromBits(w)))}return f}static sswu(e,t){let n=fe(e.id),{a:i,b:s}=n,{Z:o,c1:c,c2:l}=xo(e.id),f=new n.field(0),h=new n.field(1);function d(X){return X.fullReduce(),X.getLimb(0)&1}a(d,"sgn");function g(X,L,de){return de?L:X}a(g,"cmov");function w(X,L){let de=L.square(),ie=X.mul(L);de=de.mul(ie);let O=de.power(c);O=O.mul(ie);let Gt=O.mul(l),zr=O.square();zr=zr.mul(L);let Bn=zr.equals(X),ls=g(Gt,O,Bn);return{isQR:Bn,root:ls}}a(w,"sqrt_ratio_3mod4");let y=t.square();y=o.mul(y);let m=y.square();m=m.add(y);let v=m.add(h);v=s.mul(v);let C=g(o,f.sub(m),!m.equals(f));C=i.mul(C),m=v.square();let E=C.square(),N=i.mul(E);m=m.add(N),m=m.mul(v),E=E.mul(C),N=s.mul(E),m=m.add(N);let $=y.mul(v),{isQR:ne,root:Se}=w(m,E),V=y.mul(t);V=V.mul(Se),$=g($,v,ne),V=g(V,Se,ne);let _e=d(t)===d(V);V=g(f.sub(V),V,_e);let Re=C;$=$.mul(Re),y=Re.square(),y=y.mul(Re),V=V.mul(y);let Y=new S.default.ecc.pointJac(n,$,V,Re).toAffine();if(!Y.isValid())throw new Error("point not in curve");return new r(e,Y)}static async hash(e,t,n){let i=await r.hashToField(e,t,n,2),s=r.sswu(e,i[0]),o=r.sswu(e,i[1]);return s.add(o)}},Dt=class{static{a(this,"GroupSj")}static get(e){var t,n;return(t=Ao(this,Si,"f",_i))[n=`${e}`]??(t[n]=new this(e))}constructor(e){switch(e){case R.GROUP.P256:this.size=32;break;case R.GROUP.P384:this.size=48;break;case R.GROUP.P521:this.size=66;break;default:throw(0,R.errBadGroup)(e)}this.id=e}newScalar(){return be.create(this)}newElt(){return this.identity()}identity(){return ue.create(this)}generator(){return ue.gen(this)}mulGen(e){return ue.gen(this).mul(e)}randomScalar(){let e=crypto.getRandomValues(new Uint8Array(this.size));return be.hash(this,e,new Uint8Array)}hashToGroup(e,t){return ue.hash(this,e,t)}hashToScalar(e,t){return be.hash(this,e,t)}get eltDes(){return{size:a(e=>ue.size(this,e),"size"),deserialize:a(e=>ue.deserialize(this,e),"deserialize")}}get scalarDes(){return{size:a(()=>be.size(this),"size"),deserialize:a(e=>be.deserialize(this,e),"deserialize")}}desElt(e){return ue.deserialize(this,e)}desScalar(e){return be.deserialize(this,e)}eltSize(e){return ue.size(this,e)}scalarSize(){return be.size(this)}};Si=Dt;Dt.supportedGroups=[R.GROUP.P256,R.GROUP.P384,R.GROUP.P521];_i={value:{}};Ae.GroupConsSjcl=Dt});var Ui=U(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});Rr.CryptoSjcl=void 0;var So=Ci();Rr.CryptoSjcl={id:"sjcl",Group:So.GroupConsSjcl,async hash(r,e){return new Uint8Array(await crypto.subtle.digest(r,e))}}});var Pi=U(Je=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});Je.DEFAULT_CRYPTO_PROVIDER=Je.CRYPTO_PROVIDER_ARG_REQUIRED=void 0;var _o=Ui();Je.CRYPTO_PROVIDER_ARG_REQUIRED=!1;Je.DEFAULT_CRYPTO_PROVIDER=_o.CryptoSjcl});var Sr=U(Le=>{"use strict";Object.defineProperty(Le,"__esModule",{value:!0});Le.getCrypto=Ni;Le.getGroup=Li;Le.getSuiteGroup=Co;Le.setCryptoProvider=Uo;Le.getCryptoProvider=Po;var Ro=Ge(),Ii=Pi(),To=Ii.CRYPTO_PROVIDER_ARG_REQUIRED,on=Ii.DEFAULT_CRYPTO_PROVIDER;function Ni(r){let[e]=r;if(!e&&To)throw new Error("Undefined crypto arg");return e??on}a(Ni,"getCrypto");function Li(r,e){return Ni(e).Group.get(r)}a(Li,"getGroup");function Co(r,e){return Li((0,Ro.getOprfParams)(r)[1],e)}a(Co,"getSuiteGroup");function Uo(r){on=r}a(Uo,"setCryptoProvider");function Po(){return on}a(Po,"getCryptoProvider")});var zt=U(Be=>{"use strict";Object.defineProperty(Be,"__esModule",{value:!0});Be.DLEQProver=Be.DLEQVerifier=Be.DLEQProof=void 0;var D=Ie(),cn=Sr(),Vt={Seed:"Seed-",Challenge:"Challenge",Composite:"Composite",HashToScalar:"HashToScalar-"};async function Oi(r,e,t,n,...i){let s=(0,cn.getCrypto)(i),o=s.Group.get(r.group),c=new TextEncoder,l=e.serialize(),f=(0,D.joinAll)([c.encode(Vt.Seed),r.dst]),h=(0,D.joinAll)([...(0,D.toU16LenPrefix)(l),...(0,D.toU16LenPrefix)(f)]),d=await s.hash(r.hash,h),g=c.encode(Vt.Composite),w=(0,D.joinAll)([c.encode(Vt.HashToScalar),r.dst]),y=o.identity(),m=o.identity(),v=0;for(let[C,E]of t){let N=C.serialize(),$=E.serialize(),ne=(0,D.joinAll)([...(0,D.toU16LenPrefix)(d),(0,D.to16bits)(v++),...(0,D.toU16LenPrefix)(N),...(0,D.toU16LenPrefix)($),g]),Se=await o.hashToScalar(ne,w);y=y.add(C.mul(Se)),n||(m=m.add(E.mul(Se)))}return n&&(m=y.mul(n)),{M:y,Z:m}}a(Oi,"computeComposites");function Fi(r,e,t){let n=new Uint8Array;for(let o of t){let c=o.serialize();n=(0,D.joinAll)([n,...(0,D.toU16LenPrefix)(c)])}let i=new TextEncoder;n=(0,D.joinAll)([n,i.encode(Vt.Challenge)]);let s=(0,D.joinAll)([i.encode(Vt.HashToScalar),e.dst]);return r.hashToScalar(n,s)}a(Fi,"challenge");var Tr=class r{static{a(this,"DLEQProof")}constructor(e,t){this.c=e,this.s=t}isEqual(e){return this.c.isEqual(e.c)&&this.s.isEqual(e.s)}serialize(){return(0,D.joinAll)([this.c.serialize(),this.s.serialize()])}static size(e){return 2*e.scalarSize()}static deserialize(e,t,...n){let i=(0,cn.getGroup)(e,n);(0,D.checkSize)(t,r,i);let s=i.scalarSize(),o=i.desScalar(t.subarray(0,s)),c=i.desScalar(t.subarray(s,2*s));return new r(o,c)}};Be.DLEQProof=Tr;var Cr=class{static{a(this,"DLEQVerifier")}constructor(e,...t){this.params=e,this.crypto=(0,cn.getCrypto)(t),this.group=this.crypto.Group.get(e.group)}verify(e,t,n){return this.verify_batch(e,[t],n)}async verify_batch(e,t,n){let{M:i,Z:s}=await Oi(this.params,e[1],t,void 0,this.crypto),o=e[0].mul2(n.s,e[1],n.c),c=i.mul2(n.s,s,n.c),l=await Fi(this.group,this.params,[e[1],i,s,o,c]);return n.c.isEqual(l)}};Be.DLEQVerifier=Cr;var an=class extends Cr{static{a(this,"DLEQProver")}prove(e,t,n,i){return this.prove_batch(e,t,[n],i)}randomScalar(){return this.group.randomScalar()}async prove_batch(e,t,n,i){let s=i||await this.randomScalar(),{M:o,Z:c}=await Oi(this.params,t[1],n,e,this.crypto),l=t[0].mul(s),f=o.mul(s),h=await Fi(this.group,this.params,[t[1],o,c,l,f]),d=s.sub(h.mul(e));return new Tr(h,d)}};Be.DLEQProver=an});var Vi=U(Ee=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0});Ee.POPRFClient=Ee.VOPRFClient=Ee.OPRFClient=void 0;var Oe=Ge(),zi=Ie(),Di=zt(),Mt=class extends Oe.Oprf{static{a(this,"baseClient")}randomBlinder(){return this.group.randomScalar()}async blind(e){let t=[],n=[];for(let o of e){let c=await this.randomBlinder(),l=await this.group.hashToGroup(o,this.getDST(Oe.Oprf.LABELS.HashToGroupDST));if(l.isIdentity())throw new Error("InvalidInputError");t.push(l.mul(c)),n.push(c)}let i=new Oe.EvaluationRequest(t);return[new Oe.FinalizeData(e,n,i),i]}async doFinalize(e,t,n=new Uint8Array(0)){let i=e.inputs.length;if(e.blinds.length!==i||t.evaluated.length!==i)throw new Error("mismatched lengths");let s=[];for(let o=0;o<i;o++){let c=e.blinds[o].inv(),f=t.evaluated[o].mul(c).serialize();s.push(await this.coreFinalize(e.inputs[o],f,n))}return s}},ln=class extends Mt{static{a(this,"OPRFClient")}constructor(e,...t){super(Oe.Oprf.Mode.OPRF,e,...t)}finalize(e,t){return super.doFinalize(e,t)}};Ee.OPRFClient=ln;var un=class extends Mt{static{a(this,"VOPRFClient")}constructor(e,t,...n){super(Oe.Oprf.Mode.VOPRF,e,...n),this.pubKeyServer=t}async finalize(e,t){if(!t.proof)throw new Error("no proof provided");let n=this.group.desElt(this.pubKeyServer),i=e.inputs.length;if(t.evaluated.length!==i)throw new Error("mismatched lengths");if(!await new Di.DLEQVerifier(this.getDLEQParams(),this.crypto).verify_batch([this.group.generator(),n],(0,zi.zip)(e.evalReq.blinded,t.evaluated),t.proof))throw new Error("proof failed");return super.doFinalize(e,t)}};Ee.VOPRFClient=un;var fn=class extends Mt{static{a(this,"POPRFClient")}constructor(e,t,...n){super(Oe.Oprf.Mode.POPRF,e,...n),this.pubKeyServer=t}async pointFromInfo(e){let t=await this.scalarFromInfo(e),n=this.group.mulGen(t),s=this.group.desElt(this.pubKeyServer).add(n);if(s.isIdentity())throw new Error("invalid info");return s}async finalize(e,t,n=new Uint8Array(0)){if(!t.proof)throw new Error("no proof provided");let i=await this.pointFromInfo(n),s=e.inputs.length;if(t.evaluated.length!==s)throw new Error("mismatched lengths");if(!await new Di.DLEQVerifier(this.getDLEQParams(),this.crypto).verify_batch([this.group.generator(),i],(0,zi.zip)(t.evaluated,e.evalReq.blinded),t.proof))throw new Error("proof failed");return super.doFinalize(e,t,n)}};Ee.POPRFClient=fn});var Mi=U(xe=>{"use strict";Object.defineProperty(xe,"__esModule",{value:!0});xe.POPRFServer=xe.VOPRFServer=xe.OPRFServer=void 0;var Io=zt(),me=Ge(),Ht=Ie(),qt=class extends me.Oprf{static{a(this,"baseServer")}constructor(e,t,n,...i){super(e,t,...i),this.prover=new Io.DLEQProver(this.getDLEQParams(),this.crypto),this.supportsWebCryptoOPRF=!1,this.privateKey=n}doBlindEvaluation(e,t){return this.supportsWebCryptoOPRF?this.blindEvaluateWebCrypto(e,t):Promise.resolve(this.blindEvaluateGroup(e,t))}async blindEvaluateWebCrypto(e,t){let n=await crypto.subtle.importKey("raw",t,{name:"OPRF",namedCurve:this.group.id},!0,["sign"]),i=e.serialize(!0),s=new Uint8Array(await crypto.subtle.sign("OPRF",n,i));return this.group.desElt(s)}blindEvaluateGroup(e,t){return e.mul(this.group.desScalar(t))}async secretFromInfo(e){let t=await this.scalarFromInfo(e),n=this.group.desScalar(this.privateKey),i=t.add(n);if(i.isZero())throw new Error("inverse of zero");let s=i.inv();return[i,s]}async doEvaluate(e,t=new Uint8Array(0)){let n=this.privateKey;if(this.mode===me.Oprf.Mode.POPRF){let[,o]=await this.secretFromInfo(t);n=o.serialize()}let i=await this.group.hashToGroup(e,this.getDST(me.Oprf.LABELS.HashToGroupDST));if(i.isIdentity())throw new Error("InvalidInputError");let s=await this.doBlindEvaluation(i,n);return this.coreFinalize(e,s.serialize(!0),t)}},hn=class extends qt{static{a(this,"OPRFServer")}constructor(e,t,...n){super(me.Oprf.Mode.OPRF,e,t,...n)}async blindEvaluate(e){return new me.Evaluation(this.mode,await Promise.all(e.blinded.map(t=>this.doBlindEvaluation(t,this.privateKey))))}async evaluate(e){return this.doEvaluate(e)}async verifyFinalize(e,t){return(0,Ht.ctEqual)(t,await this.doEvaluate(e))}};xe.OPRFServer=hn;var dn=class extends qt{static{a(this,"VOPRFServer")}constructor(e,t,...n){super(me.Oprf.Mode.VOPRF,e,t,...n)}async blindEvaluate(e){let t=await Promise.all(e.blinded.map(o=>this.doBlindEvaluation(o,this.privateKey))),n=this.group.desScalar(this.privateKey),i=this.group.mulGen(n),s=await this.prover.prove_batch(n,[this.group.generator(),i],(0,Ht.zip)(e.blinded,t));return new me.Evaluation(this.mode,t,s)}async evaluate(e){return this.doEvaluate(e)}async verifyFinalize(e,t){return(0,Ht.ctEqual)(t,await this.doEvaluate(e))}};xe.VOPRFServer=dn;var gn=class extends qt{static{a(this,"POPRFServer")}constructor(e,t,...n){super(me.Oprf.Mode.POPRF,e,t,...n)}async blindEvaluate(e,t=new Uint8Array(0)){let[n,i]=await this.secretFromInfo(t),s=i.serialize(),o=await Promise.all(e.blinded.map(f=>this.doBlindEvaluation(f,s))),c=this.group.mulGen(n),l=await this.prover.prove_batch(n,[this.group.generator(),c],(0,Ht.zip)(o,e.blinded));return new me.Evaluation(this.mode,o,l)}async evaluate(e,t=new Uint8Array(0)){return this.doEvaluate(e,t)}async verifyFinalize(e,t,n=new Uint8Array(0)){return(0,Ht.ctEqual)(t,await this.doEvaluate(e,n))}};xe.POPRFServer=gn});var $i=U(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.getKeySizes=No;he.validatePrivateKey=Lo;he.validatePublicKey=Oo;he.randomPrivateKey=qi;he.derivePrivateKey=ji;he.generatePublicKey=yn;he.generateKeyPair=Fo;he.deriveKeyPair=zo;var Hi=Ge(),pn=Ie(),We=Sr();function No(r,...e){let t=(0,We.getSuiteGroup)(r,e);return{Nsk:t.scalarSize(),Npk:t.eltSize(!0)}}a(No,"getKeySizes");function Lo(r,e,...t){try{return!(0,We.getSuiteGroup)(r,t).desScalar(e).isZero()}catch{return!1}}a(Lo,"validatePrivateKey");function Oo(r,e,...t){try{return!(0,We.getSuiteGroup)(r,t).desElt(e).isIdentity()}catch{return!1}}a(Oo,"validatePublicKey");async function qi(r,...e){let t;do t=await(0,We.getSuiteGroup)(r,e).randomScalar();while(t.isZero());return t.serialize()}a(qi,"randomPrivateKey");async function ji(r,e,t,n,...i){let s=(0,We.getSuiteGroup)(e,i),o=(0,pn.joinAll)([t,...(0,pn.toU16LenPrefix)(n)]),c=0,l;do{if(c>255)throw new Error("DeriveKeyPairError");let f=(0,pn.joinAll)([o,Uint8Array.from([c])]);l=await s.hashToScalar(f,Hi.Oprf.getDST(r,e,Hi.Oprf.LABELS.DeriveKeyPairDST)),c++}while(l.isZero());return l.serialize()}a(ji,"derivePrivateKey");function yn(r,e,...t){let n=(0,We.getSuiteGroup)(r,t),i=n.desScalar(e);return n.mulGen(i).serialize(!0)}a(yn,"generatePublicKey");async function Fo(r,...e){let t=await qi(r,...e),n=yn(r,t,...e);return{privateKey:t,publicKey:n}}a(Fo,"generateKeyPair");async function zo(r,e,t,n,...i){let s=await ji(r,e,t,n,...i),o=yn(e,s,...i);return{privateKey:s,publicKey:o}}a(zo,"deriveKeyPair")});var Gi=U(Ki=>{"use strict";Object.defineProperty(Ki,"__esModule",{value:!0})});var Ji=U(J=>{"use strict";var Do=J&&J.__createBinding||(Object.create?(function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:a(function(){return e[t]},"get")}),Object.defineProperty(r,n,i)}):(function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]})),Fe=J&&J.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Do(e,r,t)};Object.defineProperty(J,"__esModule",{value:!0});Fe(Br(),J);Fe(zt(),J);Fe(Ge(),J);Fe(Vi(),J);Fe(Mi(),J);Fe($i(),J);Fe(Gi(),J)});function xn(){let r=Number(process.env.SIDECAR_PORT??9797),e=process.env.ISSUER_DIRECTORY_URL??"http://127.0.0.1:8787/.well-known/private-token-issuer-directory",t=process.env.ISSUER_REQUEST_URL??void 0,n=Number(process.env.PREFETCH_BATCH_SIZE??50),i=process.env.SIDECAR_STORE_PATH??"../tokens.json",s=process.env.ISSUER_EXTRA_HEADERS?JSON.parse(process.env.ISSUER_EXTRA_HEADERS):void 0;return{port:r,issuerDirectoryUrl:e,prefetchBatchSize:n,storePath:i,extraHeaders:s,issuerRequestUrl:t}}a(xn,"loadConfig");var Vr=require("node:fs");function ys(r,e,t){var n;if(t===void 0&&(t={}),!e.codes){e.codes={};for(var i=0;i<e.chars.length;++i)e.codes[e.chars[i]]=i}if(!t.loose&&r.length*e.bits&7)throw new SyntaxError("Invalid padding");for(var s=r.length;r[s-1]==="=";)if(--s,!t.loose&&!((r.length-s)*e.bits&7))throw new SyntaxError("Invalid padding");for(var o=new((n=t.out)!=null?n:Uint8Array)(s*e.bits/8|0),c=0,l=0,f=0,h=0;h<s;++h){var d=e.codes[r[h]];if(d===void 0)throw new SyntaxError("Invalid character "+r[h]);l=l<<e.bits|d,c+=e.bits,c>=8&&(c-=8,o[f++]=255&l>>c)}if(c>=e.bits||255&l<<8-c)throw new SyntaxError("Unexpected end of data");return o}a(ys,"parse");function ws(r,e,t){t===void 0&&(t={});for(var n=t,i=n.pad,s=i===void 0?!0:i,o=(1<<e.bits)-1,c="",l=0,f=0,h=0;h<r.length;++h)for(f=f<<8|255&r[h],l+=8;l>e.bits;)l-=e.bits,c+=e.chars[o&f>>l];if(l&&(c+=e.chars[o&f<<e.bits-l]),s)for(;c.length*e.bits&7;)c+="=";return c}a(ws,"stringify");var Sn={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bits:6};var Z={parse:a(function(e,t){return ys(e,Sn,t)},"parse$1"),stringify:a(function(e,t){return ws(e,Sn,t)},"stringify$1")};var Wt=class{constructor(e){this.filePath=e}static{a(this,"TokenStore")}async load(){try{let e=await Vr.promises.readFile(this.filePath,"utf8"),t=JSON.parse(e);return!t.tokens||!Array.isArray(t.tokens)?{tokens:[]}:{tokens:t.tokens}}catch{return{tokens:[]}}}async save(e){await Vr.promises.writeFile(this.filePath,JSON.stringify(e,null,2),"utf8")}async addMany(e){let t=await this.load();t.tokens.push(...e),await this.save(t)}async take(e){let t=await this.load(),n=t.tokens.splice(0,Math.max(0,Math.min(e,t.tokens.length)));return await this.save(t),n}async count(){return(await this.load()).tokens.length}static toB64u(e){return Z.stringify(e,{pad:!1})}static fromB64u(e){return new Uint8Array(Z.parse(e))}};var os=Dr(require("node:http")),as=require("node:url");var A=Dr(wi(),1);function pr(r){let e="1.2.840.113549.1.1.1",t=new A.Sequence({value:[new A.Sequence({name:"algorithm"}),new A.BitString({name:"subjectPublicKey"})]}),n=A.verifySchema(r,t);if(!n.verified)throw new Error("bad parsing RSA-PSS key");let i=new A.Sequence({value:[new A.Sequence({value:[new A.ObjectIdentifier({value:e}),new A.Null]}),n.result.subjectPublicKey]});return new Uint8Array(i.toBER())}a(pr,"convertRSASSAPSSToEnc");function io(){let r="1.2.840.113549.1.1.10",e=new A.Sequence({value:[new A.Constructed({idBlock:{tagClass:3,tagNumber:0},value:[new A.Sequence({value:[new A.ObjectIdentifier({value:"2.16.840.1.101.3.4.2.2"})]})]}),new A.Constructed({idBlock:{tagClass:3,tagNumber:1},value:[new A.Sequence({value:[new A.ObjectIdentifier({value:"1.2.840.113549.1.1.8"}),new A.Sequence({value:[new A.ObjectIdentifier({value:"2.16.840.1.101.3.4.2.2"})]})]})]}),new A.Constructed({idBlock:{tagClass:3,tagNumber:2},value:[new A.Integer({value:48})]})]});return new A.Sequence({value:[new A.ObjectIdentifier({value:r}),e]})}a(io,"algorithm_RSASSA_PSS");function yr(r){let e=new A.Sequence({value:[new A.Sequence({name:"algorithm"}),new A.BitString({name:"subjectPublicKey"})]}),t=A.verifySchema(r,e);if(!t.verified)throw new Error("bad parsing EncRSA key");let n=io(),i=new A.Sequence({value:[n,t.result.subjectPublicKey]});return new Uint8Array(i.toBER())}a(yr,"convertEncToRSASSAPSS");function H(r){let e=0;for(let s of r)e+=s.byteLength;let t=new ArrayBuffer(e),n=new Uint8Array(t),i=0;for(let s of r)n.set(new Uint8Array(s),i),i+=s.byteLength;return t}a(H,"joinAll");var Gr=65535;var Pt=class r{static{a(this,"TokenChallenge")}tokenType;issuerName;redemptionContext;originInfo;static REDEMPTION_CONTEXT_LENGTH=[0,32];constructor(e,t,n,i){this.tokenType=e,this.issuerName=t,this.redemptionContext=n,this.originInfo=i;let s=65535;if(t.length>s)throw new Error("invalid issuer name size");if(i&&i.join(",").length>s)throw new Error("invalid origin info size");if(!r.REDEMPTION_CONTEXT_LENGTH.includes(n.length))throw new Error("invalid redemptionContext size")}static deserialize(e){let t=0,n=new DataView(e.buffer),i=n.getUint16(t);t+=2;let s=n.getUint16(t);t+=2;let o=n.buffer.slice(t,t+s);t+=s;let c=new TextDecoder,l=c.decode(o);s=n.getUint8(t),t+=1;let f=new Uint8Array(n.buffer.slice(t,t+s));t+=s,s=n.getUint16(t),t+=2;let h;if(s>0){let d=n.buffer.slice(t,t+s);h=c.decode(d).split(",")}return new r(i,l,f,h)}serialize(){let e=new Array,t=new ArrayBuffer(2);new DataView(t).setUint16(0,this.tokenType),e.push(t);let n=new TextEncoder,i=n.encode(this.issuerName);t=new ArrayBuffer(2),new DataView(t).setUint16(0,i.length),e.push(t),t=i.buffer,e.push(t),t=new ArrayBuffer(1),new DataView(t).setUint8(0,this.redemptionContext.length),e.push(t),t=this.redemptionContext.buffer,e.push(t),t=new ArrayBuffer(2);let s=new Uint8Array(0);if(this.originInfo){let o=this.originInfo.join(",");s=n.encode(o)}return new DataView(t).setUint16(0,s.length),e.push(t),t=s.buffer,e.push(t),new Uint8Array(H(e))}},$e=class r{static{a(this,"AuthenticatorInput")}tokenType;nonce;challengeDigest;tokenKeyId;static NONCE_LENGTH=32;static CHALLENGE_LENGTH=32;constructor(e,t,n,i,s){if(this.tokenType=t,this.nonce=n,this.challengeDigest=i,this.tokenKeyId=s,t!==e.value)throw new Error("mismatch of token type");if(n.length!==r.NONCE_LENGTH)throw new Error("invalid nonce size");if(i.length!==r.CHALLENGE_LENGTH)throw new Error("invalid challenge size");if(s.length!==e.Nid)throw new Error("invalid tokenKeyId size");this.tokenType=e.value}static deserialize(e,t,n){let i=0,s=new DataView(t.buffer),o=s.getUint16(i);i+=2;let c=r.NONCE_LENGTH,l=new Uint8Array(s.buffer.slice(i,i+c));i+=c,c=r.CHALLENGE_LENGTH;let f=new Uint8Array(s.buffer.slice(i,i+c));i+=c,c=e.Nid;let h=new Uint8Array(s.buffer.slice(i,i+c));return i+=c,n.bytesRead=i,new r(e,o,l,f,h)}serialize(){let e=new Array,t=new ArrayBuffer(2);return new DataView(t).setUint16(0,this.tokenType),e.push(t),t=this.nonce.buffer,e.push(t),t=this.challengeDigest.buffer,e.push(t),t=this.tokenKeyId.buffer,e.push(t),new Uint8Array(H(e))}},Ce=class r{static{a(this,"Token")}authInput;authenticator;constructor(e,t,n){if(this.authInput=t,this.authenticator=n,n.length!==e.Nk)throw new Error("invalid authenticator size")}static deserialize(e,t){let n=0,i=new DataView(t.buffer),s={bytesRead:0},o=$e.deserialize(e,t,s);n+=s.bytesRead;let c=e.Nk,l=new Uint8Array(i.buffer.slice(n,n+c));return n+=c,new r(e,o,l)}serialize(){return new Uint8Array(H([this.authInput.serialize().buffer,this.authenticator.buffer]))}},Jr=class r{static{a(this,"Extension")}extensionType;extensionData;static MAX_EXTENSION_DATA_LENGTH=Gr-4;constructor(e,t){if(this.extensionType=e,this.extensionData=t,e<0||e>Gr||!Number.isInteger(e))throw new Error("invalid value for extension type, MUST be an integer between 0 and 2^16-1");if(t.length>r.MAX_EXTENSION_DATA_LENGTH)throw new Error("invalid extension data size. Max size is 2^16-4-1.")}static deserialize(e,t){let n=0,i=new DataView(e.buffer,e.byteOffset,e.length),s=i.getUint16(n);n+=2;let o=i.getUint16(n);n+=2;let c=e.slice(n,n+o);return n+=o,t.bytesRead=n,new r(s,c)}serialize(){let e=new Array,t=new ArrayBuffer(2);return new DataView(t).setUint16(0,this.extensionType),e.push(t),t=new ArrayBuffer(2),new DataView(t).setUint16(0,this.extensionData.length),e.push(t),t=this.extensionData.buffer,e.push(t),new Uint8Array(H(e))}},wr=class r{static{a(this,"Extensions")}extensions;constructor(e){this.extensions=e;let t=-1;for(let n of e){if(n.extensionType<t)throw new Error("extensions must be sorted by extension type");t=n.extensionType}}static deserialize(e){let t=0,i=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(t);t+=2;let s=e.subarray(t,t+i),o=0,c=new Array;for(;o<i;){let l={bytesRead:0},f=Jr.deserialize(s.subarray(o),l);c.push(f),o+=l.bytesRead}if(o<i)throw new Error(`there are ${i-o} remaining bytes unread`);return new r(c)}serialize(){let e=new Array,t=0;for(let i of this.extensions){let s=i.serialize();t+=s.length,e.push(s)}if(t>Gr)throw new Error("Extensions length MUST be less or equal to 2^16-1.");let n=new ArrayBuffer(2);return new DataView(n).setUint16(0,t),new Uint8Array(H([n,...e]))}};var G={};En(G,{BLIND_RSA:()=>K,BlindRSAMode:()=>Ue,Client:()=>kr,ClientWithMetadata:()=>Xr,ExtendedTokenRequest:()=>br,Issuer:()=>Nt,IssuerWithMetadata:()=>Yr,Origin:()=>Zr,OriginWithMetadata:()=>Qr,PARTIALLY_BLIND_RSA:()=>ee,PartiallyBlindRSAMode:()=>Wr,TokenRequest:()=>Pe,TokenResponse:()=>It,getPublicKeyBytes:()=>bi});var Ke=require("@cloudflare/blindrsa-ts");var Ue;(function(r){r[r.PSSZero=0]="PSSZero",r[r.PSS=48]="PSS"})(Ue||(Ue={}));var Wr=Ue,so={suite:{[Ue.PSSZero]:Ke.RSABSSA.SHA384.PSSZero.Deterministic,[Ue.PSS]:Ke.RSABSSA.SHA384.PSS.Deterministic},rsaParams:{name:"RSA-PSS",hash:"SHA-384"}},oo={suite:{[Wr.PSSZero]:Ke.RSAPBSSA.SHA384.PSSZero.Deterministic,[Wr.PSS]:Ke.RSAPBSSA.SHA384.PSS.Deterministic},rsaParams:{name:"RSA-PSS",hash:"SHA-384"}},K={value:2,name:"Blind RSA (2048)",Nk:256,Nid:32,publicVerifiable:!0,publicMetadata:!1,privateMetadata:!1,...so},ee={value:55930,name:"Partially Blind RSA (2048-bit)",Nk:256,Nid:32,publicVerifiable:!0,publicMetadata:!0,privateMetadata:!1,...oo};function ao(r){let e=pr(r);return crypto.subtle.importKey("spki",e,K.rsaParams,!0,["verify"])}a(ao,"getCryptoKey");async function bi(r){return yr(new Uint8Array(await crypto.subtle.exportKey("spki",r)))}a(bi,"getPublicKeyBytes");async function mi(r){return new Uint8Array(await crypto.subtle.digest("SHA-256",r))}a(mi,"getTokenKeyID");var Pe=class r{static{a(this,"TokenRequest")}truncatedTokenKeyId;blindedMsg;tokenType;constructor(e,t,n){if(this.truncatedTokenKeyId=e,this.blindedMsg=t,t.length!==n.Nk)throw new Error("invalid blinded message size");this.tokenType=n.value}static deserialize(e,t){let n=0,i=new DataView(t.buffer,t.byteOffset,t.byteLength),s=i.getUint16(n);if(n+=2,s!==e.value)throw new Error("mismatch of token type");let o=i.getUint8(n);n+=1;let c=e.Nk,l=new Uint8Array(t.buffer,t.byteOffset+n,c);return n+=c,new r(o,l,e)}serialize(){let e=new Array,t=new ArrayBuffer(2);return new DataView(t).setUint16(0,this.tokenType),e.push(t),t=new ArrayBuffer(1),new DataView(t).setUint8(0,this.truncatedTokenKeyId),e.push(t),t=this.blindedMsg.buffer,e.push(t),new Uint8Array(H(e))}},br=class r{static{a(this,"ExtendedTokenRequest")}request;extensions;constructor(e,t){this.request=e,this.extensions=t}static deserialize(e){let t=Pe.deserialize(ee,e),n=wr.deserialize(e.slice(3+ee.Nk));return new r(t,n)}serialize(){let e=new Array,t=this.request.serialize();e.push(t.buffer);let n=this.extensions.serialize();return e.push(n.buffer),new Uint8Array(H(e))}},It=class r{static{a(this,"TokenResponse")}blindSig;constructor(e){if(this.blindSig=e,e.length!==K.Nk)throw new Error("blind signature has invalid size")}static deserialize(e){return new r(e.slice(0,K.Nk))}serialize(){return new Uint8Array(this.blindSig)}},mr=class{static{a(this,"PubliclyVerifiableIssuer")}mode;name;privateKey;publicKey;params;suite;constructor(e,t,n,i,s){this.mode=e,this.name=t,this.privateKey=n,this.publicKey=i,this.params=s,this.suite=o=>{if(o===void 0)return K.suite[this.mode](this.params);{let c=ee.suite[this.mode](this.params),l=o.serialize();return{blindSign:a((f,h)=>c.blindSign(f,h,l),"blindSign"),verify:a((f,h,d)=>c.verify(f,h,d,l),"verify")}}}}async _issue(e,t){let n=await this.suite(t).blindSign(this.privateKey,e.blindedMsg);return new It(n)}async tokenKeyID(){return mi(await bi(this.publicKey))}verify(e){return this.suite().verify(this.publicKey,e.authenticator,e.authInput.serialize())}},Nt=class extends mr{static{a(this,"Issuer")}async issue(e){return super._issue(e)}static generateKey(e,t){return K.suite[e]().generateKey(t)}},Yr=class extends mr{static{a(this,"IssuerWithMetadata")}async issue(e){return super._issue(e.request,e.extensions)}static generateKey(e,t,n){return ee.suite[e]().generateKey(t,n)}},vr=class{static{a(this,"PubliclyVerifiableClient")}mode;extensions;finData;suite;tokenType;constructor(e,t){if(this.mode=e,this.extensions=t,this.extensions===void 0)this.tokenType=K,this.suite=K.suite[this.mode]();else{this.tokenType=ee;let n=ee.suite[this.mode](),i=this.extensions.serialize();this.suite={blind:a((s,o)=>n.blind(s,o,i),"blind"),finalize:a((s,o,c,l)=>n.finalize(s,o,i,c,l),"finalize")}}}async _createTokenRequest(e,t){let n=crypto.getRandomValues(new Uint8Array(32)),i=new Uint8Array(await crypto.subtle.digest("SHA-256",e.serialize())),s=await mi(t),o=new $e(this.tokenType,this.tokenType.value,n,i,s),c=o.serialize(),l=await ao(t),{blindedMsg:f,inv:h}=await this.suite.blind(l,c),d=s[s.length-1],g=new Pe(d,f,this.tokenType);return this.finData={tokenInput:c,authInput:o,inv:h,pkIssuer:l},g}deserializeTokenResponse(e){return It.deserialize(e)}async finalize(e){if(!this.finData)throw new Error("no token request was created yet");let t=await this.suite.finalize(this.finData.pkIssuer,this.finData.tokenInput,e.blindSig,this.finData.inv),n=new Ce(this.tokenType,this.finData.authInput,t);return this.finData=void 0,n}},kr=class extends vr{static{a(this,"Client")}async createTokenRequest(e,t){return super._createTokenRequest(e,t)}},Xr=class extends vr{static{a(this,"ClientWithMetadata")}async createTokenRequest(e,t){let n=await super._createTokenRequest(e,t);if(!this.extensions)throw new Error("no extensions available");return new br(n,this.extensions)}},Ar=class{static{a(this,"PubliclyVerifiableOrigin")}mode;originInfo;extensions;tokenType;suite;constructor(e,t,n){if(this.mode=e,this.originInfo=t,this.extensions=n,this.extensions===void 0)this.suite=K.suite[this.mode](),this.tokenType=K;else{let i=ee.suite[this.mode](),s=this.extensions.serialize();this.suite={verify:a((o,c,l)=>i.verify(o,c,l,s),"verify")},this.tokenType=ee}}async verify(e,t){return this.suite.verify(t,e.authenticator,e.authInput.serialize())}createTokenChallenge(e,t){return new Pt(this.tokenType.value,e,t,this.originInfo)}},Zr=class extends Ar{static{a(this,"Origin")}},Qr=class extends Ar{static{a(this,"OriginWithMetadata")}constructor(e,t,n){super(e,n,t)}};var W=Dr(Ji(),1);var Pr=W.Oprf.Suite.P384_SHA384,Ur=W.Oprf.getGroup(Pr),Wi=W.Oprf.getHash(Pr),Vo={suite:Pr,group:Ur,Ne:Ur.eltSize(),Ns:Ur.scalarSize(),Nk:W.Oprf.getOprfSize(Pr),hash:Wi,dleqParams:{group:Ur.id,hash:Wi,dst:new Uint8Array}},j={value:1,name:"VOPRF (P-384, SHA-384)",Nid:32,publicVerifiable:!1,publicMetadata:!1,privateMetadata:!1,...Vo};async function Mo(r){return new Uint8Array(await crypto.subtle.digest("SHA-256",r))}a(Mo,"getTokenKeyID");var Ir=class r{static{a(this,"TokenRequest")}truncatedTokenKeyId;blindedMsg;tokenType;constructor(e,t){if(this.truncatedTokenKeyId=e,this.blindedMsg=t,t.length!==j.Ne)throw new Error("blinded message has invalide size");this.tokenType=j.value}static deserialize(e){let t=0,n=new DataView(e.buffer),i=n.getUint16(t);if(t+=2,i!==j.value)throw new Error("mismatch of token type");let s=n.getUint8(t);t+=1;let o=j.Ne,c=new Uint8Array(n.buffer.slice(t,t+o));return t+=o,new r(s,c)}serialize(){let e=new Array,t=new ArrayBuffer(2);return new DataView(t).setUint16(0,this.tokenType),e.push(t),t=new ArrayBuffer(1),new DataView(t).setUint8(0,this.truncatedTokenKeyId),e.push(t),t=this.blindedMsg.buffer,e.push(t),new Uint8Array(H(e))}},wn=class r{static{a(this,"TokenResponse")}evaluateMsg;evaluateProof;constructor(e,t){if(this.evaluateMsg=e,this.evaluateProof=t,e.length!==j.Ne)throw new Error("evaluate_msg has invalid size");if(t.length!==2*j.Ns)throw new Error("evaluate_proof has invalid size")}static deserialize(e){let t=0,n=j.Ne,i=new Uint8Array(e.slice(t,t+n));t+=n,n=2*j.Ns;let s=new Uint8Array(e.slice(t,t+n));return new r(i,s)}serialize(){return new Uint8Array(H([this.evaluateMsg,this.evaluateProof]))}};var Nr=class{static{a(this,"Issuer")}name;privateKey;publicKey;vServer;constructor(e,t,n){this.name=e,this.privateKey=t,this.publicKey=n,this.vServer=new W.VOPRFServer(j.suite,this.privateKey)}async issue(e){let t=j.group.desElt(e.blindedMsg),n=new W.EvaluationRequest([t]),i=await this.vServer.blindEvaluate(n);if(i.evaluated.length!==1)throw new Error("evaluation is of a non-single element");let s=i.evaluated[0].serialize();if(typeof i.proof>"u")throw new Error("evaluation has no DLEQ proof");let o=i.proof.serialize();return new wn(s,o)}tokenKeyID(){return Mo(this.publicKey)}verify(e){let t=e.authInput.serialize();return this.vServer.verifyFinalize(t,e.authenticator)}};var re;(function(r){r.PRIVATE_TOKEN_ISSUER_DIRECTORY="application/private-token-issuer-directory",r.PRIVATE_TOKEN_REQUEST="application/private-token-request",r.PRIVATE_TOKEN_RESPONSE="application/private-token-response",r.ARBITRARY_BATCHED_TOKEN_REQUEST="application/private-token-arbitrary-batch-request",r.ARBITRARY_BATCHED_TOKEN_RESPONSE="application/private-token-arbitrary-batch-response"})(re||(re={}));var Xe={};En(Xe,{BatchedTokenRequest:()=>Fr,BatchedTokenResponse:()=>jt,Client:()=>kn,Issuer:()=>vn,OptionalTokenResponse:()=>Ye,TokenRequest:()=>Or});var qo=63,jo=16383,$o=1073741823,Ko=2147483647,Go=0,Yi=Ko,Lr=63,bn=a((r,e)=>{let t=r.getUint8(e);e+=1;let i=1<<(t>>6),s=t&Lr;for(let o=0;o<i-1;o+=1)s=(s<<8)+r.getUint8(e),e+=1;return{value:s,usize:i}},"read");var mn=a((r,e=Jo(r))=>{if(r>Yi)throw new Error("Number is too big");let t=new Uint8Array(e),n=255;switch(e){case 1:t[0]=0|r&Lr;break;case 2:t[0]=64|r>>8&Lr,t[1]=r&n;break;case 4:t[0]=128|r>>24&Lr,t[1]=r>>16&n,t[2]=r>>8&n,t[3]=r&n;break;case 8:t[0]=192,t[4]=r>>24&n,t[5]=r>>16&n,t[6]=r>>8&n,t[7]=r&n;break;default:throw new Error("Invalid length")}return t},"encode"),Jo=a(r=>{if(r<Go)throw new Error("Cannot encode negative numbers");if(r>Yi)throw new Error("Number is too big");return r>$o?8:r>jo?4:r>qo?2:1},"length");var Or=class r{static{a(this,"TokenRequest")}tokenRequest;constructor(e){this.tokenRequest=e}static deserialize(e){let t=An(e);switch(t.value){case ve.VOPRF.value:return new r(Ir.deserialize(e));case ve.BLIND_RSA.value:return new r(Pe.deserialize(t,e));default:throw new Error("Token Type not supported")}}serialize(){return this.tokenRequest.serialize()}get tokenType(){return this.tokenRequest.tokenType}get truncatedTokenKeyId(){return this.tokenRequest.truncatedTokenKeyId}get blindMsg(){return this.tokenRequest.blindedMsg}},Fr=class r{static{a(this,"BatchedTokenRequest")}tokenRequests;constructor(e){this.tokenRequests=e}static deserialize(e){let t=a((f,h=24)=>Array.from(f.slice(0,Math.min(h,f.length))).map(d=>d.toString(16).padStart(2,"0")).join(" "),"toHex"),n=0,i=new DataView(e.buffer,e.byteOffset,e.byteLength),{value:s,usize:o}=bn(i,n);if(n+=o,s+n!==e.length)throw new Error("provided bytes does not match its encoded length");let c=[],l=0;for(;n<e.length;){let f=new Uint8Array(e.buffer,e.byteOffset+n,e.length-n),h=An(f),d=Xi(h),g=new Uint8Array(e.buffer,e.byteOffset+n,d);n+=d+3,c.push(Or.deserialize(g))}return new r(c)}serialize(){let e=new Array,t=0;for(let i of this.tokenRequests){let s=i.serialize();e.push(s.buffer),t+=s.length}let n=mn(t);return new Uint8Array(H([n,...e]))}[Symbol.iterator](){let e=0,t=this.tokenRequests;return{next(){return e<t.length?{value:t[e++],done:!1}:{value:void 0,done:!0}}}}},Ye=class r{static{a(this,"OptionalTokenResponse")}tokenResponse;constructor(e){this.tokenResponse=e}static deserialize(e){return e.length===0?new r(null):new r(e)}serialize(){return this.tokenResponse===null?new Uint8Array:this.tokenResponse}},jt=class r{static{a(this,"BatchedTokenResponse")}tokenResponses;constructor(e){this.tokenResponses=e}static deserialize(e){let t=0,n=new DataView(e.buffer),{value:i,usize:s}=bn(n,t);if(t+=s,i+t!==e.length)throw new Error("provided bytes does not match its encoded length");let o=[];for(;t<e.length;){let c=n.getUint16(t);t+=2;let l=new Uint8Array(n.buffer.slice(t,t+c));t+=c,o.push(Ye.deserialize(l))}return new r(o)}serialize(){let e=new Array,t=0;for(let i of this.tokenResponses){let s=i.serialize(),o=new ArrayBuffer(2);new DataView(o).setUint16(0,s.length),e.push(o),t+=2,e.push(s),t+=s.length}let n=mn(t);return new Uint8Array(H([n,...e]))}[Symbol.iterator](){let e=0,t=this.tokenResponses;return{next(){return e<t.length?{value:t[e++],done:!1}:{value:void 0,done:!0}}}}},vn=class{static{a(this,"Issuer")}issuers;constructor(...e){this.issuers={1:[],2:[]};for(let t of e)t instanceof Nr?this.issuers[1].push(t):t instanceof Nt&&this.issuers[2].push(t)}async issuer(e,t){if(![ve.VOPRF.value,ve.BLIND_RSA.value].includes(e))throw new Error("unsupported token type");let n=this.issuers[e];for(let i of n){let s=await i.tokenKeyID();if(s[s.length-1]==t)return i}throw new Error("no issuer found provided the truncated token key id")}async issue(e){let t=[];for(let n of e)try{let s=(await(await this.issuer(n.tokenType,n.truncatedTokenKeyId)).issue(n.tokenRequest)).serialize();t.push(new Ye(s))}catch{t.push(new Ye(null))}return new jt(t)}tokenKeyIDs(e){return Promise.all(this.issuers[e].map(t=>t.tokenKeyID()))}async verify(e){let{tokenType:t,tokenKeyId:n}=e.authInput,i=n[n.length-1];return(await this.issuer(t,i)).verify(e)}[Symbol.iterator](){let e=0,t=[...this.issuers[1],...this.issuers[2]];return{next(){return e<t.length?{value:t[e++],done:!1}:{value:void 0,done:!0}}}}},kn=class{static{a(this,"Client")}createTokenRequest(e){return new Fr(e)}deserializeTokenResponse(e){return jt.deserialize(e)}};var $t={convertEncToRSASSAPSS:yr,convertRSASSAPSSToEnc:pr},ve={BLIND_RSA:K,PARTIALLY_BLIND_RSA:ee,VOPRF:j};function Xi(r){switch(r.value){case ve.VOPRF.value:return j.Ne+2*j.Nk;case ve.BLIND_RSA.value:return K.Nk;case ve.PARTIALLY_BLIND_RSA.value:return ee.Nk;default:throw new Error(`unrecognized or non-supported token type: ${r.value}`)}}a(Xi,"tokenEntryToSerializedLength");function An(r){let t=new DataView(r.buffer,r.byteOffset,r.byteLength).getUint16(0),n=Object.values(ve).find(i=>i.value===t);if(n===void 0)throw new Error(`unrecognized or non-supported token type: ${t}`);return n}a(An,"tokenRequestToTokenTypeEntry");async function Zi(r,e,t){if(e)return console.log(`[sidecar] (resolve) using explicit issuer request: ${e}`),e;console.log(`[sidecar] (resolve) GET directory: ${r}`);let n=await fetch(r,{method:"GET",headers:{accept:re.PRIVATE_TOKEN_ISSUER_DIRECTORY,...t??{}}});if(n.status!==200)throw new Error(`issuer directory fetch failed: HTTP ${n.status}`);let i=n.headers.get("content-type")?.toLowerCase();if(i!==re.PRIVATE_TOKEN_ISSUER_DIRECTORY)throw new Error(`unexpected directory Content-Type: ${i}`);let o=(await n.json())["issuer-request-uri"];if(!o)throw new Error("issuer-request-uri missing in directory");let c;try{return new URL(o),o}catch{c=`${new URL(r).origin}${o.startsWith("/")?o:`/${o}`}`}return console.log(`[sidecar] (resolve) issuer request resolved: ${c}`),c}a(Zi,"resolveIssuerRequestUrl");var es=require("node:crypto");var Yo=globalThis.crypto??es.webcrypto,{Client:Xo,BlindRSAMode:Qi,BLIND_RSA:Zo}=G,{BatchedTokenRequest:Mc,BatchedTokenResponse:Qo}=Xe;async function ea(r){let e=$t.convertRSASSAPSSToEnc(r),t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return await Yo.subtle.importKey("spki",t,{name:"RSA-PSS",hash:"SHA-384"},!1,["verify"])}a(ea,"importVerifyKeyFromDirectoryTokenKey");async function ta(r,e,t){let n=[],i=[],o=new G.Origin(Qi.PSS).createTokenChallenge(r,new Uint8Array(0));for(let c=0;c<t;c++){let l=new Xo(Qi.PSS),f=await l.createTokenRequest(o,e);n.push(f),i.push(async h=>{let d=l.deserializeTokenResponse(h);return await l.finalize(d)})}return{requests:n,finalizers:i}}a(ta,"buildBlindRsaRequestsN");async function ra(r,e,t,n,i){let s=e.map(v=>new Xe.TokenRequest(v)),c=new Xe.BatchedTokenRequest(s).serialize(),l=new Headers({"content-type":re.ARBITRARY_BATCHED_TOKEN_REQUEST,accept:re.ARBITRARY_BATCHED_TOKEN_RESPONSE,...i??{}}),f=await fetch(r,{method:"POST",headers:l,body:c});if(f.status!==200&&f.status!==206){let v=await f.text().catch(()=>"");throw new Error(`batched issuance failed: HTTP ${f.status} ${v}`)}let h=f.headers.get("content-type")?.toLowerCase();if(h!==re.ARBITRARY_BATCHED_TOKEN_RESPONSE)throw new Error(`unexpected Content-Type: ${h}`);let d=new Uint8Array(await f.arrayBuffer()),g=Qo.deserialize(d),w=[],y=new G.Origin(G.BlindRSAMode.PSS),m=await ea(n);for(let v=0;v<g.tokenResponses.length&&v<t.length;v++){let C=g.tokenResponses[v];if(!C.tokenResponse){console.warn(`[verify][${v}] tokenResponse = null`);continue}let E=await t[v](C.tokenResponse);if(y)try{let N=await y.verify(E,m);w.push(E.serialize()),console.log(`[verify][${v}] ${N?"OK":"FAIL"}`)}catch(N){console.warn(`[verify][${v}] error: ${N?.message??N}`)}}return w}a(ra,"batchedIssueAndFinalize");async function ts(r,e,t,n){let i=await Zi(r,n,t),s=await fetch(r,{headers:{accept:re.PRIVATE_TOKEN_ISSUER_DIRECTORY,...t??{}}});if(s.status!==200)throw new Error(`get directory failed: HTTP ${s.status}`);let o=await s.json();if(!o["token-keys"]?.length)throw new Error("no token-keys in directory");console.log(`[sidecar] (prefetch) POST batched(${e}) -> ${i}`);let c=(()=>{try{return new URL(o["issuer-request-uri"]),o["issuer-request-uri"]}catch{return`${new URL(i).origin}${o["issuer-request-uri"]}`}})(),l=o["token-keys"][0];if(l["token-type"]!==Zo.value)throw new Error(`unsupported token-type ${l["token-type"]}`);let f=Z.parse(l["token-key"]),h=$t.convertRSASSAPSSToEnc(f),d=new URL(c).host,{requests:g,finalizers:w}=await ta(d,f,e);return await ra(c,g,w,h,t)}a(ts,"getTokensOnce");var ns=require("node:crypto");var is=globalThis.crypto??ns.webcrypto,Kt={spkiKey:null,ts:0},rs=new Set;async function na(r){let e=[];for await(let t of r)e.push(t);if(!e.length)return{};try{return JSON.parse(Buffer.concat(e).toString("utf8"))}catch{return{}}}a(na,"readJson");function ia(r){if(!r)return null;let e=r.match(/^\s*PrivateToken\s+token="([^"]+)"\s*$/i);return e?e[1]:null}a(ia,"parseAuth");async function sa(r,e){let t=Date.now();if(Kt.spkiKey&&t-Kt.ts<5*6e4)return Kt.spkiKey;let n=await fetch(r,{headers:{accept:re.PRIVATE_TOKEN_ISSUER_DIRECTORY,...e??{}}});if(n.status!==200)throw new Error(`directory HTTP ${n.status}`);let i=await n.json();if(!i["token-keys"]?.length)throw new Error("no token-keys in directory");let s=Z.parse(i["token-keys"][0]["token-key"]),o=$t.convertRSASSAPSSToEnc(s),c=o.buffer.slice(o.byteOffset,o.byteOffset+o.byteLength),l=await is.subtle.importKey("spki",c,{name:"RSA-PSS",hash:"SHA-384"},!1,["verify"]);return Kt.spkiKey=l,Kt.ts=t,l}a(sa,"getVerifyKeyFromDirectory");async function ss(r,e,t){try{let n=await na(r),i=r.headers.authorization,s=ia(i??null),o=typeof n?.token=="string"?n.token:void 0,c=s??o;if(!c)return e.writeHead(400,{"content-type":"application/json"}),e.end(JSON.stringify({ok:!1,error:"missing PrivateToken"}));let l=Z.parse(c),f=G.BLIND_RSA;if(n?.token_type!=null){let v=n.token_type;if(typeof v=="string"&&v.toLowerCase().includes("blind"))f=G.BLIND_RSA;else if(typeof v=="number"&&v!==G.BLIND_RSA.value)return e.writeHead(415,{"content-type":"application/json"}),e.end(JSON.stringify({ok:!1,error:`unsupported token_type ${v}`}))}let h=await is.subtle.digest("SHA-256",l),d=Buffer.from(h).toString("hex");if(rs.has(d))return e.writeHead(409,{"content-type":"application/json"}),e.end(JSON.stringify({ok:!1,error:"replayed",token_hash:d}));let g=Ce.deserialize(f,l),w=new G.Origin(G.BlindRSAMode.PSS),y=await sa(t.issuerDirectoryUrl,t.extraHeaders);return await w.verify(g,y)?(rs.add(d),e.writeHead(200,{"content-type":"application/json"}),e.end(JSON.stringify({ok:!0,token_hash:d}))):(e.writeHead(401,{"content-type":"application/json"}),e.end(JSON.stringify({ok:!1,error:"invalid"})))}catch(n){return e.writeHead(500,{"content-type":"application/json"}),e.end(JSON.stringify({ok:!1,error:n?.message??String(n)}))}}a(ss,"handleVerify");var oa=a(r=>Z.stringify(r),"toB64u");function cs(r,e){let t=os.default.createServer(async(n,i)=>{try{if(!n.url)return i.statusCode=400,i.end("bad request");let s=new as.URL(n.url,`http://localhost:${r.port}`);if(n.method==="GET"&&s.pathname==="/health"){let o=await e.count();return i.writeHead(200,{"content-type":"application/json"}),i.end(JSON.stringify({ok:!0,tokens:o}))}if(n.method==="POST"&&s.pathname==="/prefetch"){let o=Number(s.searchParams.get("count")??r.prefetchBatchSize),l=(await ts(r.issuerDirectoryUrl,o,r.extraHeaders,r.issuerRequestUrl)).map(oa);return await e.addMany(l),i.writeHead(200,{"content-type":"application/json"}),i.end(JSON.stringify({ok:!0,added:l.length,total:await e.count()}))}if(n.method==="POST"&&s.pathname==="/take"){let o=Number(s.searchParams.get("count")??1),c=await e.take(o);return i.writeHead(200,{"content-type":"application/json"}),i.end(JSON.stringify({ok:!0,items:c.map(l=>({header:`PrivateToken token="${l}"`})),remaining:await e.count()}))}if(n.method==="POST"&&s.pathname==="/verify")return ss(n,i,r);i.statusCode=404,i.end("not found")}catch(s){i.statusCode=500,i.end(`error: ${s?.message??String(s)}`)}});return t.listen(r.port,()=>{console.log(`[sidecar] listening on :${r.port}`),console.log(`[sidecar] issuer directory: ${r.issuerDirectoryUrl}`)}),t}a(cs,"startServer");async function aa(){let r=xn(),e=new Wt(r.storePath);cs(r,e)}a(aa,"main");aa().catch(r=>{console.error("[sidecar] fatal:",r),process.exit(1)});
