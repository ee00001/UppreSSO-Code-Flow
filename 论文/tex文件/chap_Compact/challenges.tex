\section{The Identity-Transformation Framework}
%\section{The Identifier-Transformation Approach of UPPRESSO}
\label{sec:challenge}

This section investigates the security and privacy requirements of SSO,
    and explains the identity dilemma of privacy-preserving SSO.
Then,
    we present the identity-transformation framework which helps to design UPPRESSO.
%Finally, this framework is applied to analyze existing privacy-preserving SSO systems.

\subsection{Security Requirements of SSO}
\label{subsec:basicrequirements}
%A dedicated, the bidirectional authenticated secure channel was proposed to improve the confidentiality and integrity of identity token \cite{CaoSBKVC14}.

The primary goal of non-anonymous SSO services is secure user authentication \cite{SPRESSO},
 to ensure that a \emph{legitimate} user can always login to an \emph{honest} RP as his permanent identity at this RP, %correlating multiple login instances,
    by presenting the \emph{identity tokens} issued by the \emph{honest} IdP.

To achieve this goal,
 an identity token generated by the IdP is required to specify (\emph{a}) the RP to which the user requests to login (i.e., \emph{RP designation})
    and  (\emph{b}) exactly the user who is authenticated by the IdP (i.e., \emph{user identification}).
Accordingly,
    an honest RP verifies the designated RP identity (or pseudo-identity) in identity tokens with its own before accepting the tokens;
     otherwise,
        a malicious RP could replay a received identity token to the honest RP and login as the victim user.
The RP allows the token holder to login as the user identity (or pseudo-identity) specified in the accepted tokens;
    otherwise, the IdP provides only anonymous services.

The SSO login flow implies \emph{confidentiality} and \emph{integrity} of identity tokens.
An identity token shall be forwarded by the authenticated user to the target RP only,
    not leaked to adversaries;
        otherwise, an adversary who presents the token, would successfully login to this honest RP.
Integrity is necessary,
    to prevent adversaries from tampering with an identity token,
        without being detected by the RPs.
So identity tokens are signed by the IdP and usually transmitted over HTTPS.

These four security requirements (i.e., RP designation, user identification, confidentiality, and integrity) of SSO identity tokens
     have been discussed and analyzed \cite{ArmandoCCCT08,FettKS16, FettKS17},
     and
     any vulnerabilities breaking one or more of these properties in SSO systems
            result in effective attacks \cite{SomorovskyMSKJ12, WangCW12, ArmandoCCCPS13, ZhouE14, WangZLLYLG15, WangZLG16, YangLLZH16, MainkaMS16, MainkaMSW17, YangLCZ18, YangLS17, ShiWL19, ChenPCTKT14, ccsSunB12, DiscoveringJCS, dimvaLiM16, CaoSBKVC14, TowardsShehabM14}.
An adversary might attempt to login to an honest RP as a victim user (i.e., \emph{impersonation}),
 or allure a victim user to login to an honest RP as the attacker (i.e.,  \emph{identity injection}).
For example, Friendcaster used to accept any received identity token, which violates RP designation \cite{ChenPCTKT14},
    so a malicious RP could replay a received identity token to Friendcaster and login as the victim user.
The defective IdP of Google ID SSO signs identity tokens where the Email element was not enclosed,
        while some RPs use a user's Email as his unique username \cite{WangCW12}.
So this violation of user identity resulted in vulnerable services.
Because identity tokens were leaked in different ways \cite{WangCW12,ccsSunB12,ArmandoCCCPS13,DiscoveringJCS,dimvaLiM16},
 the eavesdroppers could impersonate the victim users.
Some RPs even accept user attributes that are not bound in identity tokens (i.e., a violation of integrity) \cite{WangCW12},
  so that adversaries could insert arbitrary attributes into the identity tokens to impersonate another user at these RPs.


\begin{comment}
We summarize the basic requirements of SSO systems based on existing theoretical analyses \cite{ArmandoCCCT08,FettKS16, FettKS17} and practical attacks \cite{SomorovskyMSKJ12,WangCW12,ArmandoCCCPS13,ZhouE14,WangZLLYLG15,WangZLG16,YangLLZH16,MainkaMS16,MohsenS16,MainkaMSW17,YangLCZ18,YangLS17,ShiWL19}. These requirements enable an SSO system to provide qualified authentication services for RPs, through identity tokens.
\begin{itemize}
\item \textbf{User identification.} When a user logs into a certain RP for multiple times by submitting identity tokens, the RP extracts the identical user identifier from these identity tokens, to provide personalized services for this user.
\item \textbf{RP designation.} The designated receiver (or RP) is specified in an identity token, so that this identity token is accepted by the visited RP only.
\item \textbf{Integrity and confidentiality.} Only the IdP is trusted to generate identity tokens, RPs do not accept an identity token with any modification or a forged one. %RPs should only accept the valid identity token.
Meanwhile, a valid identity token is transmitted only to the user and the designated RP. % confidentiality of the identity token is ensured during the transmission among the IdP, user and the designated RP.
\end{itemize}

%These basic requirements are the minimum properties that an SSO system has to provide.
% therefore RPs should be able to identify the user with the help from IdP.
First of all, user identification is necessary for common SSO systems to help the RPs to receive the user's identifier, except the anonymous services.
Any violation of these requirements \cite{SomorovskyMSKJ12,WangCW12,ArmandoCCCPS13,ZhouE14,WangZLLYLG15,WangZLG16,YangLLZH16,MainkaMS16,MohsenS16,MainkaMSW17,YangLCZ18,YangLS17,ShiWL19} result in \emph{impersonation attacks} (i.e., the adversaries log into an honest RP as a victim user) or \emph{identity injection attacks} (i.e., a victim user logs into an honest RP under some attacker's identity).
% and without integrity, the impersonation and identity injection attacks could be constructed easily
% as an adversary could directly modify user's identifier in the identity token;
If the designated RP is not well specified or verified in identity tokens, the adversaries could deceive an RP to accept the identity tokens generated for other RPs, so that the adversaries would (\emph{a}) impersonate some victim user, by colluding with a malicious RP to obtain such an identity token and submitting it to the RP, or (\emph{b}) inject such identity tokens in the communications between the victim user and some RP.
   %                  for example, by CSRF \cite{zeller2008cross}.
Impersonation and identity injection attacks would be successfully launched, if the attackers could arbitrarily modify the user identifiers in identity tokens.
Or, the adversaries could impersonate the victim user by submitting any leaked identity token to the RP \cite{ChenPCTKT14,FettKS16,WangZLG16}, if confidentiality is not well ensured.

The design and implementation of a secure SSO system is challenging, while various vulnerabilities have been found and exploited to break at least one requirement \cite{ChenPCTKT14, FettKS16,WangCW12,ZhouE14,WangZLG16,YangLLZH16,SomorovskyMSKJ12,MohsenS16}.
For example, Friendcaster was found to accept any received identity token \cite{ExplicatingSDK,ChenPCTKT14}
(i.e., a violation of RP designation) so that a malicious RP could log into Friendcaster as the victim user by replaying the identity token received from the user to Friendcaster \cite{MohsenS16}. \cite{WangCW12} reported that some RPs of Google ID SSO accepted user attributes that were not tied to the identity token (i.e., a violation of integrity). As a result, a malicious user could insert arbitrary attributes (e.g., an email address) into the identity token to impersonate another user at the RP.
\end{comment}


\subsection{The Identity Dilemma of Privacy-Preserving SSO}
\label{subsec:challenges}
A \emph{completely} privacy-preserving SSO system shall offer the four security properties as mentioned above,
    while prevent the privacy threats due to the IdP-based login tracing and the RP-based identity linkage.
However, to satisfy the requirements of security and privacy at the same time,
     poses a dilemma in the generation of identity tokens as follows.
Table \ref{tbl:notations-dilemma} lists the notations used in the following explanation,
    and the subscript $j$ and/or the superscript $i$ may be omitted sometimes, when there is no ambiguity.

\begin{table}[t]
\footnotesize
    \caption{The (pseudo-)identities in privacy-preserving SSO.}
    \centering
%    \begin{tabular}{|l|l|l|}
    \begin{tabular}{|p{1.0cm}|p{5.1cm}|p{1.13cm}|} \hline
    {\textbf{Notation}} & {\textbf{Description}} & {\textbf{Attribute}} \\ \hline
    {$ID_U$} & {The user's unique identity at the IdP.} & {Permanent} \\ \hline
    {$ID_{RP_j}$} & {The $j$-th RP's unique identity at the IdP.} & {Permanent} \\ \hline
    {$PID_{U,j}^i$} & {The user's pseudo-identity, in the user's $i$-th login instance to the $j$-th RP.} & {Ephemeral} \\ \hline
    {$PID_{RP_j}^i$} & {The $j$-th RP's pseudo-identity, in the user's $i$-th login instance to this RP.} & {Ephemeral} \\ \hline
    {$Acct_j$} & {The user's identity (or account) at the $j$-th RP.} & {Permanent} \\ \hline
    \end{tabular}
    \label{tbl:notations-dilemma}
\end{table}


A valid identity token contains the identities (or pseudo-identities) of the authenticated user and the target RP. %which is to tell the RP that this user has been authenticated by the IdP.
% Let us denote the long-term unique identifiers of the user and the RP as $ID_U$ and $ID_{RP}$, respectively.
Since the IdP authenticates users and always knows the user's identity (i.e., $ID_U$),
    in order to prevent the IdP-based login tracing,
    we shall not reveal the target RP's permanent identity (i.e., $ID_{RP}$) to the IdP in the login flow.
So an \emph{ephemeral} pseudo-identity for the RP (i.e., $PID_{RP}$) shall be used in the communications with the IdP:
(\emph{a}) to ensure RP designation,
     $PID_{RP}$ shall be uniquely associated with the target RP;
    and (\emph{b}) the IdP cannot derive any information about $ID_{RP}$ from any $PID_{RP}^i$,
        which implies $PID_{RP}^i$ in multiple login instances shall
         be independent of each other.\footnote{Even when the target RP is kept unknown to the IdP,
            the IdP shall not link multiple login instances which attempt to visit this RP.}
   % the IdP-based login tracing is still effective, to correlate a user's multiple login instances.

Next, in order to prevent the RP-based identity linkage,
 the IdP shall not directly enclose $ID_U$ in identity tokens.
A pseudo-identity for the user (i.e., $PID_U$) shall be bound instead:
    (\emph{a}) the RP cannot derive any information about $ID_U$ from any $PID_{U,j}$,
    which implies $PID_{U,j}$ for different RPs shall be independent of each other;
    (\emph{b}) in multiple login instances to the RP, $PID_U^i$ shall be independent of each other or generated ephemerally,
        to prevent the IdP-based login tracing;\footnote{If $PID_U^i$ is not completely independent of each other,
         it implies the IdP could link multiple login instances which attempt to visit this RP.}
    and (\emph{c}) to ensure user identification,
    an \emph{ephemeral} $PID_{U}^i$ in each login instance shall facilitate the RP to correlate it
     with the \emph{permanent} account  at this RP (i.e., $Acct$).


In other words,
    (\emph{a}) an identity token contains only pseudo-identities, i.e., $PID_{U,j}^i$ and $PID_{RP_j}^i$,
        which are independent of each other for different RPs and in multiple login instances, respectively,
    and (\emph{b}) these two \emph{ephemeral} pseudo-identities enable the target RP to derive a \emph{permanent} account, i.e., $Acct_j$.

Figure \ref{fig:IDCorrelation} illustrates the relationships among the identities and pseudo-identities in identity tokens.
The red and green blocks represent permanent identities and ephemeral pseudo-identities, respectively.
The arrows denote the transformations of (pseudo-)identities.
The figure describes the {\em identity dilemma} of privacy-preserving SSO:
\begin{quote}
Given an authenticated user and an unknown RP (i.e., permanent $ID_U$ and ephemeral $PID_{RP}$),
    the IdP is expected to generate an ephemeral pseudo-identity (i.e., $PID_{U}$)
     which will be correlated with the user's permanent identity at this RP (i.e., $Acct$),
     while knowing nothing about the RP's identity or the user's account at this RP (i.e., $ID_{RP}$ or $Acct$).
\end{quote}

We explicitly distinguish a user's identity at the RP, i.e., the account,
     from \emph{(a)} the user's identity at the IdP and \emph{(b)} the user's pseudo-identity in identity tokens.
This conceptualization %is proposed for the first time, to the best of our knowledge,
   % and it 
    essentially helps to effectively propose the identity-transformation framework.


\begin{figure}
  \centering
  \includegraphics[width=0.99\linewidth]{fig/IDCorrelation.pdf}
  \caption{Identity transformations in privacy-preserving SSO.}
  \label{fig:IDCorrelation}
\end{figure}

\subsection{Identity Transformation}
\label{subsec:solutions}

%In the identity dilemma, we explicitly separate a user's account at the RP
%     from the user's unique identity at the IdP and the user's  pseudo-identity in identity tokens.
%This method guides us to propose the identity-transformation framework
%    (and then to solve the identity dilemma).


%we should provide the IdP some information related to the user's $Account$ at the RP to assist the generation of $PID_U$,
% so that $PID_U$ can be correctly correlated with the $Account$. Meanwhile, such information should not provide any additional knowledge for the IdP to derive the RP's identity, or for two RPs to correlate two $Account$s belonging to the same user.
The privacy-protection problem of SSO is converted into an identity-transformation challenge,
 to design three \emph{identity-transformation functions} as follows.
\begin{itemize}
\item
$\mathcal{F}_{PID_{RP}}(ID_{RP}) = PID_{RP}$, calculated by the user and/or the RP.
From the IdP's view,
$\mathcal{F}_{PID_{RP}}()$ is a one-way function and the calculated $PID_{RP}$ appears a random variable.
\item
$\mathcal{F}_{PID_U}(ID_U, PID_{RP}) = PID_{U}$, calculated by the IdP.
From the RP's view,
    $\mathcal{F}_{PID_U}()$ is a one-way function and the calculated $PID_{U}$ appears a random variable.
\item
$\mathcal{F}_{Acct}(PID_{U}, PID_{RP}) = Acct$, calculated by the RP.
Given $ID_U$ and $ID_{RP}$, $Acct$ keeps unchanged;
    i.e., in the user's any $i$-th and $i'$-th ($i \neq i'$) login instances to the RP,
 $\mathcal{F}_{Acct}(PID_{U}^i, PID_{RP}^i) = \mathcal{F}_{Acct}(PID_{U}^{i'}, PID_{RP}^{i'})$.
\end{itemize}


In an SSO login flow with the identity-transformation functions,
    a user firstly negotiates an ephemeral $PID_{RP}$ with the target RP.
Then, an identity-token request with $PID_{RP}$ is sent by the user to the IdP.
After authenticating the user as $ID_U$, the IdP calculates an ephemeral $PID_U$ based on $ID_U$ and the received $PID_{RP}$,
    and issues an identity token binding $PID_U$ and $PID_{RP}$.
This token is forwarded by the user to the RP.
Finally, after verifying the designated RP pseudo-identity in the token,
    the RP calculates $Acct$ and allows the token holder to login as $Acct$.

%To achieve this goal, UPPRESSO constructs three transformation functions in an integrated way to support {\em transformed RP designation} and {\em trapdoor user identification}, where (a) different $PID_U$s and $PID_{RP}$s are dynamically generated in different logins; (b) in each login session, $PID_{RP}$ is used to assist the generation of $PID_U$, which helps to link $PID_U$ to $Account$ using the trapdoor of this login session.%; and (c) when a user logs in to an RP multiple times, the RP can correlate each pair of $PID_U$ and $PID_{RP} with an invariant $Account$.

The identity-transformation functions
        satisfy the privacy requirements,
    while the authentication steps are still kept independent of the ``pure'' SSO protocol.
%In particular,
%    as shown in Figure \ref{fig:OpenID},
%        the  authentication steps are conducted only between a user and the IdP,
%            and these steps do not deal with identity tokens.
In particular, after the identity-transformation functions are integrated in a privacy-preserving SSO system,
    the steps dealing with identity tokens do not involve any user credentials,
        as those in the commonly-used SSO protocols \cite{OpenIDConnect,rfc6749,SAML}.

\begin{comment}
three pseudo-identities (i.e., $PID_U$, $PID_{RP}$, and $Account$)
in a \emph{dynamical} and \emph{comprehensive} way,
    based on \emph{static} $ID_U$ and $ID_{RP}$.
% user和RP，协商trapdoor，给$PID_U$, $PID_{RP}$带进来随机因子，同时使得只有trapdoor的RP能够计算得到Account。
That is,
    for a certain user,
in each login process at an RP,
    $PID_U$ and $PID_{RP}$ vary
        to satisfy the requirements of privacy;
but $PID_U$ and $PID_{RP}$ vary synchronously so that identical $Account$s are derived.
In particular,
    the user and the RP negotiate $PID_{RP}$ based on $ID_{RP}$ in each login process,
        and then $PID_{RP}$ is transmitted by the user to the IdP.
        Then, the IdP generates $PID_U$ based on $ID_U$ and also $PID_{RP}$.
At the same time, the RP obtains a private trapdoor in the negotiation,
    which is used to derive $Account$ from $PID_U$.

\end{comment}


%Then, we analyze the generation and use of $PID_U$ and $PID_{RP}$, considering the basic requirements of SSO system.
%\begin{itemize}
%%  \item %What's the requirement considering $PID_{U}$ and $PID_{RP}$ together? $PID_{U}$ and $PID_{RP}$一起考虑时需要满足的。
%%  The generation of $PID_{U}$ and $PID_{RP}$ must ensure the \textbf{user identification},
%%  that is, the RP could derive a same $Account$ with the $PID_{U}$ and $PID_{RP}$ from different logins. We assume RP calculates $Account$ by invoking $\mathcal{F}_{PID_{U} \mapsto Account}$ with $PID_U$, $ID_{RP}$ and $PID_{RP}$.
%
%  \item %Who generates $PID_{RP}$, and what's the requirement? PID_RP可以由RP或者user合作生成，但要保证唯一性。
%  Each $PID_{RP}$ must be globally unique, i.e., only assigned to one RP,  for achieving the \textbf{RP designation}.
%        The user and RP may generate the $PID_{RP}$ separately or cooperatively, through the function $\mathcal{F}_{ID_{RP} \mapsto PID_{RP}}$.
%        However, both the user and RP must check the uniqueness of $PID_{RP}$ before accept and use it.
%        If either the user or the RP doesn't perform the check, the adversary could make it accept a $PID_{RP}$ same as an RP and then misuse the identity token.
%        %$PID_{RP}$ is one form of the RP's identifer, and seems unrelated with the user's identifier.
%        %Although, the user may inject the user's information into $PID_{RP}$, these information will be treated as random values at the RP and never be used to calculate $Account$, as the user is not trusted by the RP.
%        %Therefore, we can assume that $PID_{RP}$ is generated through $\mathcal{F}_{ID_{RP} \mapsto PID_{RP}}$ with the parameter $ID_{RP}$.~\footnote{The $PID_{RP}$ may also be related with the previous $PID_{RP}$. We omit the previous $PID_{RP}$ in the parameters as it is also a transformation of $ID_{RP}$.}
%  \item The \textbf{RP designation} further requires that  $PID_{U}$ is bound with either a non-null $PID_{RP}$ or $ID_{RP}$ in identity token.
%        When $PID_{RP}$  is non-null, IdP builds the identity token separately and the \textbf{integrity} is also ensured.
%        When $PID_{RP}$  is null, only the user could bind $PID_{U}$ with an RP identifier (i.e., $ID_{RP}$) which is unique and checkable to the RP.
%        In this case, the user who performs the binding, must have a publicly verifiable grant from the IdP, as required by \textbf{integrity}.
%%        The binding and integrity cloud be achieved by existing public key infrastructure.
%   \item The \textbf{RP designation} also requires the identity token will only be sent to the correct RP.
%       As IdP doesn't know $ID_{RP}$, the user or a third party trusted by the correct RP will ensure this.
%\end{itemize}

%\vspace{0.5mm}
%\noindent \textbf{Transformed RP designation.} To prevent IdP-based login tracing, the RP includes a $PID_{RP}$ dynamically transformed from $ID_{RP}$ in the identity token request. UPPRESSO designs a novel trapdoor-based transformation function $\mathcal{F}_{ID_{RP} \mapsto PID_{RP}}(ID_{RP}, T)$ to compute $PID_{RP}$ based on $ID_{RP}$ and a random trapdoor $T$ that is dynamically negotiated between the user and the RP in each login. Then, the user assists the RP to register $PID_{RP}$ at the IdP through OIDC dynamic registration. When an RP receives an identity token, it verifies if the enclosed $PID_{RP}$ is transformed from its $ID_{RP}$ and the trapdoor of this login session.

%To bind dynamic $PID_{RP}$ in identity tokens signed by the IdP, the user firstly cooperates with the RP to generate $PID_{RP}$ based on $ID_{RP}$ and then registers this transformed RP identifier (i.e., $PID_{RP}$) in the IdP.
%The identifier transformation of RP is completely kept secret to the IdP. Then, the one-time $PID_{RP}$ is bound with $PID_U$ in the identity token. $PID_{RP}$ is calculated based on $ID_{RP}$ and the trapdoor, so that the RP holding the trapdoor is able to verify the specified receiver of identity tokens with transformed $PID_{RP}$ but not $ID_{RP}$.


%\vspace{0.5mm}
%\noindent \textbf{Trapdoor user identification.} To prevent RP-based identity linkage, we design a transformation function $\mathcal{F}_{ID_{U} \mapsto PID_U}(ID_U, PID_{RP})$ for the IdP to generate $PID_U$. When an RP receives an identity token, another transformation function $\mathcal{F}_{PID_{U} \mapsto Account}(PID_U, PID_{RP}, T)$ is designed to help the RP to derive the $Account$ from $PID_U$ and $PID_{RP}$ using the trapdoor it holds. Intuitively, the trapdoor $T$ plays a role in the generations of $PID_{RP}$ and $PID_U$, directly or indirectly.

%Existing SSO solutions always depend on constant $ID_U$ in all identity tokens or RP-specific $PID_U$ that keeps constant for an RP, to identify an account in the RP.
%UPPRESSO introduces trapdoor user identification, where an RP holds a trapdoor $T$ to derive the identical $Account$ from dynamic $PID_{U}$s in identity tokens. Intuitively, the trapdoor $T$ also plays a part in the generations of $PID_{RP}$ and $PID_U$,
%    (i.e., $\mathcal{F}_{ID_{RP} \mapsto PID_{RP}}$ and $\mathcal{F}_{ID_{U} \mapsto PID_{U}}$),
%directly or indirectly.

%
%$\mathcal{F}_{ID_{RP} \mapsto PID_{RP}}$  is invoked with a trapdoor to generate $PID_{RP}s$ which are independent to IdP (preventing IdP-based login tracing),
% and RP uses $\mathcal{F}_{PID_{U} \mapsto Account}$ with this trapdoor to derive the unchanged $Accout$  from $PID_{U}$s that are generated by IdP with $\mathcal{F}_{ID_{U} \mapsto PID_{U}}$.




%UPPRESSO splits the RP designation into two steps: IdP designates the identity token to a transformed RP identifer (i.e., $PID_{RP}$), while the user and RP cooperatively designate a fresh and unique $PID_{RP}$ only to one $ID_{RP}$. Then, each RP only needs to check the designation based on $PID_{RP}$.
%\begin{itemize}
%  \item In the first step, the IdP generates $PID_U$ for $PID_{RP}$ and achieves full privacy-preserving binding (i.e., $PID_U$ with $PID_{RP}$).
%UPPRESSO introduces an efficient one-way (trapdoor) function $\mathcal{F}_{ID_{U} \mapsto PID_{U}}$.
% It allows IdP to  compute $PID_U$ easily,  avoiding the generation of $PID_U$ to be the bottleneck at a high-throughput IdP;
%   and also prevents the RP from finding any information about $ID_U$, which is required by preventing RP-based identity linkage.
%  \item In the second step, the user and RP cooperatively generate a fresh $PID_{RP}$ based on $\mathcal{F}_{ID_{RP} \mapsto PID_{RP}}$ and check the uniqueness of the $PID_{RP}$, therefore a fresh and unique $PID_{RP}$ is only mapped to one RP, when at least a correct user or correct RP exists. Moreover, the user needs to extract the correct endpoint of $ID_{RP}$, to ensure that the  identity token is sent to the only correct RP.
%\end{itemize}

%To meet the above two principles, we need to construct three satisfying functions $\mathcal{F}_{ID_{RP} \mapsto PID_{RP}}$, $\mathcal{F}_{ID_{U} \mapsto PID_{U}}$ and $\mathcal{F}_{PID_{U} \mapsto Account}$, design the protocols between the user, RP and IdP to avoid the privacy leakage during message transmission, and implement the  processing at the user as  required by the transformed RP designation.



\begin{comment}
\subsection{Applying Identifier-Transformation to Existing Privacy-Preserving SSO Solutions}
We map three existing privacy-preserving SSO approaches (PPID \cite{OpenIDConnect}, BrowserID \cite{BrowserID} and SPRESSO \cite{SPRESSO})
 to the identifier transformation framework in Figure \ref{fig:IDCorrelation} and summarize their potential privacy issues in Table \ref{tbl:compare}.
When $PID_U = ID_U$ and $PID_{RP} = ID_{RP}$, this framework depicts the basic SSO services with no privacy protection.

\begin{table}[b]
    \caption{Identifier-transformation in privacy-preserving SSO.}
    \centering
    \setlength{\tabcolsep}{0.5mm}
    \begin{tabular}{|c|c|c|c|}
    \hline
    {\textbf{Solution}} & {{$\mathcal{F}_{ID_{U} \mapsto PID_{U}}$}} & {{$\mathcal{F}_{ID_{RP} \mapsto PID_{RP}}$}} & {{$\mathcal{F}_{PID_{U} \mapsto Account}$}}\\
    \hline
    {PPID} & {{$Map[ID_U,ID_{RP}]$ (\checkmark)}} & {{$ID_{RP}$ ($\times$)}} & {{$PID_U$ (\checkmark)}}\\
    \hline
    {SPRESSO} & {{$ID_U$ ($\times$)}} & {{$Enc(ID_{RP}||nonce)$} (\checkmark)} &{{$ID_U$ ($\times$)}}\\
    \hline
    {BrowserID} & {{$ID_U$ ($\times$)}} & {{$\bot$ (\checkmark)}} &{{$ID_U$ ($\times$)}}\\
    \hline
    {UPPRESSO} & {{${PID_{RP}}^{ID_U}$ (\checkmark)}}  & {{${ID_{RP}}^{N_UN_{RP}}$ (\checkmark)}} & {{${PID_{U}}^{T}$ (\checkmark)}}\\
    \hline
    \end{tabular}
    \label{tbl:compare}
\end{table}



% 将Table 1放到这里来
% 对于BrowserID，说法是：PID_RP = null，但是多了subsidiary identity token generated by the authenticated user,
% ID_RP in subsidiary identity token.

% Various solutions \cite{OpenIDConnect, SAMLIdentifier,BrowserID,SPRESSO}, are proposed, attempting to construct a secure and privacy-preserving SSO system.

In PPID approaches, PPIDs are used as $PID_U$s for a user at different RPs. There are deterministic one-to-many mappings from $ID_U$ to $PID_U$s.
However, the RP sends its real identifier to IdP in each login and thus suffers from IdP-based login tracing.
%the IdP generates different $PID_U$s for a user to log in to different RPs and maintains deterministic one-to-many mappings from $ID_U$ to $PID_U$s. Therefore, they can prevent RP-based identity linkage. At each RP, a user is identified by a same $PID_U$ (i.e., $Account = PID_U$), which ensures user identification. However, since $ID_{RP}$ is directly used in identity tokens (i.e., $PID_{RP} = ID_{RP}$), these approaches are vulnerable to IdP-based login tracing.


%However, these scheme provide at most two satisfying functions, and therefore fail to prevent either the IdP-based login tracing or RP-based identity linkage.
%\begin{itemize}
%  \item The traditional SSO systems provide no satisfying functions, and therefore fail to protect the user's privacy.
%  \item SAML \cite{SAMLIdentifier} and OIDC \cite{OpenIDConnect} provide only the satisfying $\mathcal{F}_{ID_{U} \mapsto PID_{U}}$ and $\mathcal{F}_{PID_{U} \mapsto Account}$ .
%        The IdP obtains the $ID_{RP}$ for an RP, and generates the unchanged $PID_{U}$ for the same couple $<ID_{U}$, $ID_{RP}>$,
%        while the $PID_{U}$ are independent for different $ID_{RP}$s.
%  \item BrowserID \cite{BrowserID} and SPRESSO \cite{SPRESSO} provide only the satisfying $\mathcal{F}_{ID_{RP} \mapsto PID_{RP}}$.
%        In BrowserID, IdP obtains a null $PID_{RP}$ and provides $ID_U$ to the RP, therefore each RP obtains the unchanged $Accout$.
%\end{itemize}

%Obliviously, existing attempts fail to provide the complete  privacy.
%The essential reason is that these schemes provide an unchanged value (e.g., $PID_{U}$ in SAML \cite{SAMLIdentifier} and OIDC \cite{OpenIDConnect}, or $ID_U$ in BrowserID \cite{BrowserID} and SPRESSO \cite{SPRESSO}) for the user's multiple logins at an RP.
%To provide unchanged $PID_{U}$, IdP has to know $ID_{RP}$ and then will be able to identity or link the logins at an RP.
%Providing $ID_U$ to the RP, makes  the collusive RPs easily link the user's logins at different RPs.
%

In SPRESSO, the RP generates $PID_{RP}$ by encrypting $ID_{RP}$ padded with a nonce %, i.e., $PID_{RP} = Enc(RP_ID || nonce)$,
for each login session.  But the IdP issues the identity token using the real user identifier $ID_U$.
% and forwards $PID_{RP}$ to the IdP. With the corresponding nonce, the RP can verify $PID_{RP}$ in the identity token to ensure RP designation, while hiding $ID_{RP}$ from the IdP to defend against IdP-based login tracing. However, a same $ID_U$ is used to generate identity tokens for a same user, no matter which RPs she requests to log in. So, SPRESSO is vulnerable to RP-based identity linkage, since different RPs can correlate login requests of a same user by $ID_U$ (i.e., $Account = ID_U$).

Identity tokens in BrowserID include $ID_U$ but no RP information (i.e., $PID_{RP} = \bot$). Therefore, it suffers from RP-based identity linkage, but can prevent IdP-based login tracing.
%To ensure RP designation, BrowserID requires the user to append a \emph{subsidiary} identity token and sign it, where the identity token signed by the IdP authorizes the user to sign the subsidiary identity token. Obviously, $ID_U$ is tied to a pair of identity token and subsidiary identity token. Similarly, a user's login requests to different RPs can be linked by $ID_U$ (i.e., $Account = ID_U$), which makes BrowserID vulnerable to RP-based identity linkage.

In summary, none of the three approaches can defend against IdP-based login tracing and RP-based identity linkage at the same time.
This is because in each approach,
 three transformation functions $\mathcal{F}_{PID_U}$, $\mathcal{F}_{PID_{RP}}$ and $\mathcal{F}_{Acct}$ are designed arbitrarily and function separately, which causes either $PID_{RP} = ID_{RP}$ or $Acct = ID_U$.

%they do not explicitly clarify three pseudo-identities (i.e., $PID_U$, $PID_{RP}$, and $Account$) and then design $\mathcal{F}_{ID_{U} \mapsto PID_U}$,   $\mathcal{F}_{ID_{RP} \mapsto PID_{RP}}$, and $\mathcal{F}_{PID_{U} \mapsto Account}$ comprehensively.

\end{comment}
